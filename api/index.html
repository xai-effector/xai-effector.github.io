
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Tutorials/real-examples/01_bike_sharing_dataset/">
      
      
        <link rel="next" href="../contributing/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.2.7">
    
    
      
        <title>API - Effector Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.046329b4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Flex:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto Flex";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Effector Documentation" class="md-header__button md-logo" aria-label="Effector Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Effector Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_3" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_3">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Effector Documentation" class="md-nav__button md-logo" aria-label="Effector Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Effector Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Feature Effect
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Feature Effect
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Feature%20Effect/01_global_effect_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Global Effect
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Feature%20Effect/02_regional_effect_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Regional Effect
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Guides
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Tutorials/Guides/wrap_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wrap black-models in common ML libraries
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Synthetic Datasets
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Synthetic Datasets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Tutorials/synthetic-examples/01_linear_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linear Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Tutorials/synthetic-examples/02_global_effect_methods_comparision.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Global Effect - Methods Comparison
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Tutorials/synthetic-examples/03_regional_effects_synthetic_f/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Regional Effect in depth (a)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Tutorials/synthetic-examples/04_regional_effects_real_f/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Regional Effect in depth (b)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Real Datasets
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Real Datasets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Tutorials/real-examples/01_bike_sharing_dataset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bike Sharing
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    API
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#feature-effect-methods" class="md-nav__link">
    Feature Effect Methods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.global_effect_ale.ALEBase" class="md-nav__link">
    ALEBase
  </a>
  
    <nav class="md-nav" aria-label="ALEBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_ale.ALEBase.eval" class="md-nav__link">
    eval()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_ale.ALEBase.plot" class="md-nav__link">
    plot()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.global_effect_ale.ALE" class="md-nav__link">
    ALE
  </a>
  
    <nav class="md-nav" aria-label="ALE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_ale.ALE.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_ale.ALE.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.global_effect_ale.RHALE" class="md-nav__link">
    RHALE
  </a>
  
    <nav class="md-nav" aria-label="RHALE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_ale.RHALE.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_ale.RHALE.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.global_effect_pdp.PDPBase" class="md-nav__link">
    PDPBase
  </a>
  
    <nav class="md-nav" aria-label="PDPBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_pdp.PDPBase.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_pdp.PDPBase.eval" class="md-nav__link">
    eval()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_pdp.PDPBase.plot" class="md-nav__link">
    plot()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.global_effect_pdp.PDP" class="md-nav__link">
    PDP
  </a>
  
    <nav class="md-nav" aria-label="PDP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_pdp.PDP.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.global_effect_pdp.DerivativePDP" class="md-nav__link">
    DerivativePDP
  </a>
  
    <nav class="md-nav" aria-label="DerivativePDP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_pdp.DerivativePDP.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.global_effect_shap.SHAPDependence" class="md-nav__link">
    SHAPDependence
  </a>
  
    <nav class="md-nav" aria-label="SHAPDependence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_shap.SHAPDependence.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_shap.SHAPDependence.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_shap.SHAPDependence.eval" class="md-nav__link">
    eval()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_shap.SHAPDependence.plot" class="md-nav__link">
    plot()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#regional-effect-methods" class="md-nav__link">
    Regional Effect Methods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.regional_effect.RegionalEffectBase" class="md-nav__link">
    RegionalEffectBase
  </a>
  
    <nav class="md-nav" aria-label="RegionalEffectBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect.RegionalEffectBase.eval" class="md-nav__link">
    eval()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect.RegionalEffectBase.plot" class="md-nav__link">
    plot()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect.RegionalEffectBase.get_node_info" class="md-nav__link">
    get_node_info()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.regional_effect_ale.RegionalALE" class="md-nav__link">
    RegionalALE
  </a>
  
    <nav class="md-nav" aria-label="RegionalALE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect_ale.RegionalALE.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect_ale.RegionalALE.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.regional_effect_ale.RegionalRHALE" class="md-nav__link">
    RegionalRHALE
  </a>
  
    <nav class="md-nav" aria-label="RegionalRHALE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect_ale.RegionalRHALE.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect_ale.RegionalRHALE.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.regional_effect_pdp.RegionalPDPBase" class="md-nav__link">
    RegionalPDPBase
  </a>
  
    <nav class="md-nav" aria-label="RegionalPDPBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect_pdp.RegionalPDPBase.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.regional_effect_pdp.RegionalPDP" class="md-nav__link">
    RegionalPDP
  </a>
  
    <nav class="md-nav" aria-label="RegionalPDP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect_pdp.RegionalPDP.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.regional_effect_pdp.RegionalDerivativePDP" class="md-nav__link">
    RegionalDerivativePDP
  </a>
  
    <nav class="md-nav" aria-label="RegionalDerivativePDP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect_pdp.RegionalDerivativePDP.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.regional_effect_shap.RegionalSHAP" class="md-nav__link">
    RegionalSHAP
  </a>
  
    <nav class="md-nav" aria-label="RegionalSHAP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect_shap.RegionalSHAP.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect_shap.RegionalSHAP.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#binning-methods" class="md-nav__link">
    Binning Methods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.binning_methods.Fixed" class="md-nav__link">
    Fixed
  </a>
  
    <nav class="md-nav" aria-label="Fixed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.binning_methods.Fixed.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.binning_methods.Greedy" class="md-nav__link">
    Greedy
  </a>
  
    <nav class="md-nav" aria-label="Greedy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.binning_methods.Greedy.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.binning_methods.DynamicProgramming" class="md-nav__link">
    DynamicProgramming
  </a>
  
    <nav class="md-nav" aria-label="DynamicProgramming">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.binning_methods.DynamicProgramming.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils" class="md-nav__link">
    Utils
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.utils" class="md-nav__link">
    effector.utils
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.utils.compute_accumulated_effect" class="md-nav__link">
    compute_accumulated_effect()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.utils.compute_ale_params" class="md-nav__link">
    compute_ale_params()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.utils.compute_bin_effect" class="md-nav__link">
    compute_bin_effect()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.utils.compute_bin_variance" class="md-nav__link">
    compute_bin_variance()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.utils.compute_jacobian_numerically" class="md-nav__link">
    compute_jacobian_numerically()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.utils.compute_local_effects" class="md-nav__link">
    compute_local_effects()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.utils.fill_nans" class="md-nav__link">
    fill_nans()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.utils.filter_points_in_bin" class="md-nav__link">
    filter_points_in_bin()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.utils.get_feature_types" class="md-nav__link">
    get_feature_types()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../references/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#feature-effect-methods" class="md-nav__link">
    Feature Effect Methods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.global_effect_ale.ALEBase" class="md-nav__link">
    ALEBase
  </a>
  
    <nav class="md-nav" aria-label="ALEBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_ale.ALEBase.eval" class="md-nav__link">
    eval()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_ale.ALEBase.plot" class="md-nav__link">
    plot()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.global_effect_ale.ALE" class="md-nav__link">
    ALE
  </a>
  
    <nav class="md-nav" aria-label="ALE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_ale.ALE.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_ale.ALE.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.global_effect_ale.RHALE" class="md-nav__link">
    RHALE
  </a>
  
    <nav class="md-nav" aria-label="RHALE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_ale.RHALE.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_ale.RHALE.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.global_effect_pdp.PDPBase" class="md-nav__link">
    PDPBase
  </a>
  
    <nav class="md-nav" aria-label="PDPBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_pdp.PDPBase.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_pdp.PDPBase.eval" class="md-nav__link">
    eval()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_pdp.PDPBase.plot" class="md-nav__link">
    plot()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.global_effect_pdp.PDP" class="md-nav__link">
    PDP
  </a>
  
    <nav class="md-nav" aria-label="PDP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_pdp.PDP.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.global_effect_pdp.DerivativePDP" class="md-nav__link">
    DerivativePDP
  </a>
  
    <nav class="md-nav" aria-label="DerivativePDP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_pdp.DerivativePDP.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.global_effect_shap.SHAPDependence" class="md-nav__link">
    SHAPDependence
  </a>
  
    <nav class="md-nav" aria-label="SHAPDependence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_shap.SHAPDependence.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_shap.SHAPDependence.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_shap.SHAPDependence.eval" class="md-nav__link">
    eval()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.global_effect_shap.SHAPDependence.plot" class="md-nav__link">
    plot()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#regional-effect-methods" class="md-nav__link">
    Regional Effect Methods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.regional_effect.RegionalEffectBase" class="md-nav__link">
    RegionalEffectBase
  </a>
  
    <nav class="md-nav" aria-label="RegionalEffectBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect.RegionalEffectBase.eval" class="md-nav__link">
    eval()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect.RegionalEffectBase.plot" class="md-nav__link">
    plot()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect.RegionalEffectBase.get_node_info" class="md-nav__link">
    get_node_info()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.regional_effect_ale.RegionalALE" class="md-nav__link">
    RegionalALE
  </a>
  
    <nav class="md-nav" aria-label="RegionalALE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect_ale.RegionalALE.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect_ale.RegionalALE.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.regional_effect_ale.RegionalRHALE" class="md-nav__link">
    RegionalRHALE
  </a>
  
    <nav class="md-nav" aria-label="RegionalRHALE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect_ale.RegionalRHALE.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect_ale.RegionalRHALE.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.regional_effect_pdp.RegionalPDPBase" class="md-nav__link">
    RegionalPDPBase
  </a>
  
    <nav class="md-nav" aria-label="RegionalPDPBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect_pdp.RegionalPDPBase.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.regional_effect_pdp.RegionalPDP" class="md-nav__link">
    RegionalPDP
  </a>
  
    <nav class="md-nav" aria-label="RegionalPDP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect_pdp.RegionalPDP.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.regional_effect_pdp.RegionalDerivativePDP" class="md-nav__link">
    RegionalDerivativePDP
  </a>
  
    <nav class="md-nav" aria-label="RegionalDerivativePDP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect_pdp.RegionalDerivativePDP.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.regional_effect_shap.RegionalSHAP" class="md-nav__link">
    RegionalSHAP
  </a>
  
    <nav class="md-nav" aria-label="RegionalSHAP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect_shap.RegionalSHAP.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effector.regional_effect_shap.RegionalSHAP.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#binning-methods" class="md-nav__link">
    Binning Methods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.binning_methods.Fixed" class="md-nav__link">
    Fixed
  </a>
  
    <nav class="md-nav" aria-label="Fixed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.binning_methods.Fixed.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.binning_methods.Greedy" class="md-nav__link">
    Greedy
  </a>
  
    <nav class="md-nav" aria-label="Greedy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.binning_methods.Greedy.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.binning_methods.DynamicProgramming" class="md-nav__link">
    DynamicProgramming
  </a>
  
    <nav class="md-nav" aria-label="DynamicProgramming">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effector.binning_methods.DynamicProgramming.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils" class="md-nav__link">
    Utils
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.utils" class="md-nav__link">
    effector.utils
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.utils.compute_accumulated_effect" class="md-nav__link">
    compute_accumulated_effect()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.utils.compute_ale_params" class="md-nav__link">
    compute_ale_params()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.utils.compute_bin_effect" class="md-nav__link">
    compute_bin_effect()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.utils.compute_bin_variance" class="md-nav__link">
    compute_bin_variance()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.utils.compute_jacobian_numerically" class="md-nav__link">
    compute_jacobian_numerically()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.utils.compute_local_effects" class="md-nav__link">
    compute_local_effects()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.utils.fill_nans" class="md-nav__link">
    fill_nans()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.utils.filter_points_in_bin" class="md-nav__link">
    filter_points_in_bin()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effector.utils.get_feature_types" class="md-nav__link">
    get_feature_types()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="api-reference">API reference</h1>
<h2 id="feature-effect-methods">Feature Effect Methods</h2>


<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="effector.global_effect_ale.ALEBase">
        <code>effector.global_effect_ale.ALEBase</code>


</h2>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><span title="effector.global_effect.GlobalEffectBase">GlobalEffectBase</span></code></p>



        <details class="quote">
          <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_ale.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ALEBase</span><span class="p">(</span><span class="n">GlobalEffectBase</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
            <span class="n">model</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
            <span class="n">nof_instances</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
            <span class="n">axis_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">avg_output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">feature_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">target_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">method_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ALE&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">=</span> <span class="n">method_name</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ALEBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">method_name</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="n">nof_instances</span><span class="p">,</span>
            <span class="n">axis_limits</span><span class="p">,</span>
            <span class="n">avg_output</span><span class="p">,</span>
            <span class="n">feature_names</span><span class="p">,</span>
            <span class="n">target_name</span>
        <span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_fit_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                     <span class="n">binning_method</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">DynamicProgramming</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">Greedy</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">Fixed</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;greedy&quot;</span>
                     <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">features</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">_compute_norm_const</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;zero_integral&quot;</span><span class="p">,</span> <span class="n">nof_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the normalization constant.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;zero_integral&quot;</span><span class="p">,</span> <span class="s2">&quot;zero_start&quot;</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">create_partial_eval</span><span class="p">(</span><span class="n">feat</span><span class="p">):</span>
            <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_unnorm</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">partial_eval</span> <span class="o">=</span> <span class="n">create_partial_eval</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">feature</span><span class="p">]</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">feature</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;zero_integral&quot;</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">utils_integrate</span><span class="o">.</span><span class="n">mean_1d_linspace</span><span class="p">(</span><span class="n">partial_eval</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">nof_points</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">partial_eval</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">start</span><span class="p">]))</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">z</span>

    <span class="k">def</span> <span class="nf">_fit_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">binning_method</span><span class="p">,</span> <span class="n">centering</span><span class="p">):</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_features</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="n">centering</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_centering</span><span class="p">(</span><span class="n">centering</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
            <span class="c1"># compute all information required for plotting and evaluating the feature effect</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_feature</span><span class="p">(</span>
                <span class="n">s</span><span class="p">,</span> <span class="n">binning_method</span>
            <span class="p">)</span>

            <span class="c1"># append the &quot;norm_const&quot; to the feature effect if centering is not False</span>
            <span class="k">if</span> <span class="n">centering</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)][</span><span class="s2">&quot;norm_const&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_norm_const</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">centering</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)][</span><span class="s2">&quot;norm_const&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_symbol</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">is_fitted</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_args</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;centering&quot;</span><span class="p">:</span> <span class="n">centering</span><span class="p">,</span>
            <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_eval_unnorm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">compute_accumulated_effect</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;limits&quot;</span><span class="p">],</span> <span class="n">bin_effect</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;bin_effect&quot;</span><span class="p">],</span> <span class="n">dx</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;dx&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">heterogeneity</span><span class="p">:</span>
            <span class="n">std</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">compute_accumulated_effect</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="n">limits</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;limits&quot;</span><span class="p">],</span>
                <span class="n">bin_effect</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;bin_variance&quot;</span><span class="p">]),</span>
                <span class="n">dx</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;dx&quot;</span><span class="p">],</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">y</span><span class="p">,</span> <span class="n">std</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">xs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">heterogeneity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">centering</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evalueate the (RH)ALE feature effect of feature `feature` at points `xs`.</span>

<span class="sd">        Notes:</span>
<span class="sd">            This is a common method inherited by both ALE and RHALE.</span>

<span class="sd">        Args:</span>
<span class="sd">            feature: index of feature of interest</span>
<span class="sd">            xs: the points along the s-th axis to evaluate the FE plot</span>
<span class="sd">              - `np.ndarray` of shape `(T, )`</span>
<span class="sd">            heterogeneity: whether to return heterogeneity:</span>

<span class="sd">                  - `False`, returns the mean effect `y` at the given `xs`</span>
<span class="sd">                  - `True`, returns a tuple `(y, H)` of two `ndarrays`; `y` is the mean effect and `H` is the</span>
<span class="sd">                  heterogeneity evaluated at `xs`</span>

<span class="sd">            centering: whether to center the plot:</span>

<span class="sd">                - `False` means no centering</span>
<span class="sd">                - `True` or `zero_integral` centers around the `y` axis.</span>
<span class="sd">                - `zero_start` starts the plot from `y=0`.</span>
<span class="sd">        Returns:</span>
<span class="sd">            the mean effect `y`, if `heterogeneity=False` (default) or a tuple `(y, std)` otherwise</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">centering</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_centering</span><span class="p">(</span><span class="n">centering</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">centering</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="n">centering</span><span class="p">)</span>

        <span class="c1"># Check if the lower bound is less than the upper bound</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">feature</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">feature</span><span class="p">]</span>

        <span class="c1"># Evaluate the feature</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_unnorm</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="n">heterogeneity</span><span class="p">)</span>
        <span class="n">y</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">yy</span> <span class="k">if</span> <span class="n">heterogeneity</span> <span class="k">else</span> <span class="p">(</span><span class="n">yy</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Center if asked</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;norm_const&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">centering</span>
            <span class="k">else</span> <span class="n">y</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span> <span class="k">if</span> <span class="n">heterogeneity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span> <span class="k">else</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">heterogeneity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">centering</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">scale_x</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">scale_y</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">show_avg_output</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">y_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">dy_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the (RH)ALE feature effect of feature `feature`.</span>

<span class="sd">        Notes:</span>
<span class="sd">            This is a common method inherited by both ALE and RHALE.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            feature: the feature to plot</span>
<span class="sd">            heterogeneity: whether to plot the heterogeneity</span>

<span class="sd">                  - `False`, plots only the mean effect</span>
<span class="sd">                  - `True`, the std of the bin-effects will be plotted using a red vertical bar</span>

<span class="sd">            centering: whether to center the plot:</span>

<span class="sd">                - `False` means no centering</span>
<span class="sd">                - `True` or `zero_integral` centers around the `y` axis.</span>
<span class="sd">                - `zero_start` starts the plot from `y=0`.</span>

<span class="sd">            scale_x: None or Dict with keys [&#39;std&#39;, &#39;mean&#39;]</span>

<span class="sd">                - If set to None, no scaling will be applied.</span>
<span class="sd">                - If set to a dict, the x-axis will be scaled by the standard deviation and the mean.</span>
<span class="sd">            scale_y: None or Dict with keys [&#39;std&#39;, &#39;mean&#39;]</span>

<span class="sd">                - If set to None, no scaling will be applied.</span>
<span class="sd">                - If set to a dict, the y-axis will be scaled by the standard deviation and the mean.</span>
<span class="sd">            show_avg_output: if True, the average output will be shown as a horizontal line.</span>
<span class="sd">            y_limits: None or tuple, the limits of the y-axis</span>

<span class="sd">                - If set to None, the limits of the y-axis are set automatically</span>
<span class="sd">                - If set to a tuple, the limits are manually set</span>

<span class="sd">            dy_limits: None or tuple, the limits of the dy-axis</span>

<span class="sd">                - If set to None, the limits of the dy-axis are set automatically</span>
<span class="sd">                - If set to a tuple, the limits are manually set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">heterogeneity</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_confidence_interval</span><span class="p">(</span><span class="n">heterogeneity</span><span class="p">)</span>
        <span class="n">centering</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_centering</span><span class="p">(</span><span class="n">centering</span><span class="p">)</span>

        <span class="c1"># hack to fit the feature if not fitted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span>
            <span class="n">feature</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">feature</span><span class="p">]]),</span> <span class="n">centering</span><span class="o">=</span><span class="n">centering</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">show_avg_output</span><span class="p">:</span>
            <span class="n">avg_output</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_avg_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_output</span><span class="p">,</span> <span class="n">scale_y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">avg_output</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">vis</span><span class="o">.</span><span class="n">ale_plot</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">,</span>
            <span class="n">feature</span><span class="p">,</span>
            <span class="n">centering</span><span class="o">=</span><span class="n">centering</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="n">heterogeneity</span><span class="p">,</span>
            <span class="n">scale_x</span><span class="o">=</span><span class="n">scale_x</span><span class="p">,</span>
            <span class="n">scale_y</span><span class="o">=</span><span class="n">scale_y</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">+</span> <span class="s2">&quot; plot&quot;</span><span class="p">,</span>
            <span class="n">avg_output</span><span class="o">=</span><span class="n">avg_output</span><span class="p">,</span>
            <span class="n">feature_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">,</span>
            <span class="n">target_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_name</span><span class="p">,</span>
            <span class="n">y_limits</span><span class="o">=</span><span class="n">y_limits</span><span class="p">,</span>
            <span class="n">dy_limits</span><span class="o">=</span><span class="n">dy_limits</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.global_effect_ale.ALEBase.eval">
<code class="highlight language-python"><span class="nb">eval</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Evalueate the (RH)ALE feature effect of feature <code>feature</code> at points <code>xs</code>.</p>

<details class="notes" open>
  <summary>Notes</summary>
  <p>This is a common method inherited by both ALE and RHALE.</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>feature</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>index of feature of interest</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>xs</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the points along the s-th axis to evaluate the FE plot
- <code>np.ndarray</code> of shape <code>(T, )</code></p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>heterogeneity</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to return heterogeneity:</p>
<ul>
<li><code>False</code>, returns the mean effect <code>y</code> at the given <code>xs</code></li>
<li><code>True</code>, returns a tuple <code>(y, H)</code> of two <code>ndarrays</code>; <code>y</code> is the mean effect and <code>H</code> is the
  heterogeneity evaluated at <code>xs</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>centering</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[bool, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to center the plot:</p>
<ul>
<li><code>False</code> means no centering</li>
<li><code>True</code> or <code>zero_integral</code> centers around the <code>y</code> axis.</li>
<li><code>zero_start</code> starts the plot from <code>y=0</code>.</li>
</ul>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[<span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>, typing.<span title="typing.Tuple">Tuple</span>[<span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>, <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the mean effect <code>y</code>, if <code>heterogeneity=False</code> (default) or a tuple <code>(y, std)</code> otherwise</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_ale.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">eval</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">xs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">heterogeneity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">centering</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evalueate the (RH)ALE feature effect of feature `feature` at points `xs`.</span>

<span class="sd">    Notes:</span>
<span class="sd">        This is a common method inherited by both ALE and RHALE.</span>

<span class="sd">    Args:</span>
<span class="sd">        feature: index of feature of interest</span>
<span class="sd">        xs: the points along the s-th axis to evaluate the FE plot</span>
<span class="sd">          - `np.ndarray` of shape `(T, )`</span>
<span class="sd">        heterogeneity: whether to return heterogeneity:</span>

<span class="sd">              - `False`, returns the mean effect `y` at the given `xs`</span>
<span class="sd">              - `True`, returns a tuple `(y, H)` of two `ndarrays`; `y` is the mean effect and `H` is the</span>
<span class="sd">              heterogeneity evaluated at `xs`</span>

<span class="sd">        centering: whether to center the plot:</span>

<span class="sd">            - `False` means no centering</span>
<span class="sd">            - `True` or `zero_integral` centers around the `y` axis.</span>
<span class="sd">            - `zero_start` starts the plot from `y=0`.</span>
<span class="sd">    Returns:</span>
<span class="sd">        the mean effect `y`, if `heterogeneity=False` (default) or a tuple `(y, std)` otherwise</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">centering</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_centering</span><span class="p">(</span><span class="n">centering</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">centering</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="n">centering</span><span class="p">)</span>

    <span class="c1"># Check if the lower bound is less than the upper bound</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">feature</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">feature</span><span class="p">]</span>

    <span class="c1"># Evaluate the feature</span>
    <span class="n">yy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_unnorm</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="n">heterogeneity</span><span class="p">)</span>
    <span class="n">y</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">yy</span> <span class="k">if</span> <span class="n">heterogeneity</span> <span class="k">else</span> <span class="p">(</span><span class="n">yy</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Center if asked</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;norm_const&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">centering</span>
        <span class="k">else</span> <span class="n">y</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span> <span class="k">if</span> <span class="n">heterogeneity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span> <span class="k">else</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.global_effect_ale.ALEBase.plot">
<code class="highlight language-python"><span class="n">plot</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scale_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_avg_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">y_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dy_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Plot the (RH)ALE feature effect of feature <code>feature</code>.</p>

<details class="notes" open>
  <summary>Notes</summary>
  <p>This is a common method inherited by both ALE and RHALE.</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>feature</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the feature to plot</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>heterogeneity</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to plot the heterogeneity</p>
<ul>
<li><code>False</code>, plots only the mean effect</li>
<li><code>True</code>, the std of the bin-effects will be plotted using a red vertical bar</li>
</ul>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>centering</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[bool, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to center the plot:</p>
<ul>
<li><code>False</code> means no centering</li>
<li><code>True</code> or <code>zero_integral</code> centers around the <code>y</code> axis.</li>
<li><code>zero_start</code> starts the plot from <code>y=0</code>.</li>
</ul>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>scale_x</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[dict]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>None or Dict with keys ['std', 'mean']</p>
<ul>
<li>If set to None, no scaling will be applied.</li>
<li>If set to a dict, the x-axis will be scaled by the standard deviation and the mean.</li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>scale_y</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[dict]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>None or Dict with keys ['std', 'mean']</p>
<ul>
<li>If set to None, no scaling will be applied.</li>
<li>If set to a dict, the y-axis will be scaled by the standard deviation and the mean.</li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>show_avg_output</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>if True, the average output will be shown as a horizontal line.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>y_limits</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>None or tuple, the limits of the y-axis</p>
<ul>
<li>If set to None, the limits of the y-axis are set automatically</li>
<li>If set to a tuple, the limits are manually set</li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>dy_limits</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>None or tuple, the limits of the dy-axis</p>
<ul>
<li>If set to None, the limits of the dy-axis are set automatically</li>
<li>If set to a tuple, the limits are manually set</li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_ale.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">heterogeneity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">centering</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">scale_x</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scale_y</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">show_avg_output</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">y_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dy_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the (RH)ALE feature effect of feature `feature`.</span>

<span class="sd">    Notes:</span>
<span class="sd">        This is a common method inherited by both ALE and RHALE.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        feature: the feature to plot</span>
<span class="sd">        heterogeneity: whether to plot the heterogeneity</span>

<span class="sd">              - `False`, plots only the mean effect</span>
<span class="sd">              - `True`, the std of the bin-effects will be plotted using a red vertical bar</span>

<span class="sd">        centering: whether to center the plot:</span>

<span class="sd">            - `False` means no centering</span>
<span class="sd">            - `True` or `zero_integral` centers around the `y` axis.</span>
<span class="sd">            - `zero_start` starts the plot from `y=0`.</span>

<span class="sd">        scale_x: None or Dict with keys [&#39;std&#39;, &#39;mean&#39;]</span>

<span class="sd">            - If set to None, no scaling will be applied.</span>
<span class="sd">            - If set to a dict, the x-axis will be scaled by the standard deviation and the mean.</span>
<span class="sd">        scale_y: None or Dict with keys [&#39;std&#39;, &#39;mean&#39;]</span>

<span class="sd">            - If set to None, no scaling will be applied.</span>
<span class="sd">            - If set to a dict, the y-axis will be scaled by the standard deviation and the mean.</span>
<span class="sd">        show_avg_output: if True, the average output will be shown as a horizontal line.</span>
<span class="sd">        y_limits: None or tuple, the limits of the y-axis</span>

<span class="sd">            - If set to None, the limits of the y-axis are set automatically</span>
<span class="sd">            - If set to a tuple, the limits are manually set</span>

<span class="sd">        dy_limits: None or tuple, the limits of the dy-axis</span>

<span class="sd">            - If set to None, the limits of the dy-axis are set automatically</span>
<span class="sd">            - If set to a tuple, the limits are manually set</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">heterogeneity</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_confidence_interval</span><span class="p">(</span><span class="n">heterogeneity</span><span class="p">)</span>
    <span class="n">centering</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_centering</span><span class="p">(</span><span class="n">centering</span><span class="p">)</span>

    <span class="c1"># hack to fit the feature if not fitted</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span>
        <span class="n">feature</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">feature</span><span class="p">]]),</span> <span class="n">centering</span><span class="o">=</span><span class="n">centering</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">show_avg_output</span><span class="p">:</span>
        <span class="n">avg_output</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_avg_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_output</span><span class="p">,</span> <span class="n">scale_y</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">avg_output</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">vis</span><span class="o">.</span><span class="n">ale_plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)],</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">,</span>
        <span class="n">feature</span><span class="p">,</span>
        <span class="n">centering</span><span class="o">=</span><span class="n">centering</span><span class="p">,</span>
        <span class="n">error</span><span class="o">=</span><span class="n">heterogeneity</span><span class="p">,</span>
        <span class="n">scale_x</span><span class="o">=</span><span class="n">scale_x</span><span class="p">,</span>
        <span class="n">scale_y</span><span class="o">=</span><span class="n">scale_y</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">+</span> <span class="s2">&quot; plot&quot;</span><span class="p">,</span>
        <span class="n">avg_output</span><span class="o">=</span><span class="n">avg_output</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">,</span>
        <span class="n">target_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_name</span><span class="p">,</span>
        <span class="n">y_limits</span><span class="o">=</span><span class="n">y_limits</span><span class="p">,</span>
        <span class="n">dy_limits</span><span class="o">=</span><span class="n">dy_limits</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="effector.global_effect_ale.ALE">
        <code>effector.global_effect_ale.ALE</code>


</h2>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="effector.global_effect_ale.ALEBase" href="#effector.global_effect_ale.ALEBase">ALEBase</a></code></p>



        <details class="quote">
          <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_ale.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ALE</span><span class="p">(</span><span class="n">ALEBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
            <span class="n">model</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
            <span class="n">nof_instances</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
            <span class="n">axis_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">avg_output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">feature_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">target_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor for the ALE plot.</span>

<span class="sd">        Definition:</span>
<span class="sd">            ALE is defined as:</span>
<span class="sd">            $$</span>
<span class="sd">            \hat{f}^{ALE}(x_s) = TODO</span>
<span class="sd">            $$</span>

<span class="sd">            The heterogeneity is:</span>
<span class="sd">            $$</span>
<span class="sd">            TODO</span>
<span class="sd">            $$</span>

<span class="sd">            The std of the bin-effects is:</span>
<span class="sd">            $$</span>
<span class="sd">            TODO</span>
<span class="sd">            $$</span>

<span class="sd">        Notes:</span>
<span class="sd">            - The required parameters are `data` and `model`. The rest are optional.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: the design matrix</span>

<span class="sd">                - shape: `(N,D)`</span>
<span class="sd">            model: the black-box model. Must be a `Callable` with:</span>

<span class="sd">                - input: `ndarray` of shape `(N, D)`</span>
<span class="sd">                - output: `ndarray` of shape `(N, )`</span>

<span class="sd">            nof_instances: the number of instances to use for the explanation</span>

<span class="sd">                - use an `int`, to specify the number of instances</span>
<span class="sd">                - use `&quot;all&quot;`, to use all the instances</span>

<span class="sd">            axis_limits: The limits of the feature effect plot along each axis</span>

<span class="sd">                - use a `ndarray` of shape `(2, D)`, to specify them manually</span>
<span class="sd">                - use `None`, to be inferred from the data</span>

<span class="sd">            avg_output: the average output of the model on the data</span>

<span class="sd">                - use a `float`, to specify it manually</span>
<span class="sd">                - use `None`, to be inferred as `np.mean(model(data))`</span>

<span class="sd">            feature_names: The names of the features</span>

<span class="sd">                - use a `list` of `str`, to specify the name manually. For example: `                  [&quot;age&quot;, &quot;weight&quot;, ...]`</span>
<span class="sd">                - use `None`, to keep the default names: `[&quot;x_0&quot;, &quot;x_1&quot;, ...]`</span>

<span class="sd">            target_name: The name of the target variable</span>

<span class="sd">                - use a `str`, to specify it name manually. For example: `&quot;price&quot;`</span>
<span class="sd">                - use `None`, to keep the default name: `&quot;y&quot;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ALE</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">nof_instances</span><span class="p">,</span> <span class="n">axis_limits</span><span class="p">,</span> <span class="n">avg_output</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="n">target_name</span><span class="p">,</span> <span class="s2">&quot;ALE&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fit_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">binning_method</span><span class="o">=</span><span class="s2">&quot;fixed&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">:</span>

        <span class="c1"># drop points outside of limits</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="n">feature</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">feature</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="n">feature</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">feature</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c1"># assertion</span>
        <span class="k">assert</span> <span class="n">binning_method</span> <span class="o">==</span> <span class="s2">&quot;fixed&quot;</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">binning_method</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">Fixed</span>
        <span class="p">),</span> <span class="s2">&quot;ALE can work only with the fixed binning method!&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">binning_method</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">binning_method</span> <span class="o">=</span> <span class="n">bm</span><span class="o">.</span><span class="n">Fixed</span><span class="p">(</span><span class="n">nof_bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">min_points_per_bin</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">bin_est</span> <span class="o">=</span> <span class="n">bm</span><span class="o">.</span><span class="n">find_limits</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">,</span> <span class="n">binning_method</span><span class="p">)</span>
        <span class="n">bin_name</span> <span class="o">=</span> <span class="n">bin_est</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="c1"># assert bins can be computed else raise error</span>
        <span class="k">assert</span> <span class="n">bin_est</span><span class="o">.</span><span class="n">limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;Impossible to compute bins with enough points for feature &quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot; and binning strategy: &quot;</span>
            <span class="o">+</span> <span class="n">bin_name</span>
            <span class="o">+</span> <span class="s2">&quot;. Change bin strategy or &quot;</span>
            <span class="s2">&quot;the parameters of the method&quot;</span>
        <span class="p">)</span>

        <span class="c1"># compute data effect on bin limits</span>
        <span class="n">data_effect</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">compute_local_effects</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">bin_est</span><span class="o">.</span><span class="n">limits</span><span class="p">,</span> <span class="n">feature</span>
        <span class="p">)</span>

        <span class="c1"># compute the bin effect</span>
        <span class="n">dale_params</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">compute_ale_params</span><span class="p">(</span>
            <span class="n">data</span><span class="p">[:,</span> <span class="n">feature</span><span class="p">],</span> <span class="n">data_effect</span><span class="p">,</span> <span class="n">bin_est</span><span class="o">.</span><span class="n">limits</span>
        <span class="p">)</span>
        <span class="n">dale_params</span><span class="p">[</span><span class="s2">&quot;alg_params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fixed&quot;</span>
        <span class="k">return</span> <span class="n">dale_params</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">binning_method</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">Fixed</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fixed&quot;</span><span class="p">,</span>
        <span class="n">centering</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;zero_integral&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit the ALE plot.</span>

<span class="sd">        Args:</span>
<span class="sd">            features: the features to fit. If set to &quot;all&quot;, all the features will be fitted.</span>

<span class="sd">            binning_method:</span>

<span class="sd">                - If set to `&quot;fixed&quot;`, the ALE plot will be computed with the  default values, which are</span>
<span class="sd">                `20` bins with at least `10` points per bin and the featue is considered as categorical if it has</span>
<span class="sd">                less than `15` unique values.</span>
<span class="sd">                - If you want to change the parameters of the method, you pass an instance of the</span>
<span class="sd">                class `effector.binning_methods.Fixed` with the desired parameters.</span>
<span class="sd">                For example: `Fixed(nof_bins=20, min_points_per_bin=0, cat_limit=10)`</span>

<span class="sd">            centering: whether to compute the normalization constant for centering the plot:</span>

<span class="sd">                - `False` means no centering</span>
<span class="sd">                - `True` or `zero_integral` centers around the `y` axis.</span>
<span class="sd">                - `zero_start` starts the plot from `y=0`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">binning_method</span> <span class="o">==</span> <span class="s2">&quot;fixed&quot;</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">binning_method</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">Fixed</span>
        <span class="p">),</span> <span class="s2">&quot;ALE can work only with the fixed binning method!&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_loop</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">binning_method</span><span class="p">,</span> <span class="n">centering</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.global_effect_ale.ALE.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">nof_instances</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">axis_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">avg_output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Constructor for the ALE plot.</p>

<details class="definition" open>
  <summary>Definition</summary>
  <p>ALE is defined as:
$$
\hat{f}^{ALE}(x_s) = TODO
$$</p>
<p>The heterogeneity is:
$$
TODO
$$</p>
<p>The std of the bin-effects is:
$$
TODO
$$</p>
</details>
<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>The required parameters are <code>data</code> and <code>model</code>. The rest are optional.</li>
</ul>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the design matrix</p>
<ul>
<li>shape: <code>(N,D)</code></li>
</ul>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model</code></td>
          <td>
                <code>callable</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the black-box model. Must be a <code>Callable</code> with:</p>
<ul>
<li>input: <code>ndarray</code> of shape <code>(N, D)</code></li>
<li>output: <code>ndarray</code> of shape <code>(N, )</code></li>
</ul>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>nof_instances</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[int, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the number of instances to use for the explanation</p>
<ul>
<li>use an <code>int</code>, to specify the number of instances</li>
<li>use <code>"all"</code>, to use all the instances</li>
</ul>
            </div>
          </td>
          <td>
                <code>&#39;all&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>axis_limits</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The limits of the feature effect plot along each axis</p>
<ul>
<li>use a <code>ndarray</code> of shape <code>(2, D)</code>, to specify them manually</li>
<li>use <code>None</code>, to be inferred from the data</li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>avg_output</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the average output of the model on the data</p>
<ul>
<li>use a <code>float</code>, to specify it manually</li>
<li>use <code>None</code>, to be inferred as <code>np.mean(model(data))</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>feature_names</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The names of the features</p>
<ul>
<li>use a <code>list</code> of <code>str</code>, to specify the name manually. For example: <code>["age", "weight", ...]</code></li>
<li>use <code>None</code>, to keep the default names: <code>["x_0", "x_1", ...]</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>target_name</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the target variable</p>
<ul>
<li>use a <code>str</code>, to specify it name manually. For example: <code>"price"</code></li>
<li>use <code>None</code>, to keep the default name: <code>"y"</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_ale.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
        <span class="n">nof_instances</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">axis_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">avg_output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructor for the ALE plot.</span>

<span class="sd">    Definition:</span>
<span class="sd">        ALE is defined as:</span>
<span class="sd">        $$</span>
<span class="sd">        \hat{f}^{ALE}(x_s) = TODO</span>
<span class="sd">        $$</span>

<span class="sd">        The heterogeneity is:</span>
<span class="sd">        $$</span>
<span class="sd">        TODO</span>
<span class="sd">        $$</span>

<span class="sd">        The std of the bin-effects is:</span>
<span class="sd">        $$</span>
<span class="sd">        TODO</span>
<span class="sd">        $$</span>

<span class="sd">    Notes:</span>
<span class="sd">        - The required parameters are `data` and `model`. The rest are optional.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: the design matrix</span>

<span class="sd">            - shape: `(N,D)`</span>
<span class="sd">        model: the black-box model. Must be a `Callable` with:</span>

<span class="sd">            - input: `ndarray` of shape `(N, D)`</span>
<span class="sd">            - output: `ndarray` of shape `(N, )`</span>

<span class="sd">        nof_instances: the number of instances to use for the explanation</span>

<span class="sd">            - use an `int`, to specify the number of instances</span>
<span class="sd">            - use `&quot;all&quot;`, to use all the instances</span>

<span class="sd">        axis_limits: The limits of the feature effect plot along each axis</span>

<span class="sd">            - use a `ndarray` of shape `(2, D)`, to specify them manually</span>
<span class="sd">            - use `None`, to be inferred from the data</span>

<span class="sd">        avg_output: the average output of the model on the data</span>

<span class="sd">            - use a `float`, to specify it manually</span>
<span class="sd">            - use `None`, to be inferred as `np.mean(model(data))`</span>

<span class="sd">        feature_names: The names of the features</span>

<span class="sd">            - use a `list` of `str`, to specify the name manually. For example: `                  [&quot;age&quot;, &quot;weight&quot;, ...]`</span>
<span class="sd">            - use `None`, to keep the default names: `[&quot;x_0&quot;, &quot;x_1&quot;, ...]`</span>

<span class="sd">        target_name: The name of the target variable</span>

<span class="sd">            - use a `str`, to specify it name manually. For example: `&quot;price&quot;`</span>
<span class="sd">            - use `None`, to keep the default name: `&quot;y&quot;`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">ALE</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">nof_instances</span><span class="p">,</span> <span class="n">axis_limits</span><span class="p">,</span> <span class="n">avg_output</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="n">target_name</span><span class="p">,</span> <span class="s2">&quot;ALE&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.global_effect_ale.ALE.fit">
<code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">binning_method</span><span class="o">=</span><span class="s1">&#39;fixed&#39;</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="s1">&#39;zero_integral&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Fit the ALE plot.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>features</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[int, str, list]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the features to fit. If set to "all", all the features will be fitted.</p>
            </div>
          </td>
          <td>
                <code>&#39;all&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>binning_method</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[str, <span title="effector.binning_methods">bm</span>.<a class="autorefs autorefs-internal" title="effector.binning_methods.Fixed" href="#effector.binning_methods.Fixed">Fixed</a>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <ul>
<li>If set to <code>"fixed"</code>, the ALE plot will be computed with the  default values, which are
<code>20</code> bins with at least <code>10</code> points per bin and the featue is considered as categorical if it has
less than <code>15</code> unique values.</li>
<li>If you want to change the parameters of the method, you pass an instance of the
class <code>effector.binning_methods.Fixed</code> with the desired parameters.
For example: <code>Fixed(nof_bins=20, min_points_per_bin=0, cat_limit=10)</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>&#39;fixed&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>centering</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[bool, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to compute the normalization constant for centering the plot:</p>
<ul>
<li><code>False</code> means no centering</li>
<li><code>True</code> or <code>zero_integral</code> centers around the <code>y</code> axis.</li>
<li><code>zero_start</code> starts the plot from <code>y=0</code>.</li>
</ul>
            </div>
          </td>
          <td>
                <code>&#39;zero_integral&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_ale.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">features</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="n">binning_method</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">Fixed</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fixed&quot;</span><span class="p">,</span>
    <span class="n">centering</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;zero_integral&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit the ALE plot.</span>

<span class="sd">    Args:</span>
<span class="sd">        features: the features to fit. If set to &quot;all&quot;, all the features will be fitted.</span>

<span class="sd">        binning_method:</span>

<span class="sd">            - If set to `&quot;fixed&quot;`, the ALE plot will be computed with the  default values, which are</span>
<span class="sd">            `20` bins with at least `10` points per bin and the featue is considered as categorical if it has</span>
<span class="sd">            less than `15` unique values.</span>
<span class="sd">            - If you want to change the parameters of the method, you pass an instance of the</span>
<span class="sd">            class `effector.binning_methods.Fixed` with the desired parameters.</span>
<span class="sd">            For example: `Fixed(nof_bins=20, min_points_per_bin=0, cat_limit=10)`</span>

<span class="sd">        centering: whether to compute the normalization constant for centering the plot:</span>

<span class="sd">            - `False` means no centering</span>
<span class="sd">            - `True` or `zero_integral` centers around the `y` axis.</span>
<span class="sd">            - `zero_start` starts the plot from `y=0`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">binning_method</span> <span class="o">==</span> <span class="s2">&quot;fixed&quot;</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
        <span class="n">binning_method</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">Fixed</span>
    <span class="p">),</span> <span class="s2">&quot;ALE can work only with the fixed binning method!&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_fit_loop</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">binning_method</span><span class="p">,</span> <span class="n">centering</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="effector.global_effect_ale.RHALE">
        <code>effector.global_effect_ale.RHALE</code>


</h2>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="effector.global_effect_ale.ALEBase" href="#effector.global_effect_ale.ALEBase">ALEBase</a></code></p>



        <details class="quote">
          <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_ale.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RHALE</span><span class="p">(</span><span class="n">ALEBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
            <span class="n">model</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
            <span class="n">model_jac</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">nof_instances</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
            <span class="n">axis_limits</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">data_effect</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">avg_output</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">feature_names</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">target_name</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor for RHALE.</span>

<span class="sd">        Definition:</span>
<span class="sd">            RHALE is defined as:</span>
<span class="sd">            $$</span>
<span class="sd">            \hat{f}^{RHALE}(x_s) = TODO</span>
<span class="sd">            $$</span>

<span class="sd">            The heterogeneity is:</span>
<span class="sd">            $$</span>
<span class="sd">            TODO</span>
<span class="sd">            $$</span>

<span class="sd">            The std of the bin-effects is:</span>
<span class="sd">            $$</span>
<span class="sd">            TODO</span>
<span class="sd">            $$</span>

<span class="sd">        Notes:</span>
<span class="sd">            The required parameters are `data` and `model`. The rest are optional.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: the design matrix</span>

<span class="sd">                - shape: `(N,D)`</span>
<span class="sd">            model: the black-box model. Must be a `Callable` with:</span>

<span class="sd">                - input: `ndarray` of shape `(N, D)`</span>
<span class="sd">                - output: `ndarray` of shape `(N, )`</span>

<span class="sd">            model_jac: the Jacobian of the model. Must be a `Callable` with:</span>

<span class="sd">                - input: `ndarray` of shape `(N, D)`</span>
<span class="sd">                - output: `ndarray` of shape `(N, D)`</span>

<span class="sd">            nof_instances: the number of instances to use for the explanation</span>

<span class="sd">                - use an `int`, to specify the number of instances</span>
<span class="sd">                - use `&quot;all&quot;`, to use all the instances</span>

<span class="sd">            axis_limits: The limits of the feature effect plot along each axis</span>

<span class="sd">                - use a `ndarray` of shape `(2, D)`, to specify them manually</span>
<span class="sd">                - use `None`, to be inferred from the data</span>

<span class="sd">            data_effect:</span>
<span class="sd">                - if np.ndarray, the model Jacobian computed on the `data`</span>
<span class="sd">                - if None, the Jacobian will be computed using model_jac</span>

<span class="sd">            avg_output: the average output of the model on the data</span>

<span class="sd">                - use a `float`, to specify it manually</span>
<span class="sd">                - use `None`, to be inferred as `np.mean(model(data))`</span>

<span class="sd">            feature_names: The names of the features</span>

<span class="sd">                - use a `list` of `str`, to specify the name manually. For example: `[&quot;age&quot;, &quot;weight&quot;, ...]`</span>
<span class="sd">                - use `None`, to keep the default names: `[&quot;x_0&quot;, &quot;x_1&quot;, ...]`</span>

<span class="sd">            target_name: The name of the target variable</span>

<span class="sd">                - use a `str`, to specify it name manually. For example: `&quot;price&quot;`</span>
<span class="sd">                - use `None`, to keep the default name: `&quot;y&quot;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_jac</span> <span class="o">=</span> <span class="n">model_jac</span>

        <span class="c1"># select nof_instances from the data</span>
        <span class="n">nof_instances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_nof_instances</span><span class="p">(</span><span class="n">nof_instances</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">data_effect</span> <span class="o">=</span> <span class="n">data_effect</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="p">:]</span> <span class="k">if</span> <span class="n">data_effect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_effect</span> <span class="o">=</span> <span class="n">data_effect</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">RHALE</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">axis_limits</span><span class="p">,</span> <span class="n">avg_output</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="n">target_name</span><span class="p">,</span> <span class="s2">&quot;RHALE&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepare everything for fitting, i.e., compute the gradients on data points.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_effect</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_jac</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_jac</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_effect</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_jac</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_effect</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">compute_jacobian_numerically</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fit_feature</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">binning_method</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">DynamicProgramming</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">Greedy</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">Fixed</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;greedy&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_effect</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

        <span class="c1"># drop points outside of limits</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="n">feature</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">feature</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="n">feature</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">feature</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">data_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_effect</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c1"># bin estimation</span>
        <span class="n">bin_est</span> <span class="o">=</span> <span class="n">bm</span><span class="o">.</span><span class="n">find_limits</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">data_effect</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">,</span> <span class="n">binning_method</span>
        <span class="p">)</span>
        <span class="n">bin_name</span> <span class="o">=</span> <span class="n">bin_est</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="c1"># assert bins can be computed else raise error</span>
        <span class="k">assert</span> <span class="n">bin_est</span><span class="o">.</span><span class="n">limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;Impossible to compute bins with enough points for feature &quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot; and binning strategy: &quot;</span>
            <span class="o">+</span> <span class="n">bin_name</span>
            <span class="o">+</span> <span class="s2">&quot;. Change bin strategy or &quot;</span>
            <span class="s2">&quot;the parameters of the method&quot;</span>
        <span class="p">)</span>

        <span class="c1"># compute the bin effect</span>
        <span class="n">dale_params</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">compute_ale_params</span><span class="p">(</span>
            <span class="n">data</span><span class="p">[:,</span> <span class="n">feature</span><span class="p">],</span> <span class="n">data_effect</span><span class="p">[:,</span> <span class="n">feature</span><span class="p">],</span> <span class="n">bin_est</span><span class="o">.</span><span class="n">limits</span>
        <span class="p">)</span>
        <span class="n">dale_params</span><span class="p">[</span><span class="s2">&quot;alg_params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">binning_method</span>
        <span class="k">return</span> <span class="n">dale_params</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">binning_method</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">DynamicProgramming</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">Greedy</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">Fixed</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;greedy&quot;</span><span class="p">,</span>
        <span class="n">centering</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit the model.</span>

<span class="sd">        Args:</span>
<span class="sd">            features (int, str, list): the features to fit.</span>

<span class="sd">                - If set to &quot;all&quot;, all the features will be fitted.</span>

<span class="sd">            binning_method (str): the binning method to use.</span>

<span class="sd">                - Use `&quot;greedy&quot;` for using the Greedy binning solution with the default parameters.</span>
<span class="sd">                  For custom parameters initialize a `binning_methods.Greedy` object</span>
<span class="sd">                - Use `&quot;dp&quot;` for using a Dynamic Programming binning solution with the default parameters.</span>
<span class="sd">                  For custom parameters initialize a `binning_methods.DynamicProgramming` object</span>
<span class="sd">                - Use `&quot;fixed&quot;` for using a Fixed binning solution with the default parameters.</span>
<span class="sd">                  For custom parameters initialize a `binning_methods.Fixed` object</span>

<span class="sd">            centering: whether to compute the normalization constant for centering the plot:</span>

<span class="sd">                - `False` means no centering</span>
<span class="sd">                - `True` or `zero_integral` centers around the `y` axis</span>
<span class="sd">                - `zero_start` starts the plot from `y=0`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">binning_method</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;greedy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dynamic&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fixed&quot;</span>
        <span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">binning_method</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">Greedy</span>
        <span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">binning_method</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">DynamicProgramming</span>
        <span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">binning_method</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">Fixed</span>
        <span class="p">),</span> <span class="s2">&quot;Unknown binning method!&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_loop</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">binning_method</span><span class="p">,</span> <span class="n">centering</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.global_effect_ale.RHALE.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">model_jac</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nof_instances</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">axis_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_effect</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">avg_output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Constructor for RHALE.</p>

<details class="definition" open>
  <summary>Definition</summary>
  <p>RHALE is defined as:
$$
\hat{f}^{RHALE}(x_s) = TODO
$$</p>
<p>The heterogeneity is:
$$
TODO
$$</p>
<p>The std of the bin-effects is:
$$
TODO
$$</p>
</details>
<details class="notes" open>
  <summary>Notes</summary>
  <p>The required parameters are <code>data</code> and <code>model</code>. The rest are optional.</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the design matrix</p>
<ul>
<li>shape: <code>(N,D)</code></li>
</ul>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model</code></td>
          <td>
                <code>callable</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the black-box model. Must be a <code>Callable</code> with:</p>
<ul>
<li>input: <code>ndarray</code> of shape <code>(N, D)</code></li>
<li>output: <code>ndarray</code> of shape <code>(N, )</code></li>
</ul>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model_jac</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[None, callable]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the Jacobian of the model. Must be a <code>Callable</code> with:</p>
<ul>
<li>input: <code>ndarray</code> of shape <code>(N, D)</code></li>
<li>output: <code>ndarray</code> of shape <code>(N, D)</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>nof_instances</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[int, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the number of instances to use for the explanation</p>
<ul>
<li>use an <code>int</code>, to specify the number of instances</li>
<li>use <code>"all"</code>, to use all the instances</li>
</ul>
            </div>
          </td>
          <td>
                <code>&#39;all&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>axis_limits</code></td>
          <td>
                <code>typing.<span title="typing.Optional">Optional</span>[<span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The limits of the feature effect plot along each axis</p>
<ul>
<li>use a <code>ndarray</code> of shape <code>(2, D)</code>, to specify them manually</li>
<li>use <code>None</code>, to be inferred from the data</li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>data_effect</code></td>
          <td>
                <code>typing.<span title="typing.Optional">Optional</span>[<span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <ul>
<li>if np.ndarray, the model Jacobian computed on the <code>data</code></li>
<li>if None, the Jacobian will be computed using model_jac</li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>avg_output</code></td>
          <td>
                <code>typing.<span title="typing.Optional">Optional</span>[float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the average output of the model on the data</p>
<ul>
<li>use a <code>float</code>, to specify it manually</li>
<li>use <code>None</code>, to be inferred as <code>np.mean(model(data))</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>feature_names</code></td>
          <td>
                <code>typing.<span title="typing.Optional">Optional</span>[list]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The names of the features</p>
<ul>
<li>use a <code>list</code> of <code>str</code>, to specify the name manually. For example: <code>["age", "weight", ...]</code></li>
<li>use <code>None</code>, to keep the default names: <code>["x_0", "x_1", ...]</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>target_name</code></td>
          <td>
                <code>typing.<span title="typing.Optional">Optional</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the target variable</p>
<ul>
<li>use a <code>str</code>, to specify it name manually. For example: <code>"price"</code></li>
<li>use <code>None</code>, to keep the default name: <code>"y"</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_ale.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
        <span class="n">model_jac</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nof_instances</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">axis_limits</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">data_effect</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">avg_output</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_name</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructor for RHALE.</span>

<span class="sd">    Definition:</span>
<span class="sd">        RHALE is defined as:</span>
<span class="sd">        $$</span>
<span class="sd">        \hat{f}^{RHALE}(x_s) = TODO</span>
<span class="sd">        $$</span>

<span class="sd">        The heterogeneity is:</span>
<span class="sd">        $$</span>
<span class="sd">        TODO</span>
<span class="sd">        $$</span>

<span class="sd">        The std of the bin-effects is:</span>
<span class="sd">        $$</span>
<span class="sd">        TODO</span>
<span class="sd">        $$</span>

<span class="sd">    Notes:</span>
<span class="sd">        The required parameters are `data` and `model`. The rest are optional.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: the design matrix</span>

<span class="sd">            - shape: `(N,D)`</span>
<span class="sd">        model: the black-box model. Must be a `Callable` with:</span>

<span class="sd">            - input: `ndarray` of shape `(N, D)`</span>
<span class="sd">            - output: `ndarray` of shape `(N, )`</span>

<span class="sd">        model_jac: the Jacobian of the model. Must be a `Callable` with:</span>

<span class="sd">            - input: `ndarray` of shape `(N, D)`</span>
<span class="sd">            - output: `ndarray` of shape `(N, D)`</span>

<span class="sd">        nof_instances: the number of instances to use for the explanation</span>

<span class="sd">            - use an `int`, to specify the number of instances</span>
<span class="sd">            - use `&quot;all&quot;`, to use all the instances</span>

<span class="sd">        axis_limits: The limits of the feature effect plot along each axis</span>

<span class="sd">            - use a `ndarray` of shape `(2, D)`, to specify them manually</span>
<span class="sd">            - use `None`, to be inferred from the data</span>

<span class="sd">        data_effect:</span>
<span class="sd">            - if np.ndarray, the model Jacobian computed on the `data`</span>
<span class="sd">            - if None, the Jacobian will be computed using model_jac</span>

<span class="sd">        avg_output: the average output of the model on the data</span>

<span class="sd">            - use a `float`, to specify it manually</span>
<span class="sd">            - use `None`, to be inferred as `np.mean(model(data))`</span>

<span class="sd">        feature_names: The names of the features</span>

<span class="sd">            - use a `list` of `str`, to specify the name manually. For example: `[&quot;age&quot;, &quot;weight&quot;, ...]`</span>
<span class="sd">            - use `None`, to keep the default names: `[&quot;x_0&quot;, &quot;x_1&quot;, ...]`</span>

<span class="sd">        target_name: The name of the target variable</span>

<span class="sd">            - use a `str`, to specify it name manually. For example: `&quot;price&quot;`</span>
<span class="sd">            - use `None`, to keep the default name: `&quot;y&quot;`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model_jac</span> <span class="o">=</span> <span class="n">model_jac</span>

    <span class="c1"># select nof_instances from the data</span>
    <span class="n">nof_instances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_nof_instances</span><span class="p">(</span><span class="n">nof_instances</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">data_effect</span> <span class="o">=</span> <span class="n">data_effect</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="p">:]</span> <span class="k">if</span> <span class="n">data_effect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_effect</span> <span class="o">=</span> <span class="n">data_effect</span>

    <span class="nb">super</span><span class="p">(</span><span class="n">RHALE</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">axis_limits</span><span class="p">,</span> <span class="n">avg_output</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="n">target_name</span><span class="p">,</span> <span class="s2">&quot;RHALE&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.global_effect_ale.RHALE.fit">
<code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">binning_method</span><span class="o">=</span><span class="s1">&#39;greedy&#39;</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Fit the model.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>features</code></td>
          <td>
                <code>int, str, list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the features to fit.</p>
<ul>
<li>If set to "all", all the features will be fitted.</li>
</ul>
            </div>
          </td>
          <td>
                <code>&#39;all&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>binning_method</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the binning method to use.</p>
<ul>
<li>Use <code>"greedy"</code> for using the Greedy binning solution with the default parameters.
  For custom parameters initialize a <code>binning_methods.Greedy</code> object</li>
<li>Use <code>"dp"</code> for using a Dynamic Programming binning solution with the default parameters.
  For custom parameters initialize a <code>binning_methods.DynamicProgramming</code> object</li>
<li>Use <code>"fixed"</code> for using a Fixed binning solution with the default parameters.
  For custom parameters initialize a <code>binning_methods.Fixed</code> object</li>
</ul>
            </div>
          </td>
          <td>
                <code>&#39;greedy&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>centering</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[bool, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to compute the normalization constant for centering the plot:</p>
<ul>
<li><code>False</code> means no centering</li>
<li><code>True</code> or <code>zero_integral</code> centers around the <code>y</code> axis</li>
<li><code>zero_start</code> starts the plot from <code>y=0</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_ale.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">features</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="n">binning_method</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">DynamicProgramming</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">Greedy</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">Fixed</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;greedy&quot;</span><span class="p">,</span>
    <span class="n">centering</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit the model.</span>

<span class="sd">    Args:</span>
<span class="sd">        features (int, str, list): the features to fit.</span>

<span class="sd">            - If set to &quot;all&quot;, all the features will be fitted.</span>

<span class="sd">        binning_method (str): the binning method to use.</span>

<span class="sd">            - Use `&quot;greedy&quot;` for using the Greedy binning solution with the default parameters.</span>
<span class="sd">              For custom parameters initialize a `binning_methods.Greedy` object</span>
<span class="sd">            - Use `&quot;dp&quot;` for using a Dynamic Programming binning solution with the default parameters.</span>
<span class="sd">              For custom parameters initialize a `binning_methods.DynamicProgramming` object</span>
<span class="sd">            - Use `&quot;fixed&quot;` for using a Fixed binning solution with the default parameters.</span>
<span class="sd">              For custom parameters initialize a `binning_methods.Fixed` object</span>

<span class="sd">        centering: whether to compute the normalization constant for centering the plot:</span>

<span class="sd">            - `False` means no centering</span>
<span class="sd">            - `True` or `zero_integral` centers around the `y` axis</span>
<span class="sd">            - `zero_start` starts the plot from `y=0`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">binning_method</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="s2">&quot;greedy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dynamic&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span>
    <span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
        <span class="n">binning_method</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">Greedy</span>
    <span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
        <span class="n">binning_method</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">DynamicProgramming</span>
    <span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
        <span class="n">binning_method</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">Fixed</span>
    <span class="p">),</span> <span class="s2">&quot;Unknown binning method!&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_fit_loop</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">binning_method</span><span class="p">,</span> <span class="n">centering</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="effector.global_effect_pdp.PDPBase">
        <code>effector.global_effect_pdp.PDPBase</code>


</h2>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><span title="effector.global_effect.GlobalEffectBase">GlobalEffectBase</span></code></p>



        <details class="quote">
          <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_pdp.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PDPBase</span><span class="p">(</span><span class="n">GlobalEffectBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
        <span class="n">model_jac</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">axis_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">avg_output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nof_instances</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">method_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;PDP&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor of the PDPBase class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model_jac</span> <span class="o">=</span> <span class="n">model_jac</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">PDPBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">method_name</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">model</span><span class="p">,</span> <span class="n">nof_instances</span><span class="p">,</span> <span class="n">axis_limits</span><span class="p">,</span> <span class="n">avg_output</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="n">target_name</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">feature</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">==</span> <span class="s2">&quot;pdp&quot;</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">pdp_1d_vectorized</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_jac</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">pdp_1d_vectorized</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_jac</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">pdp_1d_vectorized</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">_fit_feature</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">centering</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">points_for_centering</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

        <span class="c1"># drop points outside of limits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="n">feature</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">feature</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="n">feature</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">feature</span><span class="p">]]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

        <span class="k">if</span> <span class="n">centering</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">centering</span> <span class="o">==</span> <span class="s2">&quot;zero_integral&quot;</span><span class="p">:</span>
            <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">feature</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">feature</span><span class="p">],</span>
                <span class="n">points_for_centering</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">feature</span><span class="p">)</span>
            <span class="n">norm_const</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">fe</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;norm_const&quot;</span><span class="p">:</span> <span class="n">norm_const</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">centering</span> <span class="o">==</span> <span class="s2">&quot;zero_start&quot;</span><span class="p">:</span>
            <span class="n">xx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">feature</span><span class="p">)</span>
            <span class="n">fe</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;norm_const&quot;</span><span class="p">:</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fe</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;norm_const&quot;</span><span class="p">:</span> <span class="n">helpers</span><span class="o">.</span><span class="n">EMPTY_SYMBOL</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">fe</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">centering</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">points_for_centering</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit the PDP or d-PDP.</span>

<span class="sd">        Notes:</span>
<span class="sd">            You can use `.eval` or `.plot` without calling `.fit` explicitly.</span>
<span class="sd">            The only thing that `.fit` does is to compute the normalization constant for centering the PDP and ICE plots.</span>
<span class="sd">            This will be automatically done when calling `eval` or `plot`, so there is no need to call `fit` explicitly.</span>

<span class="sd">        Args:</span>
<span class="sd">            features: the features to fit.</span>
<span class="sd">                - If set to &quot;all&quot;, all the features will be fitted.</span>

<span class="sd">            centering: whether to center the plot:</span>

<span class="sd">                - `False` means no centering</span>
<span class="sd">                - `True` or `zero_integral` centers around the `y` axis.</span>
<span class="sd">                - `zero_start` starts the plot from `y=0`.</span>

<span class="sd">            points_for_centering: number of linspaced points along the feature axis used for centering.</span>

<span class="sd">                - If set to `&quot;all&quot;`, all the dataset points will be used.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">centering</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_centering</span><span class="p">(</span><span class="n">centering</span><span class="p">)</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_features</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_feature</span><span class="p">(</span>
                <span class="n">s</span><span class="p">,</span> <span class="n">centering</span><span class="p">,</span> <span class="n">points_for_centering</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_fitted</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_args</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;centering&quot;</span><span class="p">:</span> <span class="n">centering</span><span class="p">,</span>
                <span class="s2">&quot;points_for_centering&quot;</span><span class="p">:</span> <span class="n">points_for_centering</span><span class="p">,</span>
            <span class="p">}</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">xs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">heterogeneity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">centering</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">return_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate the effect of the s-th feature at positions `xs`.</span>

<span class="sd">        Args:</span>
<span class="sd">            feature: index of feature of interest</span>
<span class="sd">            xs: the points along the s-th axis to evaluate the FE plot</span>

<span class="sd">              - `np.ndarray` of shape `(T, )`</span>

<span class="sd">            heterogeneity: whether to return the heterogeneity measures.</span>

<span class="sd">                  - if `heterogeneity=False`, the function returns the mean effect at the given `xs`</span>
<span class="sd">                  - If `heterogeneity=True`, the function returns `(y, std)` where `y` is the mean effect and `std` is the standard deviation of the mean effect</span>

<span class="sd">            centering: whether to center the PDP</span>

<span class="sd">                - If `centering` is `False`, the PDP not centered</span>
<span class="sd">                - If `centering` is `True` or `zero_integral`, the PDP is centered around the `y` axis.</span>
<span class="sd">                - If `centering` is `zero_start`, the PDP starts from `y=0`.</span>

<span class="sd">            return_all: whether to return PDP and ICE plots evaluated at `xs`</span>

<span class="sd">                - If `return_all=False`, the function returns the mean effect at the given `xs`</span>
<span class="sd">                - If `return_all=True`, the function returns a `ndarray` of shape `(T, N)` with the `N` ICE plots evaluated at `xs`</span>

<span class="sd">        Returns:</span>
<span class="sd">            the mean effect `y`, if `heterogeneity=False` (default) or a tuple `(y, std)` otherwise</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">centering</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_centering</span><span class="p">(</span><span class="n">centering</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">centering</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="n">centering</span><span class="p">)</span>

        <span class="c1"># Check if the lower bound is less than the upper bound</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">feature</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">feature</span><span class="p">]</span>

        <span class="c1"># new implementation</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">feature</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">centering</span><span class="p">:</span>
            <span class="n">norm_consts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;norm_const&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>
            <span class="n">yy</span> <span class="o">=</span> <span class="n">yy</span> <span class="o">-</span> <span class="n">norm_consts</span>

        <span class="n">y_pdp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">yy</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">return_all</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">yy</span>

        <span class="k">if</span> <span class="n">heterogeneity</span><span class="p">:</span>
            <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">yy</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">y_pdp</span><span class="p">,</span> <span class="n">std</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">y_pdp</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">heterogeneity</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">centering</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">nof_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
        <span class="n">scale_x</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scale_y</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nof_ice</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">show_avg_output</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">y_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the PDP or d-PDP.</span>

<span class="sd">        Args:</span>
<span class="sd">            feature: index of the plotted feature</span>
<span class="sd">            heterogeneity: whether to output the heterogeneity of the SHAP values</span>

<span class="sd">                - If `heterogeneity` is `False`, no heterogeneity is plotted</span>
<span class="sd">                - If `heterogeneity` is `True` or `&quot;std&quot;`, the standard deviation of the shap values is plotted</span>
<span class="sd">                - If `heterogeneity` is `ice`, the ICE plots are plotted</span>

<span class="sd">            centering: whether to center the PDP</span>

<span class="sd">                - If `centering` is `False`, the PDP not centered</span>
<span class="sd">                - If `centering` is `True` or `zero_integral`, the PDP is centered around the `y` axis.</span>
<span class="sd">                - If `centering` is `zero_start`, the PDP starts from `y=0`.</span>

<span class="sd">            nof_points: number of points to evaluate the SDP plot</span>
<span class="sd">            scale_x: dictionary with keys &quot;mean&quot; and &quot;std&quot; for scaling the x-axis</span>
<span class="sd">            scale_y: dictionary with keys &quot;mean&quot; and &quot;std&quot; for scaling the y-axis</span>
<span class="sd">            nof_ice: number of shap values to show on top of the SHAP curve</span>
<span class="sd">            show_avg_output: whether to show the average output of the model</span>
<span class="sd">            y_limits: limits of the y-axis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">heterogeneity</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_confidence_interval</span><span class="p">(</span><span class="n">heterogeneity</span><span class="p">)</span>
        <span class="n">centering</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_centering</span><span class="p">(</span><span class="n">centering</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">feature</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">feature</span><span class="p">],</span> <span class="n">nof_points</span>
        <span class="p">)</span>

        <span class="n">yy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span>
            <span class="n">feature</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="n">centering</span><span class="p">,</span> <span class="n">return_all</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">show_avg_output</span><span class="p">:</span>
            <span class="n">avg_output</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_avg_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_output</span><span class="p">,</span> <span class="n">scale_y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">avg_output</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;PDP&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">==</span> <span class="s2">&quot;pdp&quot;</span> <span class="k">else</span> <span class="s2">&quot;d-PDP&quot;</span>
        <span class="n">vis</span><span class="o">.</span><span class="n">plot_pdp_ice</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span>
            <span class="n">feature</span><span class="p">,</span>
            <span class="n">yy</span><span class="o">=</span><span class="n">yy</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">confidence_interval</span><span class="o">=</span><span class="n">heterogeneity</span><span class="p">,</span>
            <span class="n">y_pdp_label</span><span class="o">=</span><span class="s2">&quot;PDP&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">==</span> <span class="s2">&quot;pdp&quot;</span> <span class="k">else</span> <span class="s2">&quot;d-PDP&quot;</span><span class="p">,</span>
            <span class="n">y_ice_label</span><span class="o">=</span><span class="s2">&quot;ICE&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">==</span> <span class="s2">&quot;pdp&quot;</span> <span class="k">else</span> <span class="s2">&quot;d-ICE&quot;</span><span class="p">,</span>
            <span class="n">scale_x</span><span class="o">=</span><span class="n">scale_x</span><span class="p">,</span>
            <span class="n">scale_y</span><span class="o">=</span><span class="n">scale_y</span><span class="p">,</span>
            <span class="n">avg_output</span><span class="o">=</span><span class="n">avg_output</span><span class="p">,</span>
            <span class="n">feature_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">,</span>
            <span class="n">target_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_name</span><span class="p">,</span>
            <span class="n">nof_ice</span><span class="o">=</span><span class="n">nof_ice</span><span class="p">,</span>
            <span class="n">y_limits</span><span class="o">=</span><span class="n">y_limits</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.global_effect_pdp.PDPBase.fit">
<code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">points_for_centering</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Fit the PDP or d-PDP.</p>

<details class="notes" open>
  <summary>Notes</summary>
  <p>You can use <code>.eval</code> or <code>.plot</code> without calling <code>.fit</code> explicitly.
The only thing that <code>.fit</code> does is to compute the normalization constant for centering the PDP and ICE plots.
This will be automatically done when calling <code>eval</code> or <code>plot</code>, so there is no need to call <code>fit</code> explicitly.</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>features</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[int, str, list]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the features to fit.
- If set to "all", all the features will be fitted.</p>
            </div>
          </td>
          <td>
                <code>&#39;all&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>centering</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[bool, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to center the plot:</p>
<ul>
<li><code>False</code> means no centering</li>
<li><code>True</code> or <code>zero_integral</code> centers around the <code>y</code> axis.</li>
<li><code>zero_start</code> starts the plot from <code>y=0</code>.</li>
</ul>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>points_for_centering</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>number of linspaced points along the feature axis used for centering.</p>
<ul>
<li>If set to <code>"all"</code>, all the dataset points will be used.</li>
</ul>
            </div>
          </td>
          <td>
                <code>100</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_pdp.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">features</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="n">centering</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">points_for_centering</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit the PDP or d-PDP.</span>

<span class="sd">    Notes:</span>
<span class="sd">        You can use `.eval` or `.plot` without calling `.fit` explicitly.</span>
<span class="sd">        The only thing that `.fit` does is to compute the normalization constant for centering the PDP and ICE plots.</span>
<span class="sd">        This will be automatically done when calling `eval` or `plot`, so there is no need to call `fit` explicitly.</span>

<span class="sd">    Args:</span>
<span class="sd">        features: the features to fit.</span>
<span class="sd">            - If set to &quot;all&quot;, all the features will be fitted.</span>

<span class="sd">        centering: whether to center the plot:</span>

<span class="sd">            - `False` means no centering</span>
<span class="sd">            - `True` or `zero_integral` centers around the `y` axis.</span>
<span class="sd">            - `zero_start` starts the plot from `y=0`.</span>

<span class="sd">        points_for_centering: number of linspaced points along the feature axis used for centering.</span>

<span class="sd">            - If set to `&quot;all&quot;`, all the dataset points will be used.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">centering</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_centering</span><span class="p">(</span><span class="n">centering</span><span class="p">)</span>
    <span class="n">features</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_features</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_feature</span><span class="p">(</span>
            <span class="n">s</span><span class="p">,</span> <span class="n">centering</span><span class="p">,</span> <span class="n">points_for_centering</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_fitted</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_args</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;centering&quot;</span><span class="p">:</span> <span class="n">centering</span><span class="p">,</span>
            <span class="s2">&quot;points_for_centering&quot;</span><span class="p">:</span> <span class="n">points_for_centering</span><span class="p">,</span>
        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.global_effect_pdp.PDPBase.eval">
<code class="highlight language-python"><span class="nb">eval</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_all</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Evaluate the effect of the s-th feature at positions <code>xs</code>.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>feature</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>index of feature of interest</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>xs</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the points along the s-th axis to evaluate the FE plot</p>
<ul>
<li><code>np.ndarray</code> of shape <code>(T, )</code></li>
</ul>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>heterogeneity</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to return the heterogeneity measures.</p>
<ul>
<li>if <code>heterogeneity=False</code>, the function returns the mean effect at the given <code>xs</code></li>
<li>If <code>heterogeneity=True</code>, the function returns <code>(y, std)</code> where <code>y</code> is the mean effect and <code>std</code> is the standard deviation of the mean effect</li>
</ul>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>centering</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[bool, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to center the PDP</p>
<ul>
<li>If <code>centering</code> is <code>False</code>, the PDP not centered</li>
<li>If <code>centering</code> is <code>True</code> or <code>zero_integral</code>, the PDP is centered around the <code>y</code> axis.</li>
<li>If <code>centering</code> is <code>zero_start</code>, the PDP starts from <code>y=0</code>.</li>
</ul>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>return_all</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to return PDP and ICE plots evaluated at <code>xs</code></p>
<ul>
<li>If <code>return_all=False</code>, the function returns the mean effect at the given <code>xs</code></li>
<li>If <code>return_all=True</code>, the function returns a <code>ndarray</code> of shape <code>(T, N)</code> with the <code>N</code> ICE plots evaluated at <code>xs</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[<span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>, typing.<span title="typing.Tuple">Tuple</span>[<span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>, <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the mean effect <code>y</code>, if <code>heterogeneity=False</code> (default) or a tuple <code>(y, std)</code> otherwise</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_pdp.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">eval</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">xs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">heterogeneity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">centering</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">return_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluate the effect of the s-th feature at positions `xs`.</span>

<span class="sd">    Args:</span>
<span class="sd">        feature: index of feature of interest</span>
<span class="sd">        xs: the points along the s-th axis to evaluate the FE plot</span>

<span class="sd">          - `np.ndarray` of shape `(T, )`</span>

<span class="sd">        heterogeneity: whether to return the heterogeneity measures.</span>

<span class="sd">              - if `heterogeneity=False`, the function returns the mean effect at the given `xs`</span>
<span class="sd">              - If `heterogeneity=True`, the function returns `(y, std)` where `y` is the mean effect and `std` is the standard deviation of the mean effect</span>

<span class="sd">        centering: whether to center the PDP</span>

<span class="sd">            - If `centering` is `False`, the PDP not centered</span>
<span class="sd">            - If `centering` is `True` or `zero_integral`, the PDP is centered around the `y` axis.</span>
<span class="sd">            - If `centering` is `zero_start`, the PDP starts from `y=0`.</span>

<span class="sd">        return_all: whether to return PDP and ICE plots evaluated at `xs`</span>

<span class="sd">            - If `return_all=False`, the function returns the mean effect at the given `xs`</span>
<span class="sd">            - If `return_all=True`, the function returns a `ndarray` of shape `(T, N)` with the `N` ICE plots evaluated at `xs`</span>

<span class="sd">    Returns:</span>
<span class="sd">        the mean effect `y`, if `heterogeneity=False` (default) or a tuple `(y, std)` otherwise</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">centering</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_centering</span><span class="p">(</span><span class="n">centering</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">centering</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="n">centering</span><span class="p">)</span>

    <span class="c1"># Check if the lower bound is less than the upper bound</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">feature</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">feature</span><span class="p">]</span>

    <span class="c1"># new implementation</span>
    <span class="n">yy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">feature</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">centering</span><span class="p">:</span>
        <span class="n">norm_consts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;norm_const&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="n">yy</span> <span class="o">-</span> <span class="n">norm_consts</span>

    <span class="n">y_pdp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">yy</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_all</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">yy</span>

    <span class="k">if</span> <span class="n">heterogeneity</span><span class="p">:</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">yy</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y_pdp</span><span class="p">,</span> <span class="n">std</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">y_pdp</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.global_effect_pdp.PDPBase.plot">
<code class="highlight language-python"><span class="n">plot</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nof_points</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">scale_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nof_ice</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">show_avg_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">y_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Plot the PDP or d-PDP.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>feature</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>index of the plotted feature</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>heterogeneity</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[bool, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to output the heterogeneity of the SHAP values</p>
<ul>
<li>If <code>heterogeneity</code> is <code>False</code>, no heterogeneity is plotted</li>
<li>If <code>heterogeneity</code> is <code>True</code> or <code>"std"</code>, the standard deviation of the shap values is plotted</li>
<li>If <code>heterogeneity</code> is <code>ice</code>, the ICE plots are plotted</li>
</ul>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>centering</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[bool, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to center the PDP</p>
<ul>
<li>If <code>centering</code> is <code>False</code>, the PDP not centered</li>
<li>If <code>centering</code> is <code>True</code> or <code>zero_integral</code>, the PDP is centered around the <code>y</code> axis.</li>
<li>If <code>centering</code> is <code>zero_start</code>, the PDP starts from <code>y=0</code>.</li>
</ul>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>nof_points</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>number of points to evaluate the SDP plot</p>
            </div>
          </td>
          <td>
                <code>30</code>
          </td>
        </tr>
        <tr>
          <td><code>scale_x</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[dict]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dictionary with keys "mean" and "std" for scaling the x-axis</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>scale_y</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[dict]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dictionary with keys "mean" and "std" for scaling the y-axis</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>nof_ice</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[int, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>number of shap values to show on top of the SHAP curve</p>
            </div>
          </td>
          <td>
                <code>&#39;all&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>show_avg_output</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to show the average output of the model</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>y_limits</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>limits of the y-axis</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_pdp.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">heterogeneity</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">centering</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">nof_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">scale_x</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">scale_y</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">nof_ice</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="n">show_avg_output</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">y_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the PDP or d-PDP.</span>

<span class="sd">    Args:</span>
<span class="sd">        feature: index of the plotted feature</span>
<span class="sd">        heterogeneity: whether to output the heterogeneity of the SHAP values</span>

<span class="sd">            - If `heterogeneity` is `False`, no heterogeneity is plotted</span>
<span class="sd">            - If `heterogeneity` is `True` or `&quot;std&quot;`, the standard deviation of the shap values is plotted</span>
<span class="sd">            - If `heterogeneity` is `ice`, the ICE plots are plotted</span>

<span class="sd">        centering: whether to center the PDP</span>

<span class="sd">            - If `centering` is `False`, the PDP not centered</span>
<span class="sd">            - If `centering` is `True` or `zero_integral`, the PDP is centered around the `y` axis.</span>
<span class="sd">            - If `centering` is `zero_start`, the PDP starts from `y=0`.</span>

<span class="sd">        nof_points: number of points to evaluate the SDP plot</span>
<span class="sd">        scale_x: dictionary with keys &quot;mean&quot; and &quot;std&quot; for scaling the x-axis</span>
<span class="sd">        scale_y: dictionary with keys &quot;mean&quot; and &quot;std&quot; for scaling the y-axis</span>
<span class="sd">        nof_ice: number of shap values to show on top of the SHAP curve</span>
<span class="sd">        show_avg_output: whether to show the average output of the model</span>
<span class="sd">        y_limits: limits of the y-axis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">heterogeneity</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_confidence_interval</span><span class="p">(</span><span class="n">heterogeneity</span><span class="p">)</span>
    <span class="n">centering</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_centering</span><span class="p">(</span><span class="n">centering</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">feature</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">feature</span><span class="p">],</span> <span class="n">nof_points</span>
    <span class="p">)</span>

    <span class="n">yy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span>
        <span class="n">feature</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="n">centering</span><span class="p">,</span> <span class="n">return_all</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">show_avg_output</span><span class="p">:</span>
        <span class="n">avg_output</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_avg_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_output</span><span class="p">,</span> <span class="n">scale_y</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">avg_output</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;PDP&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">==</span> <span class="s2">&quot;pdp&quot;</span> <span class="k">else</span> <span class="s2">&quot;d-PDP&quot;</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">plot_pdp_ice</span><span class="p">(</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">feature</span><span class="p">,</span>
        <span class="n">yy</span><span class="o">=</span><span class="n">yy</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">confidence_interval</span><span class="o">=</span><span class="n">heterogeneity</span><span class="p">,</span>
        <span class="n">y_pdp_label</span><span class="o">=</span><span class="s2">&quot;PDP&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">==</span> <span class="s2">&quot;pdp&quot;</span> <span class="k">else</span> <span class="s2">&quot;d-PDP&quot;</span><span class="p">,</span>
        <span class="n">y_ice_label</span><span class="o">=</span><span class="s2">&quot;ICE&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">==</span> <span class="s2">&quot;pdp&quot;</span> <span class="k">else</span> <span class="s2">&quot;d-ICE&quot;</span><span class="p">,</span>
        <span class="n">scale_x</span><span class="o">=</span><span class="n">scale_x</span><span class="p">,</span>
        <span class="n">scale_y</span><span class="o">=</span><span class="n">scale_y</span><span class="p">,</span>
        <span class="n">avg_output</span><span class="o">=</span><span class="n">avg_output</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">,</span>
        <span class="n">target_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_name</span><span class="p">,</span>
        <span class="n">nof_ice</span><span class="o">=</span><span class="n">nof_ice</span><span class="p">,</span>
        <span class="n">y_limits</span><span class="o">=</span><span class="n">y_limits</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="effector.global_effect_pdp.PDP">
        <code>effector.global_effect_pdp.PDP</code>


</h2>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="effector.global_effect_pdp.PDPBase" href="#effector.global_effect_pdp.PDPBase">PDPBase</a></code></p>



        <details class="quote">
          <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_pdp.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PDP</span><span class="p">(</span><span class="n">PDPBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
        <span class="n">axis_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nof_instances</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
        <span class="n">avg_output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor of the PDP class.</span>

<span class="sd">        Definition:</span>
<span class="sd">            PDP is defined as:</span>
<span class="sd">            $$</span>
<span class="sd">            \hat{f}^{PDP}(x_s) = {1 \over N} \sum_{i=1}^N f(x_s, x_C^{(i)})b</span>
<span class="sd">            $$</span>

<span class="sd">            The ICE plots are:</span>
<span class="sd">            $$</span>
<span class="sd">            \hat{f}^{(i)}(x_s) = f(x_s, x_C^{(i)}), \quad i=1, \dots, N</span>
<span class="sd">            $$</span>

<span class="sd">            The heterogeneity is:</span>
<span class="sd">            $$</span>
<span class="sd">            \mathcal{H}^{PDP}(x_s) = \sqrt {{1 \over N} \sum_{i=1}^N ( \hat{f}^{(i)}(x_s) - \hat{f}^{PDP}(x_s) )^2}</span>
<span class="sd">            $$</span>

<span class="sd">        Notes:</span>
<span class="sd">            The required parameters are `data` and `model`. The rest are optional.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: the design matrix</span>

<span class="sd">                - shape: `(N,D)`</span>
<span class="sd">            model: the black-box model. Must be a `Callable` with:</span>

<span class="sd">                - input: `ndarray` of shape `(N, D)`</span>
<span class="sd">                - output: `ndarray` of shape `(N, )`</span>

<span class="sd">            axis_limits: The limits of the feature effect plot along each axis</span>

<span class="sd">                - use a `ndarray` of shape `(2, D)`, to specify them manually</span>
<span class="sd">                - use `None`, to be inferred from the data</span>

<span class="sd">            nof_instances: maximum number of instances to be used for PDP.</span>

<span class="sd">                - use &quot;all&quot;, for using all instances.</span>
<span class="sd">                - use an `int`, for using `nof_instances` instances.</span>

<span class="sd">            avg_output: The average output of the model.</span>

<span class="sd">                - use a `float`, to specify it manually</span>
<span class="sd">                - use `None`, to be inferred as `np.mean(model(data))`</span>

<span class="sd">            feature_names: The names of the features</span>

<span class="sd">                - use a `list` of `str`, to specify the name manually. For example: `                  [&quot;age&quot;, &quot;weight&quot;, ...]`</span>
<span class="sd">                - use `None`, to keep the default names: `[&quot;x_0&quot;, &quot;x_1&quot;, ...]`</span>

<span class="sd">            target_name: The name of the target variable</span>

<span class="sd">                - use a `str`, to specify it name manually. For example: `&quot;price&quot;`</span>
<span class="sd">                - use `None`, to keep the default name: `&quot;y&quot;`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">PDP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">axis_limits</span><span class="p">,</span> <span class="n">avg_output</span><span class="p">,</span> <span class="n">nof_instances</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="n">target_name</span><span class="p">,</span> <span class="n">method_name</span><span class="o">=</span><span class="s2">&quot;PDP&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.global_effect_pdp.PDP.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">axis_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nof_instances</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">avg_output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Constructor of the PDP class.</p>

<details class="definition" open>
  <summary>Definition</summary>
  <p>PDP is defined as:
$$
\hat{f}^{PDP}(x_s) = {1 \over N} \sum_{i=1}^N f(x_s, x_C^{(i)})b
$$</p>
<p>The ICE plots are:
$$
\hat{f}^{(i)}(x_s) = f(x_s, x_C^{(i)}), \quad i=1, \dots, N
$$</p>
<p>The heterogeneity is:
$$
\mathcal{H}^{PDP}(x_s) = \sqrt {{1 \over N} \sum_{i=1}^N ( \hat{f}^{(i)}(x_s) - \hat{f}^{PDP}(x_s) )^2}
$$</p>
</details>
<details class="notes" open>
  <summary>Notes</summary>
  <p>The required parameters are <code>data</code> and <code>model</code>. The rest are optional.</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the design matrix</p>
<ul>
<li>shape: <code>(N,D)</code></li>
</ul>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model</code></td>
          <td>
                <code><span title="typing.Callable">Callable</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the black-box model. Must be a <code>Callable</code> with:</p>
<ul>
<li>input: <code>ndarray</code> of shape <code>(N, D)</code></li>
<li>output: <code>ndarray</code> of shape <code>(N, )</code></li>
</ul>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>axis_limits</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The limits of the feature effect plot along each axis</p>
<ul>
<li>use a <code>ndarray</code> of shape <code>(2, D)</code>, to specify them manually</li>
<li>use <code>None</code>, to be inferred from the data</li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>nof_instances</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[int, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>maximum number of instances to be used for PDP.</p>
<ul>
<li>use "all", for using all instances.</li>
<li>use an <code>int</code>, for using <code>nof_instances</code> instances.</li>
</ul>
            </div>
          </td>
          <td>
                <code>300</code>
          </td>
        </tr>
        <tr>
          <td><code>avg_output</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The average output of the model.</p>
<ul>
<li>use a <code>float</code>, to specify it manually</li>
<li>use <code>None</code>, to be inferred as <code>np.mean(model(data))</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>feature_names</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The names of the features</p>
<ul>
<li>use a <code>list</code> of <code>str</code>, to specify the name manually. For example: <code>["age", "weight", ...]</code></li>
<li>use <code>None</code>, to keep the default names: <code>["x_0", "x_1", ...]</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>target_name</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the target variable</p>
<ul>
<li>use a <code>str</code>, to specify it name manually. For example: <code>"price"</code></li>
<li>use <code>None</code>, to keep the default name: <code>"y"</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_pdp.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="n">axis_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">nof_instances</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
    <span class="n">avg_output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructor of the PDP class.</span>

<span class="sd">    Definition:</span>
<span class="sd">        PDP is defined as:</span>
<span class="sd">        $$</span>
<span class="sd">        \hat{f}^{PDP}(x_s) = {1 \over N} \sum_{i=1}^N f(x_s, x_C^{(i)})b</span>
<span class="sd">        $$</span>

<span class="sd">        The ICE plots are:</span>
<span class="sd">        $$</span>
<span class="sd">        \hat{f}^{(i)}(x_s) = f(x_s, x_C^{(i)}), \quad i=1, \dots, N</span>
<span class="sd">        $$</span>

<span class="sd">        The heterogeneity is:</span>
<span class="sd">        $$</span>
<span class="sd">        \mathcal{H}^{PDP}(x_s) = \sqrt {{1 \over N} \sum_{i=1}^N ( \hat{f}^{(i)}(x_s) - \hat{f}^{PDP}(x_s) )^2}</span>
<span class="sd">        $$</span>

<span class="sd">    Notes:</span>
<span class="sd">        The required parameters are `data` and `model`. The rest are optional.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: the design matrix</span>

<span class="sd">            - shape: `(N,D)`</span>
<span class="sd">        model: the black-box model. Must be a `Callable` with:</span>

<span class="sd">            - input: `ndarray` of shape `(N, D)`</span>
<span class="sd">            - output: `ndarray` of shape `(N, )`</span>

<span class="sd">        axis_limits: The limits of the feature effect plot along each axis</span>

<span class="sd">            - use a `ndarray` of shape `(2, D)`, to specify them manually</span>
<span class="sd">            - use `None`, to be inferred from the data</span>

<span class="sd">        nof_instances: maximum number of instances to be used for PDP.</span>

<span class="sd">            - use &quot;all&quot;, for using all instances.</span>
<span class="sd">            - use an `int`, for using `nof_instances` instances.</span>

<span class="sd">        avg_output: The average output of the model.</span>

<span class="sd">            - use a `float`, to specify it manually</span>
<span class="sd">            - use `None`, to be inferred as `np.mean(model(data))`</span>

<span class="sd">        feature_names: The names of the features</span>

<span class="sd">            - use a `list` of `str`, to specify the name manually. For example: `                  [&quot;age&quot;, &quot;weight&quot;, ...]`</span>
<span class="sd">            - use `None`, to keep the default names: `[&quot;x_0&quot;, &quot;x_1&quot;, ...]`</span>

<span class="sd">        target_name: The name of the target variable</span>

<span class="sd">            - use a `str`, to specify it name manually. For example: `&quot;price&quot;`</span>
<span class="sd">            - use `None`, to keep the default name: `&quot;y&quot;`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">(</span><span class="n">PDP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">axis_limits</span><span class="p">,</span> <span class="n">avg_output</span><span class="p">,</span> <span class="n">nof_instances</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="n">target_name</span><span class="p">,</span> <span class="n">method_name</span><span class="o">=</span><span class="s2">&quot;PDP&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="effector.global_effect_pdp.DerivativePDP">
        <code>effector.global_effect_pdp.DerivativePDP</code>


</h2>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="effector.global_effect_pdp.PDPBase" href="#effector.global_effect_pdp.PDPBase">PDPBase</a></code></p>



        <details class="quote">
          <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_pdp.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DerivativePDP</span><span class="p">(</span><span class="n">PDPBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
            <span class="n">model</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
            <span class="n">model_jac</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">axis_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">nof_instances</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
            <span class="n">avg_output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">feature_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">target_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor of the DerivativePDP class.</span>

<span class="sd">        Definition:</span>
<span class="sd">            d-PDP is defined as:</span>
<span class="sd">            $$</span>
<span class="sd">            \hat{f}^{d-PDP}(x_s) = {1 \over N} \sum_{i=1}^N {df \over d x_s} (x_s, x_C^i)</span>
<span class="sd">            $$</span>

<span class="sd">            The d-ICE plots are:</span>
<span class="sd">            $$</span>
<span class="sd">            \hat{f}^i(x_s) = {df \over d x_s}(x_s, x_C^i), \quad i=1, \dots, N</span>
<span class="sd">            $$</span>

<span class="sd">            The heterogeneity is:</span>
<span class="sd">            $$</span>
<span class="sd">            \mathcal{H}^{d-PDP}(x_s) = \sqrt {{1 \over N} \sum_{i=1}^N ( \hat{f}^i(x_s) - \hat{f}^{d-PDP}(x_s) )^2}</span>
<span class="sd">            $$</span>

<span class="sd">        Notes:</span>
<span class="sd">            - The required parameters are `data` and `model`. The rest are optional.</span>
<span class="sd">            - The `model_jac` is the Jacobian of the model. If `None`, the Jacobian will be computed numerically.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: the design matrix</span>

<span class="sd">                - shape: `(N,D)`</span>
<span class="sd">            model: the black-box model. Must be a `Callable` with:</span>

<span class="sd">                - input: `ndarray` of shape `(N, D)`</span>
<span class="sd">                - output: `ndarray` of shape `(N, )`</span>

<span class="sd">            model_jac: the black-box model Jacobian. Must be a `Callable` with:</span>

<span class="sd">                - input: `ndarray` of shape `(N, D)`</span>
<span class="sd">                - output: `ndarray` of shape `(N, D)`</span>

<span class="sd">            axis_limits: The limits of the feature effect plot along each axis</span>

<span class="sd">                - use a `ndarray` of shape `(2, D)`, to specify them manually</span>
<span class="sd">                - use `None`, to be inferred from the data</span>

<span class="sd">            nof_instances: maximum number of instances to be used for PDP.</span>

<span class="sd">                - use &quot;all&quot;, for using all instances.</span>
<span class="sd">                - use an `int`, for using `nof_instances` instances.</span>

<span class="sd">            avg_output: The average output of the model.</span>

<span class="sd">                - use a `float`, to specify it manually</span>
<span class="sd">                - use `None`, to be inferred as `np.mean(model(data))`</span>

<span class="sd">            feature_names: The names of the features</span>

<span class="sd">                - use a `list` of `str`, to specify the name manually. For example: `[&quot;age&quot;, &quot;weight&quot;, ...]`</span>
<span class="sd">                - use `None`, to keep the default names: `[&quot;x_0&quot;, &quot;x_1&quot;, ...]`</span>

<span class="sd">            target_name: The name of the target variable</span>

<span class="sd">                - use a `str`, to specify it name manually. For example: `&quot;price&quot;`</span>
<span class="sd">                - use `None`, to keep the default name: `&quot;y&quot;`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">DerivativePDP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">model_jac</span><span class="p">,</span> <span class="n">axis_limits</span><span class="p">,</span> <span class="n">avg_output</span><span class="p">,</span> <span class="n">nof_instances</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="n">target_name</span><span class="p">,</span> <span class="n">method_name</span><span class="o">=</span><span class="s2">&quot;d-PDP&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.global_effect_pdp.DerivativePDP.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">model_jac</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nof_instances</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">avg_output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Constructor of the DerivativePDP class.</p>

<details class="definition" open>
  <summary>Definition</summary>
  <p>d-PDP is defined as:
$$
\hat{f}^{d-PDP}(x_s) = {1 \over N} \sum_{i=1}^N {df \over d x_s} (x_s, x_C^i)
$$</p>
<p>The d-ICE plots are:
$$
\hat{f}^i(x_s) = {df \over d x_s}(x_s, x_C^i), \quad i=1, \dots, N
$$</p>
<p>The heterogeneity is:
$$
\mathcal{H}^{d-PDP}(x_s) = \sqrt {{1 \over N} \sum_{i=1}^N ( \hat{f}^i(x_s) - \hat{f}^{d-PDP}(x_s) )^2}
$$</p>
</details>
<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>The required parameters are <code>data</code> and <code>model</code>. The rest are optional.</li>
<li>The <code>model_jac</code> is the Jacobian of the model. If <code>None</code>, the Jacobian will be computed numerically.</li>
</ul>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the design matrix</p>
<ul>
<li>shape: <code>(N,D)</code></li>
</ul>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model</code></td>
          <td>
                <code><span title="typing.Callable">Callable</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the black-box model. Must be a <code>Callable</code> with:</p>
<ul>
<li>input: <code>ndarray</code> of shape <code>(N, D)</code></li>
<li>output: <code>ndarray</code> of shape <code>(N, )</code></li>
</ul>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model_jac</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.Callable">Callable</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the black-box model Jacobian. Must be a <code>Callable</code> with:</p>
<ul>
<li>input: <code>ndarray</code> of shape <code>(N, D)</code></li>
<li>output: <code>ndarray</code> of shape <code>(N, D)</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>axis_limits</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The limits of the feature effect plot along each axis</p>
<ul>
<li>use a <code>ndarray</code> of shape <code>(2, D)</code>, to specify them manually</li>
<li>use <code>None</code>, to be inferred from the data</li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>nof_instances</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[int, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>maximum number of instances to be used for PDP.</p>
<ul>
<li>use "all", for using all instances.</li>
<li>use an <code>int</code>, for using <code>nof_instances</code> instances.</li>
</ul>
            </div>
          </td>
          <td>
                <code>300</code>
          </td>
        </tr>
        <tr>
          <td><code>avg_output</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The average output of the model.</p>
<ul>
<li>use a <code>float</code>, to specify it manually</li>
<li>use <code>None</code>, to be inferred as <code>np.mean(model(data))</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>feature_names</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The names of the features</p>
<ul>
<li>use a <code>list</code> of <code>str</code>, to specify the name manually. For example: <code>["age", "weight", ...]</code></li>
<li>use <code>None</code>, to keep the default names: <code>["x_0", "x_1", ...]</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>target_name</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the target variable</p>
<ul>
<li>use a <code>str</code>, to specify it name manually. For example: <code>"price"</code></li>
<li>use <code>None</code>, to keep the default name: <code>"y"</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_pdp.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
        <span class="n">model_jac</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">axis_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nof_instances</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
        <span class="n">avg_output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructor of the DerivativePDP class.</span>

<span class="sd">    Definition:</span>
<span class="sd">        d-PDP is defined as:</span>
<span class="sd">        $$</span>
<span class="sd">        \hat{f}^{d-PDP}(x_s) = {1 \over N} \sum_{i=1}^N {df \over d x_s} (x_s, x_C^i)</span>
<span class="sd">        $$</span>

<span class="sd">        The d-ICE plots are:</span>
<span class="sd">        $$</span>
<span class="sd">        \hat{f}^i(x_s) = {df \over d x_s}(x_s, x_C^i), \quad i=1, \dots, N</span>
<span class="sd">        $$</span>

<span class="sd">        The heterogeneity is:</span>
<span class="sd">        $$</span>
<span class="sd">        \mathcal{H}^{d-PDP}(x_s) = \sqrt {{1 \over N} \sum_{i=1}^N ( \hat{f}^i(x_s) - \hat{f}^{d-PDP}(x_s) )^2}</span>
<span class="sd">        $$</span>

<span class="sd">    Notes:</span>
<span class="sd">        - The required parameters are `data` and `model`. The rest are optional.</span>
<span class="sd">        - The `model_jac` is the Jacobian of the model. If `None`, the Jacobian will be computed numerically.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: the design matrix</span>

<span class="sd">            - shape: `(N,D)`</span>
<span class="sd">        model: the black-box model. Must be a `Callable` with:</span>

<span class="sd">            - input: `ndarray` of shape `(N, D)`</span>
<span class="sd">            - output: `ndarray` of shape `(N, )`</span>

<span class="sd">        model_jac: the black-box model Jacobian. Must be a `Callable` with:</span>

<span class="sd">            - input: `ndarray` of shape `(N, D)`</span>
<span class="sd">            - output: `ndarray` of shape `(N, D)`</span>

<span class="sd">        axis_limits: The limits of the feature effect plot along each axis</span>

<span class="sd">            - use a `ndarray` of shape `(2, D)`, to specify them manually</span>
<span class="sd">            - use `None`, to be inferred from the data</span>

<span class="sd">        nof_instances: maximum number of instances to be used for PDP.</span>

<span class="sd">            - use &quot;all&quot;, for using all instances.</span>
<span class="sd">            - use an `int`, for using `nof_instances` instances.</span>

<span class="sd">        avg_output: The average output of the model.</span>

<span class="sd">            - use a `float`, to specify it manually</span>
<span class="sd">            - use `None`, to be inferred as `np.mean(model(data))`</span>

<span class="sd">        feature_names: The names of the features</span>

<span class="sd">            - use a `list` of `str`, to specify the name manually. For example: `[&quot;age&quot;, &quot;weight&quot;, ...]`</span>
<span class="sd">            - use `None`, to keep the default names: `[&quot;x_0&quot;, &quot;x_1&quot;, ...]`</span>

<span class="sd">        target_name: The name of the target variable</span>

<span class="sd">            - use a `str`, to specify it name manually. For example: `&quot;price&quot;`</span>
<span class="sd">            - use `None`, to keep the default name: `&quot;y&quot;`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">(</span><span class="n">DerivativePDP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">model_jac</span><span class="p">,</span> <span class="n">axis_limits</span><span class="p">,</span> <span class="n">avg_output</span><span class="p">,</span> <span class="n">nof_instances</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="n">target_name</span><span class="p">,</span> <span class="n">method_name</span><span class="o">=</span><span class="s2">&quot;d-PDP&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="effector.global_effect_shap.SHAPDependence">
        <code>effector.global_effect_shap.SHAPDependence</code>


</h2>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><span title="effector.global_effect.GlobalEffectBase">GlobalEffectBase</span></code></p>



        <details class="quote">
          <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_shap.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SHAPDependence</span><span class="p">(</span><span class="n">GlobalEffectBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
            <span class="n">model</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
            <span class="n">axis_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">nof_instances</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
            <span class="n">avg_output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">feature_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">target_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor of the SHAPDependence class.</span>

<span class="sd">        Definition:</span>
<span class="sd">            The value of a coalition of $S$ features is estimated as:</span>
<span class="sd">            $$</span>
<span class="sd">            \hat{v}(S) = {1 \over N} \sum_{i=1}^N  f(x_S \cup x_C^i) - f(x^i)</span>
<span class="sd">            $$</span>
<span class="sd">            The value of a coalition $S$ quantifies what the values $\mathbf{x}_S$ of the features in $S$ contribute to the output of the model. It</span>
<span class="sd">            is the average (over all instances) difference on the output between setting features in $S$ to be $x_S$, i.e., $\mathbf{x} = (\mathbf{x}_S, \mathbf{x}_C^i)$ and leaving the instance as it is, i.e., $\mathbf{x}^i = (\mathbf{x}_S^i, \mathbf{x}_C^i)$.</span>

<span class="sd">            The contribution of a feature $j$ added to a coalition $S$ is estimated as:</span>
<span class="sd">            $$</span>
<span class="sd">            \hat{\Delta}_{S, j} = \hat{v}(S \cup \{j\}) - \hat{v}(S)</span>
<span class="sd">            $$</span>

<span class="sd">            The SHAP value of a feature $j$ with value $x_j$ is the average contribution of feature $j$ across all possible coalitions with a weight $w_{S, j}$:</span>

<span class="sd">            $$</span>
<span class="sd">            \hat{\phi}_j(x_j) = {1 \over N} \sum_{S \subseteq \{1, \dots, D\} \setminus \{j\}} w_{S, j} \hat{\Delta}_{S, j}</span>
<span class="sd">            $$</span>

<span class="sd">            where $w_{S, j}$ assures that the contribution of feature $j$ is the same for all coalitions of the same size. For example, there are $D-1$ ways for $x_j$ to enter a coalition of $|S| = 1$ feature, so $w_{S, j} = {1 \over D (D-1)}$ for each of them. In contrast, there is only one way for $x_j$ to enter a coaltion of $|S|=0$ (to be the first specified feature), so $w_{S, j} = {1 \over D}$.</span>

<span class="sd">            The SHAP Dependence Plot (SHAP-DP) is a spline $\hat{f}^{SDP}_j(x_j)$ fit to the dataset $\{(x_j^i, \hat{\phi}_j(x_j^i))\}_{i=1}^N$ using the `UnivariateSpline` function from `scipy.interpolate`.</span>

<span class="sd">        Notes:</span>
<span class="sd">            * The required parameters are `data` and `model`. The rest are optional.</span>
<span class="sd">            * SHAP values are computed using the `shap` package, using the class `Explainer`.</span>
<span class="sd">            * SHAP values are centered by default, i.e., the average SHAP value is subtracted from the SHAP values.</span>
<span class="sd">            * More details on the SHAP values can be found in the [original paper](https://arxiv.org/abs/1705.07874) and in the book [Interpreting Machine Learning Models with SHAP](https://christophmolnar.com/books/shap/)</span>

<span class="sd">        Args:</span>
<span class="sd">            data: the design matrix</span>

<span class="sd">                - shape: `(N,D)`</span>
<span class="sd">            model: the black-box model. Must be a `Callable` with:</span>

<span class="sd">                - input: `ndarray` of shape `(N, D)`</span>
<span class="sd">                - output: `ndarray` of shape `(N,)`</span>

<span class="sd">            axis_limits: The limits of the feature effect plot along each axis</span>

<span class="sd">                - use a `ndarray` of shape `(2, D)`, to specify them manually</span>
<span class="sd">                - use `None`, to be inferred from the data</span>

<span class="sd">            nof_instances: maximum number of instances to be used for SHAP estimation.</span>

<span class="sd">                - use &quot;all&quot;, for using all instances.</span>
<span class="sd">                - use an `int`, for using `nof_instances` instances.</span>

<span class="sd">            avg_output: The average output of the model.</span>

<span class="sd">                - use a `float`, to specify it manually</span>
<span class="sd">                - use `None`, to be inferred as `np.mean(model(data))`</span>

<span class="sd">            feature_names: The names of the features</span>

<span class="sd">                - use a `list` of `str`, to specify the name manually. For example: `                  [&quot;age&quot;, &quot;weight&quot;, ...]`</span>
<span class="sd">                - use `None`, to keep the default names: `[&quot;x_0&quot;, &quot;x_1&quot;, ...]`</span>

<span class="sd">            target_name: The name of the target variable</span>

<span class="sd">                - use a `str`, to specify it name manually. For example: `&quot;price&quot;`</span>
<span class="sd">                - use `None`, to keep the default name: `&quot;y&quot;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nof_instances</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_nof_instances</span><span class="p">(</span>
            <span class="n">nof_instances</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="p">:]</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">SHAPDependence</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="s2">&quot;SHAP DP&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">nof_instances</span><span class="p">,</span> <span class="n">axis_limits</span><span class="p">,</span> <span class="n">avg_output</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="n">target_name</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fit_feature</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">centering</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">points_for_centering</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">:</span>

        <span class="c1"># drop points outside of limits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="n">feature</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">feature</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="n">feature</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">feature</span><span class="p">]]</span>

        <span class="c1"># compute shap values</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">shap_explainer</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">Explainer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">explanation</span> <span class="o">=</span> <span class="n">shap_explainer</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># extract x and y pais</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="n">explanation</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="n">feature</span><span class="p">]</span>
        <span class="n">xx</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">feature</span><span class="p">]</span>

        <span class="c1"># make xx monotonic</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>
        <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="n">yy</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

        <span class="c1"># fit spline_mean to xx, yy pairs</span>
        <span class="n">spline_mean</span> <span class="o">=</span> <span class="n">UnivariateSpline</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>

        <span class="c1"># fit spline_mean to the sqrt of the residuals</span>
        <span class="n">yy_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">yy</span> <span class="o">-</span> <span class="n">spline_mean</span><span class="p">(</span><span class="n">xx</span><span class="p">))</span>
        <span class="n">spline_std</span> <span class="o">=</span> <span class="n">UnivariateSpline</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy_std</span><span class="p">)</span>

        <span class="c1"># compute norm constant</span>
        <span class="k">if</span> <span class="n">centering</span> <span class="o">==</span> <span class="s2">&quot;zero_integral&quot;</span><span class="p">:</span>
            <span class="n">x_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">points_for_centering</span><span class="p">)</span>
            <span class="n">y_norm</span> <span class="o">=</span> <span class="n">spline_mean</span><span class="p">(</span><span class="n">x_norm</span><span class="p">)</span>
            <span class="n">norm_const</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">y_norm</span><span class="p">,</span> <span class="n">x_norm</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">xx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">centering</span> <span class="o">==</span> <span class="s2">&quot;zero_start&quot;</span><span class="p">:</span>
            <span class="n">norm_const</span> <span class="o">=</span> <span class="n">spline_mean</span><span class="p">(</span><span class="n">xx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">norm_const</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">EMPTY_SYMBOL</span>

        <span class="n">ret_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;spline_mean&quot;</span><span class="p">:</span> <span class="n">spline_mean</span><span class="p">,</span>
            <span class="s2">&quot;spline_std&quot;</span><span class="p">:</span> <span class="n">spline_std</span><span class="p">,</span>
            <span class="s2">&quot;xx&quot;</span><span class="p">:</span> <span class="n">xx</span><span class="p">,</span>
            <span class="s2">&quot;yy&quot;</span><span class="p">:</span> <span class="n">yy</span><span class="p">,</span>
            <span class="s2">&quot;norm_const&quot;</span><span class="p">:</span> <span class="n">norm_const</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">ret_dict</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">features</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
            <span class="n">centering</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">points_for_centering</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit the SHAP Dependence Plot to the data.</span>

<span class="sd">        Notes:</span>
<span class="sd">            The SHAP Dependence Plot (SDP) $\hat{f}^{SDP}_j(x_j)$ is a spline fit to</span>
<span class="sd">            the dataset $\{(x_j^i, \hat{\phi}_j(x_j^i))\}_{i=1}^N$</span>
<span class="sd">            using the `UnivariateSpline` function from `scipy.interpolate`.</span>

<span class="sd">            The SHAP standard deviation, $\hat{\sigma}^{SDP}_j(x_j)$, is a spline fit            to the absolute value of the residuals, i.e., to the dataset $\{(x_j^i, |\hat{\phi}_j(x_j^i) - \hat{f}^{SDP}_j(x_j^i)|)\}_{i=1}^N$, using the `UnivariateSpline` function from `scipy.interpolate`.</span>

<span class="sd">        Args:</span>
<span class="sd">            features: the features to fit.</span>
<span class="sd">                - If set to &quot;all&quot;, all the features will be fitted.</span>
<span class="sd">            centering:</span>
<span class="sd">                - If set to False, no centering will be applied.</span>
<span class="sd">                - If set to &quot;zero_integral&quot; or True, the integral of the feature effect will be set to zero.</span>
<span class="sd">                - If set to &quot;zero_mean&quot;, the mean of the feature effect will be set to zero.</span>

<span class="sd">            points_for_centering: number of linspaced points along the feature axis used for centering.</span>

<span class="sd">                - If set to `all`, all the dataset points will be used.</span>

<span class="sd">        Notes:</span>
<span class="sd">            SHAP values are by default centered, i.e., $\sum_{i=1}^N \hat{\phi}_j(x_j^i) = 0$. This does not mean that the SHAP _curve_ is centered around zero; this happens only if the $s$-th feature of the dataset instances, i.e., the set $\{x_s^i\}_{i=1}^N$ is uniformly distributed along the $s$-th axis. So, use:</span>

<span class="sd">            * `centering=False`, to leave the SHAP values as they are.</span>
<span class="sd">            * `centering=True` or `centering=zero_integral`, to center the SHAP curve around the `y` axis.</span>
<span class="sd">            * `centering=zero_start`, to start the SHAP curve from `y=0`.</span>

<span class="sd">            SHAP values are expensive to compute.</span>
<span class="sd">            To speed up the computation consider using a subset of the dataset</span>
<span class="sd">            points for computing the SHAP values and for centering the spline.</span>
<span class="sd">            The default values (`points_for_fitting_spline=100`</span>
<span class="sd">            and `points_for_centering=100`) are a moderate choice.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">centering</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_centering</span><span class="p">(</span><span class="n">centering</span><span class="p">)</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_features</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>

        <span class="c1"># new implementation</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_feature</span><span class="p">(</span>
                <span class="n">s</span><span class="p">,</span> <span class="n">centering</span><span class="p">,</span> <span class="n">points_for_centering</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_fitted</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_args</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;centering&quot;</span><span class="p">:</span> <span class="n">centering</span><span class="p">,</span>
                <span class="s2">&quot;points_for_centering&quot;</span><span class="p">:</span> <span class="n">points_for_centering</span><span class="p">,</span>
            <span class="p">}</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">xs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">heterogeneity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">centering</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate the effect of the s-th feature at positions `xs`.</span>

<span class="sd">        Args:</span>
<span class="sd">            feature: index of feature of interest</span>
<span class="sd">            xs: the points along the s-th axis to evaluate the FE plot</span>

<span class="sd">              - `np.ndarray` of shape `(T,)`</span>
<span class="sd">            heterogeneity: whether to return the heterogeneity measures.</span>

<span class="sd">                  - if `heterogeneity=False`, the function returns the mean effect at the given `xs`</span>
<span class="sd">                  - If `heterogeneity=True`, the function returns `(y, std)` where `y` is the mean effect and `std` is the standard deviation of the mean effect</span>

<span class="sd">            centering: whether to center the plot</span>

<span class="sd">                - If `centering` is `False`, the SHAP curve is not centered</span>
<span class="sd">                - If `centering` is `True` or `zero_integral`, the SHAP curve is centered around the `y` axis.</span>
<span class="sd">                - If `centering` is `zero_start`, the SHAP curve starts from `y=0`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            the mean effect `y`, if `heterogeneity=False` (default) or a tuple `(y, std, estimator_var)` otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">centering</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_centering</span><span class="p">(</span><span class="n">centering</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">centering</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="n">centering</span><span class="p">)</span>

        <span class="c1"># Check if the lower bound is less than the upper bound</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">feature</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">feature</span><span class="p">]</span>

        <span class="n">yy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;spline_mean&quot;</span><span class="p">](</span><span class="n">xs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">centering</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">norm_const</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;norm_const&quot;</span><span class="p">]</span>
            <span class="n">yy</span> <span class="o">=</span> <span class="n">yy</span> <span class="o">-</span> <span class="n">norm_const</span>

        <span class="k">if</span> <span class="n">heterogeneity</span><span class="p">:</span>
            <span class="n">yy_std</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;spline_std&quot;</span><span class="p">](</span><span class="n">xs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">yy</span><span class="p">,</span> <span class="n">yy_std</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">yy</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">heterogeneity</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">centering</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">nof_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
        <span class="n">scale_x</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scale_y</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nof_shap_values</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">show_avg_output</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">y_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the SHAP Dependence Plot (SDP) of the s-th feature.</span>

<span class="sd">        Args:</span>
<span class="sd">            feature: index of the plotted feature</span>
<span class="sd">            heterogeneity: whether to output the heterogeneity of the SHAP values</span>

<span class="sd">                - If `heterogeneity` is `False`, no heterogeneity is plotted</span>
<span class="sd">                - If `heterogeneity` is `True` or `&quot;std&quot;`, the standard deviation of the shap values is plotted</span>
<span class="sd">                - If `heterogeneity` is `&quot;shap_values&quot;`, the shap values are scattered on top of the SHAP curve</span>

<span class="sd">            centering: whether to center the SDP</span>

<span class="sd">                - If `centering` is `False`, the SHAP curve is not centered</span>
<span class="sd">                - If `centering` is `True` or `zero_integral`, the SHAP curve is centered around the `y` axis.</span>
<span class="sd">                - If `centering` is `zero_start`, the SHAP curve starts from `y=0`.</span>

<span class="sd">            nof_points: number of points to evaluate the SDP plot</span>
<span class="sd">            scale_x: dictionary with keys &quot;mean&quot; and &quot;std&quot; for scaling the x-axis</span>
<span class="sd">            scale_y: dictionary with keys &quot;mean&quot; and &quot;std&quot; for scaling the y-axis</span>
<span class="sd">            nof_shap_values: number of shap values to show on top of the SHAP curve</span>
<span class="sd">            show_avg_output: whether to show the average output of the model</span>
<span class="sd">            y_limits: limits of the y-axis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">heterogeneity</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_confidence_interval</span><span class="p">(</span><span class="n">heterogeneity</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">feature</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">feature</span><span class="p">],</span> <span class="n">nof_points</span>
        <span class="p">)</span>

        <span class="c1"># get the SHAP curve</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="n">centering</span><span class="p">)</span>
        <span class="n">y_std</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;spline_std&quot;</span><span class="p">](</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">heterogeneity</span> <span class="o">==</span> <span class="s2">&quot;std&quot;</span> <span class="ow">or</span> <span class="kc">True</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="c1"># get some SHAP values</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">ind</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_nof_instances</span><span class="p">(</span><span class="n">nof_shap_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;yy&quot;</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">heterogeneity</span> <span class="o">==</span> <span class="s2">&quot;shap_values&quot;</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">yy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">centering</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">yy</span> <span class="o">=</span> <span class="n">yy</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;norm_const&quot;</span><span class="p">]</span>
        <span class="n">xx</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;xx&quot;</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">heterogeneity</span> <span class="o">==</span> <span class="s2">&quot;shap_values&quot;</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">show_avg_output</span><span class="p">:</span>
            <span class="n">avg_output</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_avg_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_output</span><span class="p">,</span> <span class="n">scale_y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">avg_output</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">vis</span><span class="o">.</span><span class="n">plot_shap</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="p">,</span>
            <span class="n">xx</span><span class="p">,</span>
            <span class="n">yy</span><span class="p">,</span>
            <span class="n">y_std</span><span class="p">,</span>
            <span class="n">feature</span><span class="p">,</span>
            <span class="n">heterogeneity</span><span class="o">=</span><span class="n">heterogeneity</span><span class="p">,</span>
            <span class="n">scale_x</span><span class="o">=</span><span class="n">scale_x</span><span class="p">,</span>
            <span class="n">scale_y</span><span class="o">=</span><span class="n">scale_y</span><span class="p">,</span>
            <span class="n">avg_output</span><span class="o">=</span><span class="n">avg_output</span><span class="p">,</span>
            <span class="n">feature_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">,</span>
            <span class="n">target_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_name</span><span class="p">,</span>
            <span class="n">y_limits</span><span class="o">=</span><span class="n">y_limits</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.global_effect_shap.SHAPDependence.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">axis_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nof_instances</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">avg_output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Constructor of the SHAPDependence class.</p>

<details class="definition" open>
  <summary>Definition</summary>
  <p>The value of a coalition of <span class="arithmatex">\(S\)</span> features is estimated as:
$$
\hat{v}(S) = {1 \over N} \sum_{i=1}^N  f(x_S \cup x_C^i) - f(x^i)
$$
The value of a coalition <span class="arithmatex">\(S\)</span> quantifies what the values <span class="arithmatex">\(\mathbf{x}_S\)</span> of the features in <span class="arithmatex">\(S\)</span> contribute to the output of the model. It
is the average (over all instances) difference on the output between setting features in <span class="arithmatex">\(S\)</span> to be <span class="arithmatex">\(x_S\)</span>, i.e., <span class="arithmatex">\(\mathbf{x} = (\mathbf{x}_S, \mathbf{x}_C^i)\)</span> and leaving the instance as it is, i.e., <span class="arithmatex">\(\mathbf{x}^i = (\mathbf{x}_S^i, \mathbf{x}_C^i)\)</span>.</p>
<p>The contribution of a feature <span class="arithmatex">\(j\)</span> added to a coalition <span class="arithmatex">\(S\)</span> is estimated as:
$$
\hat{\Delta}_{S, j} = \hat{v}(S \cup {j}) - \hat{v}(S)
$$</p>
<p>The SHAP value of a feature <span class="arithmatex">\(j\)</span> with value <span class="arithmatex">\(x_j\)</span> is the average contribution of feature <span class="arithmatex">\(j\)</span> across all possible coalitions with a weight <span class="arithmatex">\(w_{S, j}\)</span>:</p>
<div class="arithmatex">\[
\hat{\phi}_j(x_j) = {1 \over N} \sum_{S \subseteq \{1, \dots, D\} \setminus \{j\}} w_{S, j} \hat{\Delta}_{S, j}
\]</div>
<p>where <span class="arithmatex">\(w_{S, j}\)</span> assures that the contribution of feature <span class="arithmatex">\(j\)</span> is the same for all coalitions of the same size. For example, there are <span class="arithmatex">\(D-1\)</span> ways for <span class="arithmatex">\(x_j\)</span> to enter a coalition of <span class="arithmatex">\(|S| = 1\)</span> feature, so <span class="arithmatex">\(w_{S, j} = {1 \over D (D-1)}\)</span> for each of them. In contrast, there is only one way for <span class="arithmatex">\(x_j\)</span> to enter a coaltion of <span class="arithmatex">\(|S|=0\)</span> (to be the first specified feature), so <span class="arithmatex">\(w_{S, j} = {1 \over D}\)</span>.</p>
<p>The SHAP Dependence Plot (SHAP-DP) is a spline <span class="arithmatex">\(\hat{f}^{SDP}_j(x_j)\)</span> fit to the dataset <span class="arithmatex">\(\{(x_j^i, \hat{\phi}_j(x_j^i))\}_{i=1}^N\)</span> using the <code>UnivariateSpline</code> function from <code>scipy.interpolate</code>.</p>
</details>
<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>The required parameters are <code>data</code> and <code>model</code>. The rest are optional.</li>
<li>SHAP values are computed using the <code>shap</code> package, using the class <code>Explainer</code>.</li>
<li>SHAP values are centered by default, i.e., the average SHAP value is subtracted from the SHAP values.</li>
<li>More details on the SHAP values can be found in the <a href="https://arxiv.org/abs/1705.07874">original paper</a> and in the book <a href="https://christophmolnar.com/books/shap/">Interpreting Machine Learning Models with SHAP</a></li>
</ul>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the design matrix</p>
<ul>
<li>shape: <code>(N,D)</code></li>
</ul>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model</code></td>
          <td>
                <code><span title="typing.Callable">Callable</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the black-box model. Must be a <code>Callable</code> with:</p>
<ul>
<li>input: <code>ndarray</code> of shape <code>(N, D)</code></li>
<li>output: <code>ndarray</code> of shape <code>(N,)</code></li>
</ul>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>axis_limits</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The limits of the feature effect plot along each axis</p>
<ul>
<li>use a <code>ndarray</code> of shape <code>(2, D)</code>, to specify them manually</li>
<li>use <code>None</code>, to be inferred from the data</li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>nof_instances</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[int, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>maximum number of instances to be used for SHAP estimation.</p>
<ul>
<li>use "all", for using all instances.</li>
<li>use an <code>int</code>, for using <code>nof_instances</code> instances.</li>
</ul>
            </div>
          </td>
          <td>
                <code>100</code>
          </td>
        </tr>
        <tr>
          <td><code>avg_output</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The average output of the model.</p>
<ul>
<li>use a <code>float</code>, to specify it manually</li>
<li>use <code>None</code>, to be inferred as <code>np.mean(model(data))</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>feature_names</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[str]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The names of the features</p>
<ul>
<li>use a <code>list</code> of <code>str</code>, to specify the name manually. For example: <code>["age", "weight", ...]</code></li>
<li>use <code>None</code>, to keep the default names: <code>["x_0", "x_1", ...]</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>target_name</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the target variable</p>
<ul>
<li>use a <code>str</code>, to specify it name manually. For example: <code>"price"</code></li>
<li>use <code>None</code>, to keep the default name: <code>"y"</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_shap.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
        <span class="n">axis_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nof_instances</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">avg_output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructor of the SHAPDependence class.</span>

<span class="sd">    Definition:</span>
<span class="sd">        The value of a coalition of $S$ features is estimated as:</span>
<span class="sd">        $$</span>
<span class="sd">        \hat{v}(S) = {1 \over N} \sum_{i=1}^N  f(x_S \cup x_C^i) - f(x^i)</span>
<span class="sd">        $$</span>
<span class="sd">        The value of a coalition $S$ quantifies what the values $\mathbf{x}_S$ of the features in $S$ contribute to the output of the model. It</span>
<span class="sd">        is the average (over all instances) difference on the output between setting features in $S$ to be $x_S$, i.e., $\mathbf{x} = (\mathbf{x}_S, \mathbf{x}_C^i)$ and leaving the instance as it is, i.e., $\mathbf{x}^i = (\mathbf{x}_S^i, \mathbf{x}_C^i)$.</span>

<span class="sd">        The contribution of a feature $j$ added to a coalition $S$ is estimated as:</span>
<span class="sd">        $$</span>
<span class="sd">        \hat{\Delta}_{S, j} = \hat{v}(S \cup \{j\}) - \hat{v}(S)</span>
<span class="sd">        $$</span>

<span class="sd">        The SHAP value of a feature $j$ with value $x_j$ is the average contribution of feature $j$ across all possible coalitions with a weight $w_{S, j}$:</span>

<span class="sd">        $$</span>
<span class="sd">        \hat{\phi}_j(x_j) = {1 \over N} \sum_{S \subseteq \{1, \dots, D\} \setminus \{j\}} w_{S, j} \hat{\Delta}_{S, j}</span>
<span class="sd">        $$</span>

<span class="sd">        where $w_{S, j}$ assures that the contribution of feature $j$ is the same for all coalitions of the same size. For example, there are $D-1$ ways for $x_j$ to enter a coalition of $|S| = 1$ feature, so $w_{S, j} = {1 \over D (D-1)}$ for each of them. In contrast, there is only one way for $x_j$ to enter a coaltion of $|S|=0$ (to be the first specified feature), so $w_{S, j} = {1 \over D}$.</span>

<span class="sd">        The SHAP Dependence Plot (SHAP-DP) is a spline $\hat{f}^{SDP}_j(x_j)$ fit to the dataset $\{(x_j^i, \hat{\phi}_j(x_j^i))\}_{i=1}^N$ using the `UnivariateSpline` function from `scipy.interpolate`.</span>

<span class="sd">    Notes:</span>
<span class="sd">        * The required parameters are `data` and `model`. The rest are optional.</span>
<span class="sd">        * SHAP values are computed using the `shap` package, using the class `Explainer`.</span>
<span class="sd">        * SHAP values are centered by default, i.e., the average SHAP value is subtracted from the SHAP values.</span>
<span class="sd">        * More details on the SHAP values can be found in the [original paper](https://arxiv.org/abs/1705.07874) and in the book [Interpreting Machine Learning Models with SHAP](https://christophmolnar.com/books/shap/)</span>

<span class="sd">    Args:</span>
<span class="sd">        data: the design matrix</span>

<span class="sd">            - shape: `(N,D)`</span>
<span class="sd">        model: the black-box model. Must be a `Callable` with:</span>

<span class="sd">            - input: `ndarray` of shape `(N, D)`</span>
<span class="sd">            - output: `ndarray` of shape `(N,)`</span>

<span class="sd">        axis_limits: The limits of the feature effect plot along each axis</span>

<span class="sd">            - use a `ndarray` of shape `(2, D)`, to specify them manually</span>
<span class="sd">            - use `None`, to be inferred from the data</span>

<span class="sd">        nof_instances: maximum number of instances to be used for SHAP estimation.</span>

<span class="sd">            - use &quot;all&quot;, for using all instances.</span>
<span class="sd">            - use an `int`, for using `nof_instances` instances.</span>

<span class="sd">        avg_output: The average output of the model.</span>

<span class="sd">            - use a `float`, to specify it manually</span>
<span class="sd">            - use `None`, to be inferred as `np.mean(model(data))`</span>

<span class="sd">        feature_names: The names of the features</span>

<span class="sd">            - use a `list` of `str`, to specify the name manually. For example: `                  [&quot;age&quot;, &quot;weight&quot;, ...]`</span>
<span class="sd">            - use `None`, to keep the default names: `[&quot;x_0&quot;, &quot;x_1&quot;, ...]`</span>

<span class="sd">        target_name: The name of the target variable</span>

<span class="sd">            - use a `str`, to specify it name manually. For example: `&quot;price&quot;`</span>
<span class="sd">            - use `None`, to keep the default name: `&quot;y&quot;`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nof_instances</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_nof_instances</span><span class="p">(</span>
        <span class="n">nof_instances</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="p">:]</span>

    <span class="nb">super</span><span class="p">(</span><span class="n">SHAPDependence</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="s2">&quot;SHAP DP&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">nof_instances</span><span class="p">,</span> <span class="n">axis_limits</span><span class="p">,</span> <span class="n">avg_output</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="n">target_name</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.global_effect_shap.SHAPDependence.fit">
<code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">points_for_centering</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Fit the SHAP Dependence Plot to the data.</p>

<details class="notes" open>
  <summary>Notes</summary>
  <p>The SHAP Dependence Plot (SDP) <span class="arithmatex">\(\hat{f}^{SDP}_j(x_j)\)</span> is a spline fit to
the dataset <span class="arithmatex">\(\{(x_j^i, \hat{\phi}_j(x_j^i))\}_{i=1}^N\)</span>
using the <code>UnivariateSpline</code> function from <code>scipy.interpolate</code>.</p>
<p>The SHAP standard deviation, <span class="arithmatex">\(\hat{\sigma}^{SDP}_j(x_j)\)</span>, is a spline fit            to the absolute value of the residuals, i.e., to the dataset <span class="arithmatex">\(\{(x_j^i, |\hat{\phi}_j(x_j^i) - \hat{f}^{SDP}_j(x_j^i)|)\}_{i=1}^N\)</span>, using the <code>UnivariateSpline</code> function from <code>scipy.interpolate</code>.</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>features</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[int, str, <span title="typing.List">List</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the features to fit.
- If set to "all", all the features will be fitted.</p>
            </div>
          </td>
          <td>
                <code>&#39;all&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>centering</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[bool, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <ul>
<li>If set to False, no centering will be applied.</li>
<li>If set to "zero_integral" or True, the integral of the feature effect will be set to zero.</li>
<li>If set to "zero_mean", the mean of the feature effect will be set to zero.</li>
</ul>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>points_for_centering</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[int, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>number of linspaced points along the feature axis used for centering.</p>
<ul>
<li>If set to <code>all</code>, all the dataset points will be used.</li>
</ul>
            </div>
          </td>
          <td>
                <code>100</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="notes" open>
  <summary>Notes</summary>
  <p>SHAP values are by default centered, i.e., <span class="arithmatex">\(\sum_{i=1}^N \hat{\phi}_j(x_j^i) = 0\)</span>. This does not mean that the SHAP <em>curve</em> is centered around zero; this happens only if the <span class="arithmatex">\(s\)</span>-th feature of the dataset instances, i.e., the set <span class="arithmatex">\(\{x_s^i\}_{i=1}^N\)</span> is uniformly distributed along the <span class="arithmatex">\(s\)</span>-th axis. So, use:</p>
<ul>
<li><code>centering=False</code>, to leave the SHAP values as they are.</li>
<li><code>centering=True</code> or <code>centering=zero_integral</code>, to center the SHAP curve around the <code>y</code> axis.</li>
<li><code>centering=zero_start</code>, to start the SHAP curve from <code>y=0</code>.</li>
</ul>
<p>SHAP values are expensive to compute.
To speed up the computation consider using a subset of the dataset
points for computing the SHAP values and for centering the spline.
The default values (<code>points_for_fitting_spline=100</code>
and <code>points_for_centering=100</code>) are a moderate choice.</p>
</details>
      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_shap.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">centering</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">points_for_centering</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit the SHAP Dependence Plot to the data.</span>

<span class="sd">    Notes:</span>
<span class="sd">        The SHAP Dependence Plot (SDP) $\hat{f}^{SDP}_j(x_j)$ is a spline fit to</span>
<span class="sd">        the dataset $\{(x_j^i, \hat{\phi}_j(x_j^i))\}_{i=1}^N$</span>
<span class="sd">        using the `UnivariateSpline` function from `scipy.interpolate`.</span>

<span class="sd">        The SHAP standard deviation, $\hat{\sigma}^{SDP}_j(x_j)$, is a spline fit            to the absolute value of the residuals, i.e., to the dataset $\{(x_j^i, |\hat{\phi}_j(x_j^i) - \hat{f}^{SDP}_j(x_j^i)|)\}_{i=1}^N$, using the `UnivariateSpline` function from `scipy.interpolate`.</span>

<span class="sd">    Args:</span>
<span class="sd">        features: the features to fit.</span>
<span class="sd">            - If set to &quot;all&quot;, all the features will be fitted.</span>
<span class="sd">        centering:</span>
<span class="sd">            - If set to False, no centering will be applied.</span>
<span class="sd">            - If set to &quot;zero_integral&quot; or True, the integral of the feature effect will be set to zero.</span>
<span class="sd">            - If set to &quot;zero_mean&quot;, the mean of the feature effect will be set to zero.</span>

<span class="sd">        points_for_centering: number of linspaced points along the feature axis used for centering.</span>

<span class="sd">            - If set to `all`, all the dataset points will be used.</span>

<span class="sd">    Notes:</span>
<span class="sd">        SHAP values are by default centered, i.e., $\sum_{i=1}^N \hat{\phi}_j(x_j^i) = 0$. This does not mean that the SHAP _curve_ is centered around zero; this happens only if the $s$-th feature of the dataset instances, i.e., the set $\{x_s^i\}_{i=1}^N$ is uniformly distributed along the $s$-th axis. So, use:</span>

<span class="sd">        * `centering=False`, to leave the SHAP values as they are.</span>
<span class="sd">        * `centering=True` or `centering=zero_integral`, to center the SHAP curve around the `y` axis.</span>
<span class="sd">        * `centering=zero_start`, to start the SHAP curve from `y=0`.</span>

<span class="sd">        SHAP values are expensive to compute.</span>
<span class="sd">        To speed up the computation consider using a subset of the dataset</span>
<span class="sd">        points for computing the SHAP values and for centering the spline.</span>
<span class="sd">        The default values (`points_for_fitting_spline=100`</span>
<span class="sd">        and `points_for_centering=100`) are a moderate choice.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">centering</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_centering</span><span class="p">(</span><span class="n">centering</span><span class="p">)</span>
    <span class="n">features</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_features</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>

    <span class="c1"># new implementation</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_feature</span><span class="p">(</span>
            <span class="n">s</span><span class="p">,</span> <span class="n">centering</span><span class="p">,</span> <span class="n">points_for_centering</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_fitted</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_args</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;centering&quot;</span><span class="p">:</span> <span class="n">centering</span><span class="p">,</span>
            <span class="s2">&quot;points_for_centering&quot;</span><span class="p">:</span> <span class="n">points_for_centering</span><span class="p">,</span>
        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.global_effect_shap.SHAPDependence.eval">
<code class="highlight language-python"><span class="nb">eval</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Evaluate the effect of the s-th feature at positions <code>xs</code>.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>feature</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>index of feature of interest</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>xs</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the points along the s-th axis to evaluate the FE plot</p>
<ul>
<li><code>np.ndarray</code> of shape <code>(T,)</code></li>
</ul>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>heterogeneity</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to return the heterogeneity measures.</p>
<ul>
<li>if <code>heterogeneity=False</code>, the function returns the mean effect at the given <code>xs</code></li>
<li>If <code>heterogeneity=True</code>, the function returns <code>(y, std)</code> where <code>y</code> is the mean effect and <code>std</code> is the standard deviation of the mean effect</li>
</ul>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>centering</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[bool, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to center the plot</p>
<ul>
<li>If <code>centering</code> is <code>False</code>, the SHAP curve is not centered</li>
<li>If <code>centering</code> is <code>True</code> or <code>zero_integral</code>, the SHAP curve is centered around the <code>y</code> axis.</li>
<li>If <code>centering</code> is <code>zero_start</code>, the SHAP curve starts from <code>y=0</code>.</li>
</ul>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[<span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>, typing.<span title="typing.Tuple">Tuple</span>[<span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>, <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the mean effect <code>y</code>, if <code>heterogeneity=False</code> (default) or a tuple <code>(y, std, estimator_var)</code> otherwise</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_shap.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">eval</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">xs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">heterogeneity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">centering</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluate the effect of the s-th feature at positions `xs`.</span>

<span class="sd">    Args:</span>
<span class="sd">        feature: index of feature of interest</span>
<span class="sd">        xs: the points along the s-th axis to evaluate the FE plot</span>

<span class="sd">          - `np.ndarray` of shape `(T,)`</span>
<span class="sd">        heterogeneity: whether to return the heterogeneity measures.</span>

<span class="sd">              - if `heterogeneity=False`, the function returns the mean effect at the given `xs`</span>
<span class="sd">              - If `heterogeneity=True`, the function returns `(y, std)` where `y` is the mean effect and `std` is the standard deviation of the mean effect</span>

<span class="sd">        centering: whether to center the plot</span>

<span class="sd">            - If `centering` is `False`, the SHAP curve is not centered</span>
<span class="sd">            - If `centering` is `True` or `zero_integral`, the SHAP curve is centered around the `y` axis.</span>
<span class="sd">            - If `centering` is `zero_start`, the SHAP curve starts from `y=0`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        the mean effect `y`, if `heterogeneity=False` (default) or a tuple `(y, std, estimator_var)` otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">centering</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_centering</span><span class="p">(</span><span class="n">centering</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">centering</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="n">centering</span><span class="p">)</span>

    <span class="c1"># Check if the lower bound is less than the upper bound</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">feature</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">feature</span><span class="p">]</span>

    <span class="n">yy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;spline_mean&quot;</span><span class="p">](</span><span class="n">xs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">centering</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">norm_const</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;norm_const&quot;</span><span class="p">]</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="n">yy</span> <span class="o">-</span> <span class="n">norm_const</span>

    <span class="k">if</span> <span class="n">heterogeneity</span><span class="p">:</span>
        <span class="n">yy_std</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;spline_std&quot;</span><span class="p">](</span><span class="n">xs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">yy</span><span class="p">,</span> <span class="n">yy_std</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">yy</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.global_effect_shap.SHAPDependence.plot">
<code class="highlight language-python"><span class="n">plot</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nof_points</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">scale_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nof_shap_values</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">show_avg_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">y_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Plot the SHAP Dependence Plot (SDP) of the s-th feature.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>feature</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>index of the plotted feature</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>heterogeneity</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[bool, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to output the heterogeneity of the SHAP values</p>
<ul>
<li>If <code>heterogeneity</code> is <code>False</code>, no heterogeneity is plotted</li>
<li>If <code>heterogeneity</code> is <code>True</code> or <code>"std"</code>, the standard deviation of the shap values is plotted</li>
<li>If <code>heterogeneity</code> is <code>"shap_values"</code>, the shap values are scattered on top of the SHAP curve</li>
</ul>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>centering</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[bool, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to center the SDP</p>
<ul>
<li>If <code>centering</code> is <code>False</code>, the SHAP curve is not centered</li>
<li>If <code>centering</code> is <code>True</code> or <code>zero_integral</code>, the SHAP curve is centered around the <code>y</code> axis.</li>
<li>If <code>centering</code> is <code>zero_start</code>, the SHAP curve starts from <code>y=0</code>.</li>
</ul>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>nof_points</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>number of points to evaluate the SDP plot</p>
            </div>
          </td>
          <td>
                <code>30</code>
          </td>
        </tr>
        <tr>
          <td><code>scale_x</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[dict]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dictionary with keys "mean" and "std" for scaling the x-axis</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>scale_y</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[dict]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dictionary with keys "mean" and "std" for scaling the y-axis</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>nof_shap_values</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[int, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>number of shap values to show on top of the SHAP curve</p>
            </div>
          </td>
          <td>
                <code>&#39;all&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>show_avg_output</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to show the average output of the model</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>y_limits</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>limits of the y-axis</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/global_effect_shap.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">heterogeneity</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">centering</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">nof_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">scale_x</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">scale_y</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">nof_shap_values</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="n">show_avg_output</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">y_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the SHAP Dependence Plot (SDP) of the s-th feature.</span>

<span class="sd">    Args:</span>
<span class="sd">        feature: index of the plotted feature</span>
<span class="sd">        heterogeneity: whether to output the heterogeneity of the SHAP values</span>

<span class="sd">            - If `heterogeneity` is `False`, no heterogeneity is plotted</span>
<span class="sd">            - If `heterogeneity` is `True` or `&quot;std&quot;`, the standard deviation of the shap values is plotted</span>
<span class="sd">            - If `heterogeneity` is `&quot;shap_values&quot;`, the shap values are scattered on top of the SHAP curve</span>

<span class="sd">        centering: whether to center the SDP</span>

<span class="sd">            - If `centering` is `False`, the SHAP curve is not centered</span>
<span class="sd">            - If `centering` is `True` or `zero_integral`, the SHAP curve is centered around the `y` axis.</span>
<span class="sd">            - If `centering` is `zero_start`, the SHAP curve starts from `y=0`.</span>

<span class="sd">        nof_points: number of points to evaluate the SDP plot</span>
<span class="sd">        scale_x: dictionary with keys &quot;mean&quot; and &quot;std&quot; for scaling the x-axis</span>
<span class="sd">        scale_y: dictionary with keys &quot;mean&quot; and &quot;std&quot; for scaling the y-axis</span>
<span class="sd">        nof_shap_values: number of shap values to show on top of the SHAP curve</span>
<span class="sd">        show_avg_output: whether to show the average output of the model</span>
<span class="sd">        y_limits: limits of the y-axis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">heterogeneity</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_confidence_interval</span><span class="p">(</span><span class="n">heterogeneity</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">feature</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">feature</span><span class="p">],</span> <span class="n">nof_points</span>
    <span class="p">)</span>

    <span class="c1"># get the SHAP curve</span>
    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="n">centering</span><span class="p">)</span>
    <span class="n">y_std</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;spline_std&quot;</span><span class="p">](</span><span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">heterogeneity</span> <span class="o">==</span> <span class="s2">&quot;std&quot;</span> <span class="ow">or</span> <span class="kc">True</span>
        <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>

    <span class="c1"># get some SHAP values</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">ind</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_nof_instances</span><span class="p">(</span><span class="n">nof_shap_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">yy</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;yy&quot;</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">heterogeneity</span> <span class="o">==</span> <span class="s2">&quot;shap_values&quot;</span>
        <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">yy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">centering</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="n">yy</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;norm_const&quot;</span><span class="p">]</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_effect</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;xx&quot;</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">heterogeneity</span> <span class="o">==</span> <span class="s2">&quot;shap_values&quot;</span>
        <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">show_avg_output</span><span class="p">:</span>
        <span class="n">avg_output</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_avg_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_output</span><span class="p">,</span> <span class="n">scale_y</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">avg_output</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">vis</span><span class="o">.</span><span class="n">plot_shap</span><span class="p">(</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">y</span><span class="p">,</span>
        <span class="n">xx</span><span class="p">,</span>
        <span class="n">yy</span><span class="p">,</span>
        <span class="n">y_std</span><span class="p">,</span>
        <span class="n">feature</span><span class="p">,</span>
        <span class="n">heterogeneity</span><span class="o">=</span><span class="n">heterogeneity</span><span class="p">,</span>
        <span class="n">scale_x</span><span class="o">=</span><span class="n">scale_x</span><span class="p">,</span>
        <span class="n">scale_y</span><span class="o">=</span><span class="n">scale_y</span><span class="p">,</span>
        <span class="n">avg_output</span><span class="o">=</span><span class="n">avg_output</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">,</span>
        <span class="n">target_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_name</span><span class="p">,</span>
        <span class="n">y_limits</span><span class="o">=</span><span class="n">y_limits</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="regional-effect-methods">Regional Effect Methods</h2>


<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="effector.regional_effect.RegionalEffectBase">
        <code>effector.regional_effect.RegionalEffectBase</code>


</h2>


  <div class="doc doc-contents first">



        <details class="quote">
          <summary>Source code in <code>/home/runner/work/effector/effector/effector/regional_effect.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RegionalEffectBase</span><span class="p">:</span>
    <span class="n">empty_symbol</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">EMPTY_SYMBOL</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">method_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
        <span class="n">model_jac</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">data_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nof_instances</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">axis_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cat_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor for the RegionalEffect class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">=</span> <span class="n">method_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_jac</span> <span class="o">=</span> <span class="n">model_jac</span>

        <span class="c1"># select nof_instances from the data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nof_instances</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_nof_instances</span><span class="p">(</span>
            <span class="n">nof_instances</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance_effects</span> <span class="o">=</span> <span class="n">data_effect</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="p">:]</span> <span class="k">if</span> <span class="n">data_effect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># set axis_limits</span>
        <span class="n">axis_limits</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">helpers</span><span class="o">.</span><span class="n">axis_limits_from_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">if</span> <span class="n">axis_limits</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">axis_limits</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">axis_limits</span>

        <span class="c1"># set feature types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cat_limit</span> <span class="o">=</span> <span class="n">cat_limit</span>
        <span class="n">feature_types</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">get_feature_types</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cat_limit</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">feature_types</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">feature_types</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_types</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">feature_types</span>

        <span class="c1"># set feature names</span>
        <span class="n">feature_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">helpers</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">(</span><span class="n">axis_limits</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">feature_names</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">feature_names</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">feature_names</span>

        <span class="c1"># set target name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_name</span> <span class="o">=</span> <span class="s2">&quot;y&quot;</span> <span class="k">if</span> <span class="n">target_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">target_name</span>

        <span class="c1"># state variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_fitted</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">0</span>

        <span class="c1"># parameters used when fitting the regional effect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_args</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># dictionary with all the information required for plotting or evaluating the regional effects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partitioners</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Regions</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_full</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tree</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_pruned</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tree</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_full_scaled</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tree</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_pruned_scaled</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tree</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_fit_feature</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">heter_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
        <span class="n">heter_pcg_drop_thres</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">heter_small_enough</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">max_split_levels</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">candidate_positions_for_numerical</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
        <span class="n">min_points_per_subregion</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">candidate_foc</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">split_categorical_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the subregions for a single feature.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># init Region Extractor</span>
        <span class="n">regions</span> <span class="o">=</span> <span class="n">Regions</span><span class="p">(</span>
            <span class="n">feature</span><span class="p">,</span>
            <span class="n">heter_func</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instance_effects</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_types</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cat_limit</span><span class="p">,</span>
            <span class="n">candidate_foc</span><span class="p">,</span>
            <span class="n">min_points_per_subregion</span><span class="p">,</span>
            <span class="n">candidate_positions_for_numerical</span><span class="p">,</span>
            <span class="n">max_split_levels</span><span class="p">,</span>
            <span class="n">heter_pcg_drop_thres</span><span class="p">,</span>
            <span class="n">heter_small_enough</span><span class="p">,</span>
            <span class="n">split_categorical_features</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># apply partitioning</span>
        <span class="n">regions</span><span class="o">.</span><span class="n">search_all_splits</span><span class="p">()</span>
        <span class="n">regions</span><span class="o">.</span><span class="n">choose_important_splits</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_full</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span> <span class="o">=</span> <span class="n">regions</span><span class="o">.</span><span class="n">splits_to_tree</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_pruned</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span> <span class="o">=</span> <span class="n">regions</span><span class="o">.</span><span class="n">splits_to_tree</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># store the partitioning object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partitioners</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span> <span class="o">=</span> <span class="n">regions</span>

        <span class="c1"># update state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_fitted</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">refit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_fitted</span><span class="p">[</span><span class="n">feature</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_node_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">node_idx</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_fitted</span><span class="p">[</span><span class="n">feature</span><span class="p">],</span> <span class="s2">&quot;Feature </span><span class="si">{}</span><span class="s2"> has not been fitted yet&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_pruned</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Feature </span><span class="si">{}</span><span class="s2"> has no splits&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_pruned_scaled</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_pruned_scaled</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_pruned_scaled</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_pruned</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span>

        <span class="c1"># assert node id exists</span>
        <span class="k">assert</span> <span class="n">node_idx</span> <span class="ow">in</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">idx</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">nodes</span><span class="p">],</span> <span class="s2">&quot;Node </span><span class="si">{}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_idx</span><span class="p">)</span>

        <span class="c1"># find the node</span>
        <span class="n">node</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="n">node_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># get data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
        <span class="n">data_effect</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;data_effect&quot;</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_effect</span><span class="p">,</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">_create_fe_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_effect</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">==</span> <span class="s2">&quot;rhale&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">RHALE</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_jac</span><span class="p">,</span> <span class="n">data_effect</span><span class="o">=</span><span class="n">data_effect</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">==</span> <span class="s2">&quot;ale&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ALE</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">==</span> <span class="s2">&quot;shap&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SHAPDependence</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">==</span> <span class="s2">&quot;pdp&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PDP</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">==</span> <span class="s2">&quot;d-pdp&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DerivativePDP</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_jac</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">node_idx</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the regional effect for a given feature and node.</span>

<span class="sd">        Args:</span>
<span class="sd">            feature: the feature to evaluate</span>
<span class="sd">            node_idx: the node corresponding to the subregion to evaluate</span>
<span class="sd">            xs: the points at which to evaluate the regional effect</span>
<span class="sd">            heterogeneity: whether to return the heterogeneity.</span>

<span class="sd">                  - if `heterogeneity=False`, the function returns the mean effect at the given `xs`</span>
<span class="sd">                  - If `heterogeneity=True`, the function returns `(y, std)` where `y` is the mean effect and `std` is the standard deviation of the mean effect</span>

<span class="sd">            centering: whether to center the regional effect. The following options are available:</span>

<span class="sd">                - If `centering` is `False`, the regional effect is not centered</span>
<span class="sd">                - If `centering` is `True` or `zero_integral`, the regional effect is centered around the `y` axis.</span>
<span class="sd">                - If `centering` is `zero_start`, the regional effect starts from `y=0`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            the mean effect `y`, if `heterogeneity=False` (default) or a tuple `(y, std)` otherwise</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
        <span class="n">centering</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_centering</span><span class="p">(</span><span class="n">centering</span><span class="p">)</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">data_effect</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_info</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">node_idx</span><span class="p">)</span>
        <span class="n">fe_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_fe_object</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_effect</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fe_method</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="p">,</span> <span class="n">centering</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">feature</span><span class="p">,</span>
             <span class="n">node_idx</span><span class="p">,</span>
             <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">centering</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">scale_x_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">scale_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">y_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">scale_x_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_full_scaled</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitioners</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span><span class="o">.</span><span class="n">splits_to_tree</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">scale_x_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_pruned_scaled</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitioners</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span><span class="o">.</span><span class="n">splits_to_tree</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale_x_list</span><span class="p">)</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">data_effect</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_info</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">node_idx</span><span class="p">)</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">)</span>
        <span class="n">feature_names</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">fe_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_fe_object</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_effect</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fe_method</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">feature</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span>
            <span class="n">heterogeneity</span><span class="o">=</span><span class="n">heterogeneity</span><span class="p">,</span>
            <span class="n">centering</span><span class="o">=</span><span class="n">centering</span><span class="p">,</span>
            <span class="n">scale_x</span><span class="o">=</span><span class="n">scale_x_list</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="k">if</span> <span class="n">scale_x_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">scale_y</span><span class="o">=</span><span class="n">scale_y</span><span class="p">,</span>
            <span class="n">y_limits</span><span class="o">=</span><span class="n">y_limits</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">show_partitioning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">only_important</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale_x_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_features</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">scale_x_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tree_full_scaled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitioners</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feat</span><span class="p">)]</span><span class="o">.</span><span class="n">splits_to_tree</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale_x_list</span><span class="p">)</span>
                <span class="n">tree_pruned_scaled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitioners</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feat</span><span class="p">)]</span><span class="o">.</span><span class="n">splits_to_tree</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">scale_x_list</span><span class="p">)</span>
                <span class="n">tree_dict</span> <span class="o">=</span> <span class="n">tree_full_scaled</span> <span class="k">if</span> <span class="n">only_important</span> <span class="k">else</span> <span class="n">tree_pruned_scaled</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tree_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_pruned</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feat</span><span class="p">)]</span> <span class="k">if</span> <span class="n">only_important</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_full</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feat</span><span class="p">)]</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Feature </span><span class="si">{}</span><span class="s2"> - Full partition tree:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feat</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">tree_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No splits found for feature </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feat</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tree_dict</span><span class="o">.</span><span class="n">show_full_tree</span><span class="p">()</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Feature </span><span class="si">{}</span><span class="s2"> - Statistics per tree level:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feat</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">tree_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No splits found for feature </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feat</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tree_dict</span><span class="o">.</span><span class="n">show_level_stats</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">describe_subregions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">features</span><span class="p">,</span>
        <span class="n">only_important</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">scale_x_list</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_features</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

            <span class="c1"># it means it a categorical feature</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_full</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">feature_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">only_important</span><span class="p">:</span>
                <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_pruned</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No important splits found for feature </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">))</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Important splits for feature </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature_name</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All splits for feature </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature_name</span><span class="p">))</span>
                <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_full</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span>

            <span class="n">max_level</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">node</span><span class="o">.</span><span class="n">level</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">nodes</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_level</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">previous_level_nodes</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">get_level_nodes</span><span class="p">(</span><span class="n">level</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">level_nodes</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">get_level_nodes</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
                <span class="n">type_of_split_feature</span> <span class="o">=</span> <span class="n">level_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;feature_type&quot;</span><span class="p">]</span>
                <span class="n">foc_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">[</span><span class="n">level_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]]</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- On feature </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">foc_name</span><span class="p">,</span> <span class="n">type_of_split_feature</span><span class="p">))</span>

                <span class="n">position_split_formatted</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">level_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">scale_x_list</span> <span class="ow">is</span> <span class="kc">None</span>
                    <span class="k">else</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">level_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale_x_list</span><span class="p">[</span><span class="n">level_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]][</span><span class="s2">&quot;std&quot;</span><span class="p">]</span>
                        <span class="o">+</span> <span class="n">scale_x_list</span><span class="p">[</span><span class="n">level_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]][</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Position of split: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">position_split_formatted</span><span class="p">))</span>

                <span class="n">weight_heter_before</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">node</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">node</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;heterogeneity&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">previous_level_nodes</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Heterogeneity before split: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weight_heter_before</span><span class="p">))</span>

                <span class="n">weight_heter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">node</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">node</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;heterogeneity&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">level_nodes</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Heterogeneity after split: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weight_heter</span><span class="p">))</span>
                <span class="n">weight_heter_drop</span> <span class="o">=</span> <span class="n">weight_heter_before</span> <span class="o">-</span> <span class="n">weight_heter</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Heterogeneity drop: </span><span class="si">{:.2f}</span><span class="s2"> (</span><span class="si">{:.2f}</span><span class="s2"> %)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">weight_heter_drop</span><span class="p">,</span> <span class="n">weight_heter_drop</span> <span class="o">/</span> <span class="n">weight_heter_before</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="n">nof_instances_before</span> <span class="o">=</span> <span class="p">[</span><span class="n">nod</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;nof_instances&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">nod</span> <span class="ow">in</span> <span class="n">previous_level_nodes</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Number of instances before split: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nof_instances_before</span><span class="p">))</span>
                <span class="n">nof_instances</span> <span class="o">=</span> <span class="p">[</span><span class="n">nod</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;nof_instances&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">nod</span> <span class="ow">in</span> <span class="n">level_nodes</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Number of instances after split: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nof_instances</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.regional_effect.RegionalEffectBase.eval">
<code class="highlight language-python"><span class="nb">eval</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">node_idx</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Evaluate the regional effect for a given feature and node.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>feature</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the feature to evaluate</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>node_idx</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the node corresponding to the subregion to evaluate</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>xs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the points at which to evaluate the regional effect</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>heterogeneity</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to return the heterogeneity.</p>
<ul>
<li>if <code>heterogeneity=False</code>, the function returns the mean effect at the given <code>xs</code></li>
<li>If <code>heterogeneity=True</code>, the function returns <code>(y, std)</code> where <code>y</code> is the mean effect and <code>std</code> is the standard deviation of the mean effect</li>
</ul>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>centering</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to center the regional effect. The following options are available:</p>
<ul>
<li>If <code>centering</code> is <code>False</code>, the regional effect is not centered</li>
<li>If <code>centering</code> is <code>True</code> or <code>zero_integral</code>, the regional effect is centered around the <code>y</code> axis.</li>
<li>If <code>centering</code> is <code>zero_start</code>, the regional effect starts from <code>y=0</code>.</li>
</ul>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the mean effect <code>y</code>, if <code>heterogeneity=False</code> (default) or a tuple <code>(y, std)</code> otherwise</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/regional_effect.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">node_idx</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate the regional effect for a given feature and node.</span>

<span class="sd">    Args:</span>
<span class="sd">        feature: the feature to evaluate</span>
<span class="sd">        node_idx: the node corresponding to the subregion to evaluate</span>
<span class="sd">        xs: the points at which to evaluate the regional effect</span>
<span class="sd">        heterogeneity: whether to return the heterogeneity.</span>

<span class="sd">              - if `heterogeneity=False`, the function returns the mean effect at the given `xs`</span>
<span class="sd">              - If `heterogeneity=True`, the function returns `(y, std)` where `y` is the mean effect and `std` is the standard deviation of the mean effect</span>

<span class="sd">        centering: whether to center the regional effect. The following options are available:</span>

<span class="sd">            - If `centering` is `False`, the regional effect is not centered</span>
<span class="sd">            - If `centering` is `True` or `zero_integral`, the regional effect is centered around the `y` axis.</span>
<span class="sd">            - If `centering` is `zero_start`, the regional effect starts from `y=0`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        the mean effect `y`, if `heterogeneity=False` (default) or a tuple `(y, std)` otherwise</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
    <span class="n">centering</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_centering</span><span class="p">(</span><span class="n">centering</span><span class="p">)</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">data_effect</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_info</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">node_idx</span><span class="p">)</span>
    <span class="n">fe_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_fe_object</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_effect</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fe_method</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="p">,</span> <span class="n">centering</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.regional_effect.RegionalEffectBase.plot">
<code class="highlight language-python"><span class="n">plot</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">node_idx</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scale_x_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/regional_effect.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
         <span class="n">feature</span><span class="p">,</span>
         <span class="n">node_idx</span><span class="p">,</span>
         <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
         <span class="n">centering</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
         <span class="n">scale_x_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">scale_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">y_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">scale_x_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_full_scaled</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitioners</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span><span class="o">.</span><span class="n">splits_to_tree</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">scale_x_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_pruned_scaled</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitioners</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span><span class="o">.</span><span class="n">splits_to_tree</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale_x_list</span><span class="p">)</span>

    <span class="n">data</span><span class="p">,</span> <span class="n">data_effect</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_info</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">node_idx</span><span class="p">)</span>
    <span class="n">feature_names</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">)</span>
    <span class="n">feature_names</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">fe_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_fe_object</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_effect</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fe_method</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">feature</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span>
        <span class="n">heterogeneity</span><span class="o">=</span><span class="n">heterogeneity</span><span class="p">,</span>
        <span class="n">centering</span><span class="o">=</span><span class="n">centering</span><span class="p">,</span>
        <span class="n">scale_x</span><span class="o">=</span><span class="n">scale_x_list</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="k">if</span> <span class="n">scale_x_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scale_y</span><span class="o">=</span><span class="n">scale_y</span><span class="p">,</span>
        <span class="n">y_limits</span><span class="o">=</span><span class="n">y_limits</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.regional_effect.RegionalEffectBase.get_node_info">
<code class="highlight language-python"><span class="n">get_node_info</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">node_idx</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/regional_effect.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_node_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">node_idx</span><span class="p">):</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_fitted</span><span class="p">[</span><span class="n">feature</span><span class="p">],</span> <span class="s2">&quot;Feature </span><span class="si">{}</span><span class="s2"> has not been fitted yet&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_pruned</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Feature </span><span class="si">{}</span><span class="s2"> has no splits&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_pruned_scaled</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_pruned_scaled</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_pruned_scaled</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_pruned</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span>

    <span class="c1"># assert node id exists</span>
    <span class="k">assert</span> <span class="n">node_idx</span> <span class="ow">in</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">idx</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">nodes</span><span class="p">],</span> <span class="s2">&quot;Node </span><span class="si">{}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_idx</span><span class="p">)</span>

    <span class="c1"># find the node</span>
    <span class="n">node</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="n">node_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># get data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
    <span class="n">data_effect</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;data_effect&quot;</span><span class="p">]</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_effect</span><span class="p">,</span> <span class="n">name</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="effector.regional_effect_ale.RegionalALE">
        <code>effector.regional_effect_ale.RegionalALE</code>


</h2>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="effector.regional_effect.RegionalEffectBase" href="#effector.regional_effect.RegionalEffectBase">RegionalEffectBase</a></code></p>



        <details class="quote">
          <summary>Source code in <code>/home/runner/work/effector/effector/effector/regional_effect_ale.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RegionalALE</span><span class="p">(</span><span class="n">RegionalEffectBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
        <span class="n">nof_instances</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">axis_limits</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_types</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cat_limit</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_name</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Regional RHALE constructor.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: X matrix (N,D).</span>
<span class="sd">            model: the black-box model (N,D) -&gt; (N, )</span>
<span class="sd">            model_jac: the black-box model Jacobian (N,D) -&gt; (N,D)</span>
<span class="sd">            axis_limits: axis limits for the FE plot [2, D] or None. If None, axis limits are computed from the data.</span>
<span class="sd">            feature_types: list of feature types (categorical or numerical)</span>
<span class="sd">            cat_limit: the minimum number of unique values for a feature to be considered categorical</span>
<span class="sd">            feature_names: list of feature names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RegionalALE</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="s2">&quot;ale&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">nof_instances</span><span class="p">,</span>
            <span class="n">axis_limits</span><span class="p">,</span>
            <span class="n">feature_types</span><span class="p">,</span>
            <span class="n">cat_limit</span><span class="p">,</span>
            <span class="n">feature_names</span><span class="p">,</span>
            <span class="n">target_name</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_heterogeneity_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foi</span><span class="p">,</span> <span class="n">binning_method</span><span class="p">,</span> <span class="n">min_points</span><span class="p">,</span> <span class="n">centering</span><span class="p">):</span>
        <span class="n">binning_method</span> <span class="o">=</span> <span class="n">prep_binning_method</span><span class="p">(</span><span class="n">binning_method</span><span class="p">)</span>
        <span class="nb">isinstance</span><span class="p">(</span><span class="n">binning_method</span><span class="p">,</span> <span class="n">binning_methods</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">heter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance_effects</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_points</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">BIG_M</span>

            <span class="n">ale</span> <span class="o">=</span> <span class="n">ALE</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">instance_effects</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ale</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">foi</span><span class="p">,</span> <span class="n">binning_method</span><span class="o">=</span><span class="n">binning_method</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="n">centering</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">BIG_M</span>

            <span class="c1"># heterogeneity is the accumulated std at the end of the curve</span>
            <span class="n">axis_limits</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">axis_limits_from_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">axis_limits</span><span class="p">[:,</span> <span class="n">foi</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">ale</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">feature</span><span class="o">=</span><span class="n">foi</span><span class="p">,</span> <span class="n">xs</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">z</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">heter</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
        <span class="n">heter_pcg_drop_thres</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">heter_small_enough</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">nof_candidate_splits_for_numerical</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
        <span class="n">min_points_per_subregion</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">candidate_conditioning_features</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">split_categorical_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">binning_method</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">binning_methods</span><span class="o">.</span><span class="n">Fixed</span><span class="p">]</span> <span class="o">=</span> <span class="n">binning_methods</span><span class="o">.</span><span class="n">Fixed</span><span class="p">(</span><span class="n">nof_bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">min_points_per_bin</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">centering</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the Regional RHALE for a list of features.</span>

<span class="sd">        Args:</span>
<span class="sd">            features: list of features to fit</span>
<span class="sd">            heter_pcg_drop_thres: heterogeneity drop threshold for a split to be considered important</span>
<span class="sd">            heter_small_enough: heterogeneity threshold for a region to be considered homogeneous (splitting stops)</span>
<span class="sd">            binning_method: binning method to use</span>
<span class="sd">            max_depth: maximum number of splits to perform (depth of the tree)</span>
<span class="sd">            nof_candidate_splits_for_numerical: number of candidate splits to consider for numerical features</span>
<span class="sd">            min_points_per_subregion: minimum allowed number of points in a subregion (otherwise the split is not considered as valid)</span>
<span class="sd">            candidate_conditioning_features: list of features to consider as conditioning features for the candidate splits</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="n">min_points_per_subregion</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;min_points_per_subregion must be &gt;= 2&quot;</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_features</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
            <span class="n">heter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_heterogeneity_function</span><span class="p">(</span>
                <span class="n">feat</span><span class="p">,</span> <span class="n">binning_method</span><span class="p">,</span> <span class="n">min_points_per_subregion</span><span class="p">,</span> <span class="n">centering</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_fit_feature</span><span class="p">(</span>
                <span class="n">feat</span><span class="p">,</span>
                <span class="n">heter</span><span class="p">,</span>
                <span class="n">heter_pcg_drop_thres</span><span class="p">,</span>
                <span class="n">heter_small_enough</span><span class="p">,</span>
                <span class="n">max_depth</span><span class="p">,</span>
                <span class="n">nof_candidate_splits_for_numerical</span><span class="p">,</span>
                <span class="n">min_points_per_subregion</span><span class="p">,</span>
                <span class="n">candidate_conditioning_features</span><span class="p">,</span>
                <span class="n">split_categorical_features</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">method_args</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feat</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;heter_pcg_drop_thres&quot;</span><span class="p">:</span> <span class="n">heter_pcg_drop_thres</span><span class="p">,</span>
                <span class="s2">&quot;heter_small_enough&quot;</span><span class="p">:</span> <span class="n">heter_small_enough</span><span class="p">,</span>
                <span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="n">max_depth</span><span class="p">,</span>
                <span class="s2">&quot;nof_candidate_splits_for_numerical&quot;</span><span class="p">:</span> <span class="n">nof_candidate_splits_for_numerical</span><span class="p">,</span>
                <span class="s2">&quot;min_points_per_subregion&quot;</span><span class="p">:</span> <span class="n">min_points_per_subregion</span><span class="p">,</span>
                <span class="s2">&quot;candidate_conditioning_features&quot;</span><span class="p">:</span> <span class="n">candidate_conditioning_features</span><span class="p">,</span>
                <span class="s2">&quot;split_categorical_features&quot;</span><span class="p">:</span> <span class="n">split_categorical_features</span><span class="p">,</span>
                <span class="s2">&quot;binning_method&quot;</span><span class="p">:</span> <span class="n">binning_method</span><span class="p">,</span>
                <span class="s2">&quot;centering&quot;</span><span class="p">:</span> <span class="n">centering</span><span class="p">,</span>
            <span class="p">}</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">feature</span><span class="p">,</span>
             <span class="n">node_idx</span><span class="p">,</span>
             <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">centering</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">scale_x_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">scale_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">y_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">dy_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="c1"># get data from the node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">scale_x_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_full_scaled</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitioners</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span><span class="o">.</span><span class="n">splits_to_tree</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">scale_x_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_pruned_scaled</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitioners</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span><span class="o">.</span><span class="n">splits_to_tree</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale_x_list</span><span class="p">)</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">data_effect</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_info</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">node_idx</span><span class="p">)</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">)</span>
        <span class="n">feature_names</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

        <span class="c1"># define the method and fit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_args</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;heterogeneity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">heterogeneity</span>
        <span class="n">rhale</span> <span class="o">=</span> <span class="n">RHALE</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_jac</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nof_instances</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data_effect</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="n">feature_names</span><span class="p">)</span>
        <span class="n">binning_method</span> <span class="o">=</span> <span class="n">prep_binning_method</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">method_args</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;binning_method&quot;</span><span class="p">])</span>
        <span class="n">rhale</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">binning_method</span><span class="o">=</span><span class="n">binning_method</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="n">centering</span><span class="p">)</span>
        <span class="n">scale_x</span> <span class="o">=</span> <span class="n">scale_x_list</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="k">if</span> <span class="n">scale_x_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">rhale</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">feature</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="n">heterogeneity</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="n">centering</span><span class="p">,</span> <span class="n">scale_x</span><span class="o">=</span><span class="n">scale_x</span><span class="p">,</span> <span class="n">scale_y</span><span class="o">=</span><span class="n">scale_y</span><span class="p">,</span> <span class="n">y_limits</span><span class="o">=</span><span class="n">y_limits</span><span class="p">,</span> <span class="n">dy_limits</span><span class="o">=</span><span class="n">dy_limits</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.regional_effect_ale.RegionalALE.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">nof_instances</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">axis_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">feature_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cat_limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Regional RHALE constructor.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>X matrix (N,D).</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model</code></td>
          <td>
                <code>callable</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the black-box model (N,D) -&gt; (N, )</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model_jac</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the black-box model Jacobian (N,D) -&gt; (N,D)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>axis_limits</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[None, <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>axis limits for the FE plot [2, D] or None. If None, axis limits are computed from the data.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>feature_types</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[list, None]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of feature types (categorical or numerical)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>cat_limit</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[int, None]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the minimum number of unique values for a feature to be considered categorical</p>
            </div>
          </td>
          <td>
                <code>10</code>
          </td>
        </tr>
        <tr>
          <td><code>feature_names</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[list, None]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of feature names</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/regional_effect_ale.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
    <span class="n">nof_instances</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="n">axis_limits</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_types</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cat_limit</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">feature_names</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_name</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Regional RHALE constructor.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: X matrix (N,D).</span>
<span class="sd">        model: the black-box model (N,D) -&gt; (N, )</span>
<span class="sd">        model_jac: the black-box model Jacobian (N,D) -&gt; (N,D)</span>
<span class="sd">        axis_limits: axis limits for the FE plot [2, D] or None. If None, axis limits are computed from the data.</span>
<span class="sd">        feature_types: list of feature types (categorical or numerical)</span>
<span class="sd">        cat_limit: the minimum number of unique values for a feature to be considered categorical</span>
<span class="sd">        feature_names: list of feature names</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">RegionalALE</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="s2">&quot;ale&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">model</span><span class="p">,</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">nof_instances</span><span class="p">,</span>
        <span class="n">axis_limits</span><span class="p">,</span>
        <span class="n">feature_types</span><span class="p">,</span>
        <span class="n">cat_limit</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="p">,</span>
        <span class="n">target_name</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.regional_effect_ale.RegionalALE.fit">
<code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">heter_pcg_drop_thres</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">heter_small_enough</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nof_candidate_splits_for_numerical</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">min_points_per_subregion</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">candidate_conditioning_features</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">split_categorical_features</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">binning_method</span><span class="o">=</span><span class="n">binning_methods</span><span class="o">.</span><span class="n">Fixed</span><span class="p">(</span><span class="n">nof_bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">min_points_per_bin</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">centering</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Find the Regional RHALE for a list of features.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>features</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[int, str, list]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of features to fit</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>heter_pcg_drop_thres</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>heterogeneity drop threshold for a split to be considered important</p>
            </div>
          </td>
          <td>
                <code>0.1</code>
          </td>
        </tr>
        <tr>
          <td><code>heter_small_enough</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>heterogeneity threshold for a region to be considered homogeneous (splitting stops)</p>
            </div>
          </td>
          <td>
                <code>0.1</code>
          </td>
        </tr>
        <tr>
          <td><code>binning_method</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[str, <span title="effector.binning_methods">binning_methods</span>.<a class="autorefs autorefs-internal" title="effector.binning_methods.Fixed" href="#effector.binning_methods.Fixed">Fixed</a>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>binning method to use</p>
            </div>
          </td>
          <td>
                <code>binning_methods.Fixed(nof_bins=20, min_points_per_bin=0)</code>
          </td>
        </tr>
        <tr>
          <td><code>max_depth</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>maximum number of splits to perform (depth of the tree)</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>nof_candidate_splits_for_numerical</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>number of candidate splits to consider for numerical features</p>
            </div>
          </td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr>
          <td><code>min_points_per_subregion</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>minimum allowed number of points in a subregion (otherwise the split is not considered as valid)</p>
            </div>
          </td>
          <td>
                <code>10</code>
          </td>
        </tr>
        <tr>
          <td><code>candidate_conditioning_features</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[str, list]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of features to consider as conditioning features for the candidate splits</p>
            </div>
          </td>
          <td>
                <code>&#39;all&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/regional_effect_ale.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">features</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
    <span class="n">heter_pcg_drop_thres</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">heter_small_enough</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">nof_candidate_splits_for_numerical</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="n">min_points_per_subregion</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">candidate_conditioning_features</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="n">split_categorical_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">binning_method</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">binning_methods</span><span class="o">.</span><span class="n">Fixed</span><span class="p">]</span> <span class="o">=</span> <span class="n">binning_methods</span><span class="o">.</span><span class="n">Fixed</span><span class="p">(</span><span class="n">nof_bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">min_points_per_bin</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">centering</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the Regional RHALE for a list of features.</span>

<span class="sd">    Args:</span>
<span class="sd">        features: list of features to fit</span>
<span class="sd">        heter_pcg_drop_thres: heterogeneity drop threshold for a split to be considered important</span>
<span class="sd">        heter_small_enough: heterogeneity threshold for a region to be considered homogeneous (splitting stops)</span>
<span class="sd">        binning_method: binning method to use</span>
<span class="sd">        max_depth: maximum number of splits to perform (depth of the tree)</span>
<span class="sd">        nof_candidate_splits_for_numerical: number of candidate splits to consider for numerical features</span>
<span class="sd">        min_points_per_subregion: minimum allowed number of points in a subregion (otherwise the split is not considered as valid)</span>
<span class="sd">        candidate_conditioning_features: list of features to consider as conditioning features for the candidate splits</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="n">min_points_per_subregion</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;min_points_per_subregion must be &gt;= 2&quot;</span>
    <span class="n">features</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_features</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
        <span class="n">heter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_heterogeneity_function</span><span class="p">(</span>
            <span class="n">feat</span><span class="p">,</span> <span class="n">binning_method</span><span class="p">,</span> <span class="n">min_points_per_subregion</span><span class="p">,</span> <span class="n">centering</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_feature</span><span class="p">(</span>
            <span class="n">feat</span><span class="p">,</span>
            <span class="n">heter</span><span class="p">,</span>
            <span class="n">heter_pcg_drop_thres</span><span class="p">,</span>
            <span class="n">heter_small_enough</span><span class="p">,</span>
            <span class="n">max_depth</span><span class="p">,</span>
            <span class="n">nof_candidate_splits_for_numerical</span><span class="p">,</span>
            <span class="n">min_points_per_subregion</span><span class="p">,</span>
            <span class="n">candidate_conditioning_features</span><span class="p">,</span>
            <span class="n">split_categorical_features</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">method_args</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feat</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;heter_pcg_drop_thres&quot;</span><span class="p">:</span> <span class="n">heter_pcg_drop_thres</span><span class="p">,</span>
            <span class="s2">&quot;heter_small_enough&quot;</span><span class="p">:</span> <span class="n">heter_small_enough</span><span class="p">,</span>
            <span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="n">max_depth</span><span class="p">,</span>
            <span class="s2">&quot;nof_candidate_splits_for_numerical&quot;</span><span class="p">:</span> <span class="n">nof_candidate_splits_for_numerical</span><span class="p">,</span>
            <span class="s2">&quot;min_points_per_subregion&quot;</span><span class="p">:</span> <span class="n">min_points_per_subregion</span><span class="p">,</span>
            <span class="s2">&quot;candidate_conditioning_features&quot;</span><span class="p">:</span> <span class="n">candidate_conditioning_features</span><span class="p">,</span>
            <span class="s2">&quot;split_categorical_features&quot;</span><span class="p">:</span> <span class="n">split_categorical_features</span><span class="p">,</span>
            <span class="s2">&quot;binning_method&quot;</span><span class="p">:</span> <span class="n">binning_method</span><span class="p">,</span>
            <span class="s2">&quot;centering&quot;</span><span class="p">:</span> <span class="n">centering</span><span class="p">,</span>
        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="effector.regional_effect_ale.RegionalRHALE">
        <code>effector.regional_effect_ale.RegionalRHALE</code>


</h2>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="effector.regional_effect.RegionalEffectBase" href="#effector.regional_effect.RegionalEffectBase">RegionalEffectBase</a></code></p>



        <details class="quote">
          <summary>Source code in <code>/home/runner/work/effector/effector/effector/regional_effect_ale.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RegionalRHALE</span><span class="p">(</span><span class="n">RegionalEffectBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
        <span class="n">model_jac</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">instance_effects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nof_instances</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">axis_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cat_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Regional RHALE constructor.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: X matrix (N,D).</span>
<span class="sd">            model: the black-box model (N,D) -&gt; (N, )</span>
<span class="sd">            model_jac: the black-box model Jacobian (N,D) -&gt; (N,D)</span>
<span class="sd">            axis_limits: axis limits for the FE plot [2, D] or None. If None, axis limits are computed from the data.</span>
<span class="sd">            feature_types: list of feature types (categorical or numerical)</span>
<span class="sd">            cat_limit: the minimum number of unique values for a feature to be considered categorical</span>
<span class="sd">            feature_names: list of feature names</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">instance_effects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">model_jac</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">instance_effects</span> <span class="o">=</span> <span class="n">model_jac</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">instance_effects</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">compute_jacobian_numerically</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


        <span class="nb">super</span><span class="p">(</span><span class="n">RegionalRHALE</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="s2">&quot;rhale&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="n">model_jac</span><span class="p">,</span>
            <span class="n">instance_effects</span><span class="p">,</span>
            <span class="n">nof_instances</span><span class="p">,</span>
            <span class="n">axis_limits</span><span class="p">,</span>
            <span class="n">feature_types</span><span class="p">,</span>
            <span class="n">cat_limit</span><span class="p">,</span>
            <span class="n">feature_names</span><span class="p">,</span>
            <span class="n">target_name</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_heterogeneity_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foi</span><span class="p">,</span> <span class="n">binning_method</span><span class="p">,</span> <span class="n">min_points</span><span class="p">,</span> <span class="n">centering</span><span class="p">):</span>
        <span class="n">binning_method</span> <span class="o">=</span> <span class="n">prep_binning_method</span><span class="p">(</span><span class="n">binning_method</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">heter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance_effects</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_points</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">BIG_M</span>

            <span class="n">rhale</span> <span class="o">=</span> <span class="n">RHALE</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_jac</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">instance_effects</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rhale</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">foi</span><span class="p">,</span> <span class="n">binning_method</span><span class="o">=</span><span class="n">binning_method</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="n">centering</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">BIG_M</span>

            <span class="c1"># heterogeneity is the accumulated std at the end of the curve</span>
            <span class="n">axis_limits</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">axis_limits_from_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">axis_limits</span><span class="p">[:,</span> <span class="n">foi</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">rhale</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">feature</span><span class="o">=</span><span class="n">foi</span><span class="p">,</span> <span class="n">xs</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">z</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">heter</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">heter_pcg_drop_thres</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">heter_small_enough</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">nof_candidate_splits_for_numerical</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
        <span class="n">min_points_per_subregion</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">candidate_conditioning_features</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">split_categorical_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">binning_method</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span>
                <span class="nb">str</span><span class="p">,</span>
                <span class="n">binning_methods</span><span class="o">.</span><span class="n">Fixed</span><span class="p">,</span>
                <span class="n">binning_methods</span><span class="o">.</span><span class="n">DynamicProgramming</span><span class="p">,</span>
                <span class="n">binning_methods</span><span class="o">.</span><span class="n">Greedy</span><span class="p">,</span>
        <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;greedy&quot;</span><span class="p">,</span>
        <span class="n">centering</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the Regional RHALE for a list of features.</span>

<span class="sd">        Args:</span>
<span class="sd">            features: list of features to fit</span>
<span class="sd">            heter_pcg_drop_thres: heterogeneity drop threshold for a split to be considered important</span>
<span class="sd">            heter_small_enough: heterogeneity threshold for a region to be considered homogeneous (splitting stops)</span>
<span class="sd">            binning_method: binning method to use</span>
<span class="sd">            max_depth: maximum number of splits to perform (depth of the tree)</span>
<span class="sd">            nof_candidate_splits_for_numerical: number of candidate splits to consider for numerical features</span>
<span class="sd">            min_points_per_subregion: minimum allowed number of points in a subregion (otherwise the split is not considered as valid)</span>
<span class="sd">            candidate_conditioning_features: list of features to consider as conditioning features for the candidate splits</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="n">min_points_per_subregion</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;min_points_per_subregion must be &gt;= 2&quot;</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_features</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
            <span class="n">heter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_heterogeneity_function</span><span class="p">(</span>
                <span class="n">feat</span><span class="p">,</span> <span class="n">binning_method</span><span class="p">,</span> <span class="n">min_points_per_subregion</span><span class="p">,</span> <span class="n">centering</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_fit_feature</span><span class="p">(</span>
                <span class="n">feat</span><span class="p">,</span>
                <span class="n">heter</span><span class="p">,</span>
                <span class="n">heter_pcg_drop_thres</span><span class="p">,</span>
                <span class="n">heter_small_enough</span><span class="p">,</span>
                <span class="n">max_depth</span><span class="p">,</span>
                <span class="n">nof_candidate_splits_for_numerical</span><span class="p">,</span>
                <span class="n">min_points_per_subregion</span><span class="p">,</span>
                <span class="n">candidate_conditioning_features</span><span class="p">,</span>
                <span class="n">split_categorical_features</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">method_args</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feat</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;heter_pcg_drop_thres&quot;</span><span class="p">:</span> <span class="n">heter_pcg_drop_thres</span><span class="p">,</span>
                <span class="s2">&quot;heter_small_enough&quot;</span><span class="p">:</span> <span class="n">heter_small_enough</span><span class="p">,</span>
                <span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="n">max_depth</span><span class="p">,</span>
                <span class="s2">&quot;nof_candidate_splits_for_numerical&quot;</span><span class="p">:</span> <span class="n">nof_candidate_splits_for_numerical</span><span class="p">,</span>
                <span class="s2">&quot;min_points_per_subregion&quot;</span><span class="p">:</span> <span class="n">min_points_per_subregion</span><span class="p">,</span>
                <span class="s2">&quot;candidate_conditioning_features&quot;</span><span class="p">:</span> <span class="n">candidate_conditioning_features</span><span class="p">,</span>
                <span class="s2">&quot;split_categorical_features&quot;</span><span class="p">:</span> <span class="n">split_categorical_features</span><span class="p">,</span>
                <span class="s2">&quot;binning_method&quot;</span><span class="p">:</span> <span class="n">binning_method</span><span class="p">,</span>
            <span class="p">}</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">feature</span><span class="p">,</span>
             <span class="n">node_idx</span><span class="p">,</span>
             <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">centering</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">scale_x_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">scale_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">y_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">dy_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="c1"># get data from the node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">scale_x_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_full_scaled</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitioners</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span><span class="o">.</span><span class="n">splits_to_tree</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">scale_x_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_pruned_scaled</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitioners</span><span class="p">[</span><span class="s2">&quot;feature_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">)]</span><span class="o">.</span><span class="n">splits_to_tree</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale_x_list</span><span class="p">)</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">data_effect</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_info</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">node_idx</span><span class="p">)</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">)</span>
        <span class="n">feature_names</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

        <span class="c1"># define the method and fit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_args</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;heterogeneity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">heterogeneity</span>
        <span class="n">rhale</span> <span class="o">=</span> <span class="n">RHALE</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_jac</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nof_instances</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data_effect</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="n">feature_names</span><span class="p">)</span>
        <span class="n">binning_method</span> <span class="o">=</span> <span class="n">prep_binning_method</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">method_args</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)][</span><span class="s2">&quot;binning_method&quot;</span><span class="p">])</span>
        <span class="n">rhale</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">binning_method</span><span class="o">=</span><span class="n">binning_method</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="n">centering</span><span class="p">)</span>
        <span class="n">scale_x</span> <span class="o">=</span> <span class="n">scale_x_list</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="k">if</span> <span class="n">scale_x_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">rhale</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">feature</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="n">heterogeneity</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="n">centering</span><span class="p">,</span> <span class="n">scale_x</span><span class="o">=</span><span class="n">scale_x</span><span class="p">,</span> <span class="n">scale_y</span><span class="o">=</span><span class="n">scale_y</span><span class="p">,</span> <span class="n">y_limits</span><span class="o">=</span><span class="n">y_limits</span><span class="p">,</span> <span class="n">dy_limits</span><span class="o">=</span><span class="n">dy_limits</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.regional_effect_ale.RegionalRHALE.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">model_jac</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">instance_effects</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nof_instances</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">axis_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">feature_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cat_limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Regional RHALE constructor.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>X matrix (N,D).</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model</code></td>
          <td>
                <code><span title="typing.Callable">Callable</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the black-box model (N,D) -&gt; (N, )</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model_jac</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.Callable">Callable</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the black-box model Jacobian (N,D) -&gt; (N,D)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>axis_limits</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>axis limits for the FE plot [2, D] or None. If None, axis limits are computed from the data.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>feature_types</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of feature types (categorical or numerical)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>cat_limit</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the minimum number of unique values for a feature to be considered categorical</p>
            </div>
          </td>
          <td>
                <code>10</code>
          </td>
        </tr>
        <tr>
          <td><code>feature_names</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of feature names</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/regional_effect_ale.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="n">model_jac</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">instance_effects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">nof_instances</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="n">axis_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cat_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">feature_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Regional RHALE constructor.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: X matrix (N,D).</span>
<span class="sd">        model: the black-box model (N,D) -&gt; (N, )</span>
<span class="sd">        model_jac: the black-box model Jacobian (N,D) -&gt; (N,D)</span>
<span class="sd">        axis_limits: axis limits for the FE plot [2, D] or None. If None, axis limits are computed from the data.</span>
<span class="sd">        feature_types: list of feature types (categorical or numerical)</span>
<span class="sd">        cat_limit: the minimum number of unique values for a feature to be considered categorical</span>
<span class="sd">        feature_names: list of feature names</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">instance_effects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model_jac</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instance_effects</span> <span class="o">=</span> <span class="n">model_jac</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">instance_effects</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">compute_jacobian_numerically</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="nb">super</span><span class="p">(</span><span class="n">RegionalRHALE</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="s2">&quot;rhale&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">model</span><span class="p">,</span>
        <span class="n">model_jac</span><span class="p">,</span>
        <span class="n">instance_effects</span><span class="p">,</span>
        <span class="n">nof_instances</span><span class="p">,</span>
        <span class="n">axis_limits</span><span class="p">,</span>
        <span class="n">feature_types</span><span class="p">,</span>
        <span class="n">cat_limit</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="p">,</span>
        <span class="n">target_name</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.regional_effect_ale.RegionalRHALE.fit">
<code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">heter_pcg_drop_thres</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">heter_small_enough</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nof_candidate_splits_for_numerical</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">min_points_per_subregion</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">candidate_conditioning_features</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">split_categorical_features</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">binning_method</span><span class="o">=</span><span class="s1">&#39;greedy&#39;</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Find the Regional RHALE for a list of features.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>features</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[int, str, list]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of features to fit</p>
            </div>
          </td>
          <td>
                <code>&#39;all&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>heter_pcg_drop_thres</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>heterogeneity drop threshold for a split to be considered important</p>
            </div>
          </td>
          <td>
                <code>0.1</code>
          </td>
        </tr>
        <tr>
          <td><code>heter_small_enough</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>heterogeneity threshold for a region to be considered homogeneous (splitting stops)</p>
            </div>
          </td>
          <td>
                <code>0.1</code>
          </td>
        </tr>
        <tr>
          <td><code>binning_method</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[str, <span title="effector.binning_methods">binning_methods</span>.<a class="autorefs autorefs-internal" title="effector.binning_methods.Fixed" href="#effector.binning_methods.Fixed">Fixed</a>, <span title="effector.binning_methods">binning_methods</span>.<a class="autorefs autorefs-internal" title="effector.binning_methods.DynamicProgramming" href="#effector.binning_methods.DynamicProgramming">DynamicProgramming</a>, <span title="effector.binning_methods">binning_methods</span>.<a class="autorefs autorefs-internal" title="effector.binning_methods.Greedy" href="#effector.binning_methods.Greedy">Greedy</a>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>binning method to use</p>
            </div>
          </td>
          <td>
                <code>&#39;greedy&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>max_depth</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>maximum number of splits to perform (depth of the tree)</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>nof_candidate_splits_for_numerical</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>number of candidate splits to consider for numerical features</p>
            </div>
          </td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr>
          <td><code>min_points_per_subregion</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>minimum allowed number of points in a subregion (otherwise the split is not considered as valid)</p>
            </div>
          </td>
          <td>
                <code>10</code>
          </td>
        </tr>
        <tr>
          <td><code>candidate_conditioning_features</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[str, list]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of features to consider as conditioning features for the candidate splits</p>
            </div>
          </td>
          <td>
                <code>&#39;all&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/regional_effect_ale.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">features</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="n">heter_pcg_drop_thres</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">heter_small_enough</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">nof_candidate_splits_for_numerical</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="n">min_points_per_subregion</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">candidate_conditioning_features</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="n">split_categorical_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">binning_method</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span>
            <span class="nb">str</span><span class="p">,</span>
            <span class="n">binning_methods</span><span class="o">.</span><span class="n">Fixed</span><span class="p">,</span>
            <span class="n">binning_methods</span><span class="o">.</span><span class="n">DynamicProgramming</span><span class="p">,</span>
            <span class="n">binning_methods</span><span class="o">.</span><span class="n">Greedy</span><span class="p">,</span>
    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;greedy&quot;</span><span class="p">,</span>
    <span class="n">centering</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the Regional RHALE for a list of features.</span>

<span class="sd">    Args:</span>
<span class="sd">        features: list of features to fit</span>
<span class="sd">        heter_pcg_drop_thres: heterogeneity drop threshold for a split to be considered important</span>
<span class="sd">        heter_small_enough: heterogeneity threshold for a region to be considered homogeneous (splitting stops)</span>
<span class="sd">        binning_method: binning method to use</span>
<span class="sd">        max_depth: maximum number of splits to perform (depth of the tree)</span>
<span class="sd">        nof_candidate_splits_for_numerical: number of candidate splits to consider for numerical features</span>
<span class="sd">        min_points_per_subregion: minimum allowed number of points in a subregion (otherwise the split is not considered as valid)</span>
<span class="sd">        candidate_conditioning_features: list of features to consider as conditioning features for the candidate splits</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="n">min_points_per_subregion</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;min_points_per_subregion must be &gt;= 2&quot;</span>
    <span class="n">features</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_features</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
        <span class="n">heter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_heterogeneity_function</span><span class="p">(</span>
            <span class="n">feat</span><span class="p">,</span> <span class="n">binning_method</span><span class="p">,</span> <span class="n">min_points_per_subregion</span><span class="p">,</span> <span class="n">centering</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_feature</span><span class="p">(</span>
            <span class="n">feat</span><span class="p">,</span>
            <span class="n">heter</span><span class="p">,</span>
            <span class="n">heter_pcg_drop_thres</span><span class="p">,</span>
            <span class="n">heter_small_enough</span><span class="p">,</span>
            <span class="n">max_depth</span><span class="p">,</span>
            <span class="n">nof_candidate_splits_for_numerical</span><span class="p">,</span>
            <span class="n">min_points_per_subregion</span><span class="p">,</span>
            <span class="n">candidate_conditioning_features</span><span class="p">,</span>
            <span class="n">split_categorical_features</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">method_args</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feat</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;heter_pcg_drop_thres&quot;</span><span class="p">:</span> <span class="n">heter_pcg_drop_thres</span><span class="p">,</span>
            <span class="s2">&quot;heter_small_enough&quot;</span><span class="p">:</span> <span class="n">heter_small_enough</span><span class="p">,</span>
            <span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="n">max_depth</span><span class="p">,</span>
            <span class="s2">&quot;nof_candidate_splits_for_numerical&quot;</span><span class="p">:</span> <span class="n">nof_candidate_splits_for_numerical</span><span class="p">,</span>
            <span class="s2">&quot;min_points_per_subregion&quot;</span><span class="p">:</span> <span class="n">min_points_per_subregion</span><span class="p">,</span>
            <span class="s2">&quot;candidate_conditioning_features&quot;</span><span class="p">:</span> <span class="n">candidate_conditioning_features</span><span class="p">,</span>
            <span class="s2">&quot;split_categorical_features&quot;</span><span class="p">:</span> <span class="n">split_categorical_features</span><span class="p">,</span>
            <span class="s2">&quot;binning_method&quot;</span><span class="p">:</span> <span class="n">binning_method</span><span class="p">,</span>
        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="effector.regional_effect_pdp.RegionalPDPBase">
        <code>effector.regional_effect_pdp.RegionalPDPBase</code>


</h2>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="effector.regional_effect.RegionalEffectBase" href="#effector.regional_effect.RegionalEffectBase">RegionalEffectBase</a></code></p>



        <details class="quote">
          <summary>Source code in <code>/home/runner/work/effector/effector/effector/regional_effect_pdp.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RegionalPDPBase</span><span class="p">(</span><span class="n">RegionalEffectBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">method_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
        <span class="n">model_jac</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nof_instances</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">axis_limits</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_types</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cat_limit</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_name</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RegionalPDPBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">method_name</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="n">model_jac</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">nof_instances</span><span class="p">,</span>
            <span class="n">axis_limits</span><span class="p">,</span>
            <span class="n">feature_types</span><span class="p">,</span>
            <span class="n">cat_limit</span><span class="p">,</span>
            <span class="n">feature_names</span><span class="p">,</span>
            <span class="n">target_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_heterogeneity_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foi</span><span class="p">,</span> <span class="n">min_points</span><span class="p">,</span> <span class="n">centering</span><span class="p">,</span> <span class="n">nof_instances</span><span class="p">,</span> <span class="n">points_for_centering</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">heter</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_points</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">BIG_M</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">==</span> <span class="s2">&quot;pdp&quot;</span><span class="p">:</span>
                <span class="n">pdp</span> <span class="o">=</span> <span class="n">PDP</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">,</span> <span class="n">nof_instances</span><span class="o">=</span><span class="n">nof_instances</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pdp</span> <span class="o">=</span> <span class="n">DerivativePDP</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_jac</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_limits</span><span class="p">,</span> <span class="n">nof_instances</span><span class="o">=</span><span class="n">nof_instances</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">pdp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">foi</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="n">centering</span><span class="p">,</span> <span class="n">points_for_centering</span><span class="o">=</span><span class="n">points_for_centering</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">BIG_M</span>

            <span class="c1"># heterogeneity is the mean heterogeneity over the curve</span>
            <span class="n">axis_limits</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">axis_limits_from_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">axis_limits</span><span class="p">[:,</span> <span class="n">foi</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis_limits</span><span class="p">[:,</span> <span class="n">foi</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">pdp</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">feature</span><span class="o">=</span><span class="n">foi</span><span class="p">,</span> <span class="n">xs</span><span class="o">=</span><span class="n">xx</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">BIG_M</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">heter</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">heter_pcg_drop_thres</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">heter_small_enough</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">nof_candidate_splits_for_numerical</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
        <span class="n">min_points_per_subregion</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">candidate_conditioning_features</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">split_categorical_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">centering</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">nof_instances</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">points_for_centering</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the Regional PDP for a list of features.</span>

<span class="sd">        Args:</span>
<span class="sd">            features: list of features to fit</span>
<span class="sd">            heter_pcg_drop_thres: heterogeneity drop threshold for a split to be considered important</span>
<span class="sd">            heter_small_enough: heterogeneity threshold for a region to be considered homogeneous (splitting stops)</span>
<span class="sd">            max_depth: maximum number of splits to perform (depth of the tree)</span>
<span class="sd">            nof_candidate_splits_for_numerical: number of candidate splits to consider for numerical features</span>
<span class="sd">            min_points_per_subregion: minimum allowed number of points in a subregion (otherwise the split is not considered as valid)</span>
<span class="sd">            candidate_conditioning_features: list of features to consider as conditioning features for the candidate splits</span>
<span class="sd">            split_categorical_features</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="n">min_points_per_subregion</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;min_points_per_subregion must be &gt;= 2&quot;</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_features</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
            <span class="n">heter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_heterogeneity_function</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="n">min_points_per_subregion</span><span class="p">,</span> <span class="n">centering</span><span class="p">,</span> <span class="n">nof_instances</span><span class="p">,</span> <span class="n">points_for_centering</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_fit_feature</span><span class="p">(</span>
                <span class="n">feat</span><span class="p">,</span>
                <span class="n">heter</span><span class="p">,</span>
                <span class="n">heter_pcg_drop_thres</span><span class="p">,</span>
                <span class="n">heter_small_enough</span><span class="p">,</span>
                <span class="n">max_depth</span><span class="p">,</span>
                <span class="n">nof_candidate_splits_for_numerical</span><span class="p">,</span>
                <span class="n">min_points_per_subregion</span><span class="p">,</span>
                <span class="n">candidate_conditioning_features</span><span class="p">,</span>
                <span class="n">split_categorical_features</span><span class="p">,</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.regional_effect_pdp.RegionalPDPBase.fit">
<code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">heter_pcg_drop_thres</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">heter_small_enough</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nof_candidate_splits_for_numerical</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">min_points_per_subregion</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">candidate_conditioning_features</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">split_categorical_features</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nof_instances</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">points_for_centering</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Find the Regional PDP for a list of features.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>features</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[int, str, list]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of features to fit</p>
            </div>
          </td>
          <td>
                <code>&#39;all&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>heter_pcg_drop_thres</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>heterogeneity drop threshold for a split to be considered important</p>
            </div>
          </td>
          <td>
                <code>0.1</code>
          </td>
        </tr>
        <tr>
          <td><code>heter_small_enough</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>heterogeneity threshold for a region to be considered homogeneous (splitting stops)</p>
            </div>
          </td>
          <td>
                <code>0.1</code>
          </td>
        </tr>
        <tr>
          <td><code>max_depth</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>maximum number of splits to perform (depth of the tree)</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>nof_candidate_splits_for_numerical</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>number of candidate splits to consider for numerical features</p>
            </div>
          </td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr>
          <td><code>min_points_per_subregion</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>minimum allowed number of points in a subregion (otherwise the split is not considered as valid)</p>
            </div>
          </td>
          <td>
                <code>10</code>
          </td>
        </tr>
        <tr>
          <td><code>candidate_conditioning_features</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[str, list]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of features to consider as conditioning features for the candidate splits</p>
            </div>
          </td>
          <td>
                <code>&#39;all&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/regional_effect_pdp.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">features</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="n">heter_pcg_drop_thres</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">heter_small_enough</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">nof_candidate_splits_for_numerical</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="n">min_points_per_subregion</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">candidate_conditioning_features</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="n">split_categorical_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">centering</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">nof_instances</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="n">points_for_centering</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the Regional PDP for a list of features.</span>

<span class="sd">    Args:</span>
<span class="sd">        features: list of features to fit</span>
<span class="sd">        heter_pcg_drop_thres: heterogeneity drop threshold for a split to be considered important</span>
<span class="sd">        heter_small_enough: heterogeneity threshold for a region to be considered homogeneous (splitting stops)</span>
<span class="sd">        max_depth: maximum number of splits to perform (depth of the tree)</span>
<span class="sd">        nof_candidate_splits_for_numerical: number of candidate splits to consider for numerical features</span>
<span class="sd">        min_points_per_subregion: minimum allowed number of points in a subregion (otherwise the split is not considered as valid)</span>
<span class="sd">        candidate_conditioning_features: list of features to consider as conditioning features for the candidate splits</span>
<span class="sd">        split_categorical_features</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="n">min_points_per_subregion</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;min_points_per_subregion must be &gt;= 2&quot;</span>
    <span class="n">features</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_features</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
        <span class="n">heter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_heterogeneity_function</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="n">min_points_per_subregion</span><span class="p">,</span> <span class="n">centering</span><span class="p">,</span> <span class="n">nof_instances</span><span class="p">,</span> <span class="n">points_for_centering</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_feature</span><span class="p">(</span>
            <span class="n">feat</span><span class="p">,</span>
            <span class="n">heter</span><span class="p">,</span>
            <span class="n">heter_pcg_drop_thres</span><span class="p">,</span>
            <span class="n">heter_small_enough</span><span class="p">,</span>
            <span class="n">max_depth</span><span class="p">,</span>
            <span class="n">nof_candidate_splits_for_numerical</span><span class="p">,</span>
            <span class="n">min_points_per_subregion</span><span class="p">,</span>
            <span class="n">candidate_conditioning_features</span><span class="p">,</span>
            <span class="n">split_categorical_features</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="effector.regional_effect_pdp.RegionalPDP">
        <code>effector.regional_effect_pdp.RegionalPDP</code>


</h2>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="effector.regional_effect_pdp.RegionalPDPBase" href="#effector.regional_effect_pdp.RegionalPDPBase">RegionalPDPBase</a></code></p>



        <details class="quote">
          <summary>Source code in <code>/home/runner/work/effector/effector/effector/regional_effect_pdp.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RegionalPDP</span><span class="p">(</span><span class="n">RegionalPDPBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
        <span class="n">nof_instances</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">axis_limits</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_types</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cat_limit</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_name</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RegionalPDP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="s2">&quot;pdp&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">nof_instances</span><span class="p">,</span>
            <span class="n">axis_limits</span><span class="p">,</span>
            <span class="n">feature_types</span><span class="p">,</span>
            <span class="n">cat_limit</span><span class="p">,</span>
            <span class="n">feature_names</span><span class="p">,</span>
            <span class="n">target_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.regional_effect_pdp.RegionalPDP.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">nof_instances</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">axis_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">feature_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cat_limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/regional_effect_pdp.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
    <span class="n">nof_instances</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">axis_limits</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_types</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cat_limit</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">feature_names</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_name</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">RegionalPDP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="s2">&quot;pdp&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">model</span><span class="p">,</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">nof_instances</span><span class="p">,</span>
        <span class="n">axis_limits</span><span class="p">,</span>
        <span class="n">feature_types</span><span class="p">,</span>
        <span class="n">cat_limit</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="p">,</span>
        <span class="n">target_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="effector.regional_effect_pdp.RegionalDerivativePDP">
        <code>effector.regional_effect_pdp.RegionalDerivativePDP</code>


</h2>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="effector.regional_effect_pdp.RegionalPDPBase" href="#effector.regional_effect_pdp.RegionalPDPBase">RegionalPDPBase</a></code></p>



        <details class="quote">
          <summary>Source code in <code>/home/runner/work/effector/effector/effector/regional_effect_pdp.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RegionalDerivativePDP</span><span class="p">(</span><span class="n">RegionalPDPBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
        <span class="n">model_jac</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nof_instances</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">axis_limits</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_types</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cat_limit</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_name</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RegionalDerivativePDP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="s2">&quot;d-pdp&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="n">model_jac</span><span class="p">,</span>
            <span class="n">nof_instances</span><span class="p">,</span>
            <span class="n">axis_limits</span><span class="p">,</span>
            <span class="n">feature_types</span><span class="p">,</span>
            <span class="n">cat_limit</span><span class="p">,</span>
            <span class="n">feature_names</span><span class="p">,</span>
            <span class="n">target_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.regional_effect_pdp.RegionalDerivativePDP.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">model_jac</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nof_instances</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">axis_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">feature_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cat_limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/regional_effect_pdp.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
    <span class="n">model_jac</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">nof_instances</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">axis_limits</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_types</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cat_limit</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">feature_names</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_name</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">RegionalDerivativePDP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="s2">&quot;d-pdp&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">model</span><span class="p">,</span>
        <span class="n">model_jac</span><span class="p">,</span>
        <span class="n">nof_instances</span><span class="p">,</span>
        <span class="n">axis_limits</span><span class="p">,</span>
        <span class="n">feature_types</span><span class="p">,</span>
        <span class="n">cat_limit</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="p">,</span>
        <span class="n">target_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="effector.regional_effect_shap.RegionalSHAP">
        <code>effector.regional_effect_shap.RegionalSHAP</code>


</h2>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="effector.regional_effect.RegionalEffectBase" href="#effector.regional_effect.RegionalEffectBase">RegionalEffectBase</a></code></p>



        <details class="quote">
          <summary>Source code in <code>/home/runner/work/effector/effector/effector/regional_effect_shap.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RegionalSHAP</span><span class="p">(</span><span class="n">RegionalEffectBase</span><span class="p">):</span>
    <span class="n">big_m</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">BIG_M</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
        <span class="n">axis_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nof_instances</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">feature_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cat_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Regional SHAP constructor.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: the design matrix</span>

<span class="sd">                - shape: `(N,D)`</span>
<span class="sd">            model: the black-box model. Must be a `Callable` with:</span>

<span class="sd">                - input: `ndarray` of shape `(N, D)`</span>
<span class="sd">                - output: `ndarray` of shape `(N, )`</span>

<span class="sd">            axis_limits: The limits of the feature effect plot along each axis</span>

<span class="sd">                - use a `ndarray` of shape `(2, D)`, to specify them manually</span>
<span class="sd">                - use `None`, to be inferred from the data</span>

<span class="sd">            nof_instances: maximum number of instances to be used for PDP.</span>

<span class="sd">                - use &quot;all&quot;, for using all instances.</span>
<span class="sd">                - use an `int`, for using `nof_instances` instances.</span>

<span class="sd">            feature_types: The feature types.</span>

<span class="sd">                - use `None`, to infer them from the data; whether a feature is categorical or numerical is inferred</span>
<span class="sd">                from whether it exceeds the `cat_limit` unique values.</span>
<span class="sd">                - use a list with elements `&quot;cat&quot;` or `&quot;numerical&quot;`, to specify them manually.</span>

<span class="sd">            cat_limit: the minimum number of unique values for a feature to be considered categorical</span>

<span class="sd">            feature_names: The names of the features</span>

<span class="sd">                - use a `list` of `str`, to specify the name manually. For example: `                  [&quot;age&quot;, &quot;weight&quot;, ...]`</span>
<span class="sd">                - use `None`, to keep the default names: `[&quot;x_0&quot;, &quot;x_1&quot;, ...]`</span>

<span class="sd">            target_name: The name of the target variable</span>

<span class="sd">                - use a `str`, to specify it name manually. For example: `&quot;price&quot;`</span>
<span class="sd">                - use `None`, to keep the default name: `&quot;y&quot;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RegionalSHAP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="s2">&quot;shap&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">nof_instances</span><span class="p">,</span>
            <span class="n">axis_limits</span><span class="p">,</span>
            <span class="n">feature_types</span><span class="p">,</span>
            <span class="n">cat_limit</span><span class="p">,</span>
            <span class="n">feature_names</span><span class="p">,</span>
            <span class="n">target_name</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_heterogeneity_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foi</span><span class="p">,</span> <span class="n">min_points</span><span class="p">,</span> <span class="n">centering</span><span class="p">,</span> <span class="n">points_for_centering</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">heterogeneity_function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_points</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">big_m</span>

            <span class="n">axis_limits</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">axis_limits_from_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">axis_limits</span><span class="p">[:,</span> <span class="n">foi</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis_limits</span><span class="p">[:,</span> <span class="n">foi</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>

            <span class="n">shap</span> <span class="o">=</span> <span class="n">SHAPDependence</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nof_instances</span><span class="p">)</span>
            <span class="n">shap</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">foi</span><span class="p">,</span> <span class="n">centering</span><span class="p">,</span> <span class="n">points_for_centering</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">foi</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">heterogeneity</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">heterogeneity_function</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">features</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
            <span class="n">heter_pcg_drop_thres</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="n">heter_small_enough</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">nof_candidate_splits_for_numerical</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
            <span class="n">min_points_per_subregion</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
            <span class="n">candidate_conditioning_features</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
            <span class="n">split_categorical_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">centering</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">points_for_centering</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit the regional SHAP.</span>

<span class="sd">        Args:</span>
<span class="sd">            features: the features to fit.</span>
<span class="sd">                - If set to &quot;all&quot;, all the features will be fitted.</span>

<span class="sd">            heter_pcg_drop_thres: threshold for the percentage drop in heterogeneity to consider a split valid</span>
<span class="sd">            heter_small_enough: heterogeneity threshold for a region to be considered homogeneous (splitting stops)</span>
<span class="sd">            max_depth: maximum number of splits to perform (depth of the tree)</span>
<span class="sd">            nof_candidate_splits_for_numerical: number of candidate splits to consider for numerical features</span>
<span class="sd">            min_points_per_subregion: minimum allowed number of points in a subregion (otherwise the split is not considered as valid)</span>
<span class="sd">            candidate_conditioning_features: list of features to consider as conditioning features for the candidate splits</span>
<span class="sd">            split_categorical_features: whether to search for subregions in categorical features</span>
<span class="sd">            centering: whether to center the SHAP dependence plots before estimating the heterogeneity</span>
<span class="sd">            points_for_centering: number of points to use for centering</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">min_points_per_subregion</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;min_points_per_subregion must be &gt;= 2&quot;</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_features</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
            <span class="n">heter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_heterogeneity_function</span><span class="p">(</span>
                <span class="n">feat</span><span class="p">,</span> <span class="n">min_points_per_subregion</span><span class="p">,</span> <span class="n">centering</span><span class="p">,</span> <span class="n">points_for_centering</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_fit_feature</span><span class="p">(</span>
                <span class="n">feat</span><span class="p">,</span>
                <span class="n">heter</span><span class="p">,</span>
                <span class="n">heter_pcg_drop_thres</span><span class="p">,</span>
                <span class="n">heter_small_enough</span><span class="p">,</span>
                <span class="n">max_depth</span><span class="p">,</span>
                <span class="n">nof_candidate_splits_for_numerical</span><span class="p">,</span>
                <span class="n">min_points_per_subregion</span><span class="p">,</span>
                <span class="n">candidate_conditioning_features</span><span class="p">,</span>
                <span class="n">split_categorical_features</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">method_args</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feat</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;heter_pcg_drop_thres&quot;</span><span class="p">:</span> <span class="n">heter_pcg_drop_thres</span><span class="p">,</span>
                <span class="s2">&quot;heter_small_enough&quot;</span><span class="p">:</span> <span class="n">heter_small_enough</span><span class="p">,</span>
                <span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="n">max_depth</span><span class="p">,</span>
                <span class="s2">&quot;nof_candidate_splits_for_numerical&quot;</span><span class="p">:</span> <span class="n">nof_candidate_splits_for_numerical</span><span class="p">,</span>
                <span class="s2">&quot;min_points_per_subregion&quot;</span><span class="p">:</span> <span class="n">min_points_per_subregion</span><span class="p">,</span>
                <span class="s2">&quot;candidate_conditioning_features&quot;</span><span class="p">:</span> <span class="n">candidate_conditioning_features</span><span class="p">,</span>
                <span class="s2">&quot;split_categorical_features&quot;</span><span class="p">:</span> <span class="n">split_categorical_features</span><span class="p">,</span>
                <span class="s2">&quot;centering&quot;</span><span class="p">:</span> <span class="n">centering</span><span class="p">,</span>
                <span class="s2">&quot;points_for_centering&quot;</span><span class="p">:</span> <span class="n">points_for_centering</span><span class="p">,</span>
            <span class="p">}</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.regional_effect_shap.RegionalSHAP.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">axis_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nof_instances</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">feature_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cat_limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Regional SHAP constructor.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the design matrix</p>
<ul>
<li>shape: <code>(N,D)</code></li>
</ul>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model</code></td>
          <td>
                <code><span title="typing.Callable">Callable</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the black-box model. Must be a <code>Callable</code> with:</p>
<ul>
<li>input: <code>ndarray</code> of shape <code>(N, D)</code></li>
<li>output: <code>ndarray</code> of shape <code>(N, )</code></li>
</ul>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>axis_limits</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The limits of the feature effect plot along each axis</p>
<ul>
<li>use a <code>ndarray</code> of shape <code>(2, D)</code>, to specify them manually</li>
<li>use <code>None</code>, to be inferred from the data</li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>nof_instances</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[int, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>maximum number of instances to be used for PDP.</p>
<ul>
<li>use "all", for using all instances.</li>
<li>use an <code>int</code>, for using <code>nof_instances</code> instances.</li>
</ul>
            </div>
          </td>
          <td>
                <code>100</code>
          </td>
        </tr>
        <tr>
          <td><code>feature_types</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[str]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The feature types.</p>
<ul>
<li>use <code>None</code>, to infer them from the data; whether a feature is categorical or numerical is inferred
from whether it exceeds the <code>cat_limit</code> unique values.</li>
<li>use a list with elements <code>"cat"</code> or <code>"numerical"</code>, to specify them manually.</li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>cat_limit</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the minimum number of unique values for a feature to be considered categorical</p>
            </div>
          </td>
          <td>
                <code>10</code>
          </td>
        </tr>
        <tr>
          <td><code>feature_names</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[str]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The names of the features</p>
<ul>
<li>use a <code>list</code> of <code>str</code>, to specify the name manually. For example: <code>["age", "weight", ...]</code></li>
<li>use <code>None</code>, to keep the default names: <code>["x_0", "x_1", ...]</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>target_name</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the target variable</p>
<ul>
<li>use a <code>str</code>, to specify it name manually. For example: <code>"price"</code></li>
<li>use <code>None</code>, to keep the default name: <code>"y"</code></li>
</ul>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/regional_effect_shap.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="n">axis_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">nof_instances</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">feature_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cat_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">feature_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Regional SHAP constructor.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: the design matrix</span>

<span class="sd">            - shape: `(N,D)`</span>
<span class="sd">        model: the black-box model. Must be a `Callable` with:</span>

<span class="sd">            - input: `ndarray` of shape `(N, D)`</span>
<span class="sd">            - output: `ndarray` of shape `(N, )`</span>

<span class="sd">        axis_limits: The limits of the feature effect plot along each axis</span>

<span class="sd">            - use a `ndarray` of shape `(2, D)`, to specify them manually</span>
<span class="sd">            - use `None`, to be inferred from the data</span>

<span class="sd">        nof_instances: maximum number of instances to be used for PDP.</span>

<span class="sd">            - use &quot;all&quot;, for using all instances.</span>
<span class="sd">            - use an `int`, for using `nof_instances` instances.</span>

<span class="sd">        feature_types: The feature types.</span>

<span class="sd">            - use `None`, to infer them from the data; whether a feature is categorical or numerical is inferred</span>
<span class="sd">            from whether it exceeds the `cat_limit` unique values.</span>
<span class="sd">            - use a list with elements `&quot;cat&quot;` or `&quot;numerical&quot;`, to specify them manually.</span>

<span class="sd">        cat_limit: the minimum number of unique values for a feature to be considered categorical</span>

<span class="sd">        feature_names: The names of the features</span>

<span class="sd">            - use a `list` of `str`, to specify the name manually. For example: `                  [&quot;age&quot;, &quot;weight&quot;, ...]`</span>
<span class="sd">            - use `None`, to keep the default names: `[&quot;x_0&quot;, &quot;x_1&quot;, ...]`</span>

<span class="sd">        target_name: The name of the target variable</span>

<span class="sd">            - use a `str`, to specify it name manually. For example: `&quot;price&quot;`</span>
<span class="sd">            - use `None`, to keep the default name: `&quot;y&quot;`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">RegionalSHAP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="s2">&quot;shap&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">model</span><span class="p">,</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">nof_instances</span><span class="p">,</span>
        <span class="n">axis_limits</span><span class="p">,</span>
        <span class="n">feature_types</span><span class="p">,</span>
        <span class="n">cat_limit</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="p">,</span>
        <span class="n">target_name</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.regional_effect_shap.RegionalSHAP.fit">
<code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">heter_pcg_drop_thres</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">heter_small_enough</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nof_candidate_splits_for_numerical</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">min_points_per_subregion</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">candidate_conditioning_features</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">split_categorical_features</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">points_for_centering</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Fit the regional SHAP.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>features</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[int, str, list]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the features to fit.
- If set to "all", all the features will be fitted.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>heter_pcg_drop_thres</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>threshold for the percentage drop in heterogeneity to consider a split valid</p>
            </div>
          </td>
          <td>
                <code>0.1</code>
          </td>
        </tr>
        <tr>
          <td><code>heter_small_enough</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>heterogeneity threshold for a region to be considered homogeneous (splitting stops)</p>
            </div>
          </td>
          <td>
                <code>0.1</code>
          </td>
        </tr>
        <tr>
          <td><code>max_depth</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>maximum number of splits to perform (depth of the tree)</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>nof_candidate_splits_for_numerical</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>number of candidate splits to consider for numerical features</p>
            </div>
          </td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr>
          <td><code>min_points_per_subregion</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>minimum allowed number of points in a subregion (otherwise the split is not considered as valid)</p>
            </div>
          </td>
          <td>
                <code>10</code>
          </td>
        </tr>
        <tr>
          <td><code>candidate_conditioning_features</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[str, list]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of features to consider as conditioning features for the candidate splits</p>
            </div>
          </td>
          <td>
                <code>&#39;all&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>split_categorical_features</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to search for subregions in categorical features</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>centering</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[bool, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to center the SHAP dependence plots before estimating the heterogeneity</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>points_for_centering</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>number of points to use for centering</p>
            </div>
          </td>
          <td>
                <code>100</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/regional_effect_shap.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
        <span class="n">heter_pcg_drop_thres</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">heter_small_enough</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">nof_candidate_splits_for_numerical</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
        <span class="n">min_points_per_subregion</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">candidate_conditioning_features</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">split_categorical_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">centering</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">points_for_centering</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit the regional SHAP.</span>

<span class="sd">    Args:</span>
<span class="sd">        features: the features to fit.</span>
<span class="sd">            - If set to &quot;all&quot;, all the features will be fitted.</span>

<span class="sd">        heter_pcg_drop_thres: threshold for the percentage drop in heterogeneity to consider a split valid</span>
<span class="sd">        heter_small_enough: heterogeneity threshold for a region to be considered homogeneous (splitting stops)</span>
<span class="sd">        max_depth: maximum number of splits to perform (depth of the tree)</span>
<span class="sd">        nof_candidate_splits_for_numerical: number of candidate splits to consider for numerical features</span>
<span class="sd">        min_points_per_subregion: minimum allowed number of points in a subregion (otherwise the split is not considered as valid)</span>
<span class="sd">        candidate_conditioning_features: list of features to consider as conditioning features for the candidate splits</span>
<span class="sd">        split_categorical_features: whether to search for subregions in categorical features</span>
<span class="sd">        centering: whether to center the SHAP dependence plots before estimating the heterogeneity</span>
<span class="sd">        points_for_centering: number of points to use for centering</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">min_points_per_subregion</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;min_points_per_subregion must be &gt;= 2&quot;</span>
    <span class="n">features</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">prep_features</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
        <span class="n">heter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_heterogeneity_function</span><span class="p">(</span>
            <span class="n">feat</span><span class="p">,</span> <span class="n">min_points_per_subregion</span><span class="p">,</span> <span class="n">centering</span><span class="p">,</span> <span class="n">points_for_centering</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_feature</span><span class="p">(</span>
            <span class="n">feat</span><span class="p">,</span>
            <span class="n">heter</span><span class="p">,</span>
            <span class="n">heter_pcg_drop_thres</span><span class="p">,</span>
            <span class="n">heter_small_enough</span><span class="p">,</span>
            <span class="n">max_depth</span><span class="p">,</span>
            <span class="n">nof_candidate_splits_for_numerical</span><span class="p">,</span>
            <span class="n">min_points_per_subregion</span><span class="p">,</span>
            <span class="n">candidate_conditioning_features</span><span class="p">,</span>
            <span class="n">split_categorical_features</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">method_args</span><span class="p">[</span><span class="s2">&quot;feature_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feat</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;heter_pcg_drop_thres&quot;</span><span class="p">:</span> <span class="n">heter_pcg_drop_thres</span><span class="p">,</span>
            <span class="s2">&quot;heter_small_enough&quot;</span><span class="p">:</span> <span class="n">heter_small_enough</span><span class="p">,</span>
            <span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="n">max_depth</span><span class="p">,</span>
            <span class="s2">&quot;nof_candidate_splits_for_numerical&quot;</span><span class="p">:</span> <span class="n">nof_candidate_splits_for_numerical</span><span class="p">,</span>
            <span class="s2">&quot;min_points_per_subregion&quot;</span><span class="p">:</span> <span class="n">min_points_per_subregion</span><span class="p">,</span>
            <span class="s2">&quot;candidate_conditioning_features&quot;</span><span class="p">:</span> <span class="n">candidate_conditioning_features</span><span class="p">,</span>
            <span class="s2">&quot;split_categorical_features&quot;</span><span class="p">:</span> <span class="n">split_categorical_features</span><span class="p">,</span>
            <span class="s2">&quot;centering&quot;</span><span class="p">:</span> <span class="n">centering</span><span class="p">,</span>
            <span class="s2">&quot;points_for_centering&quot;</span><span class="p">:</span> <span class="n">points_for_centering</span><span class="p">,</span>
        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="binning-methods">Binning Methods</h2>


<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="effector.binning_methods.Fixed">
        <code>effector.binning_methods.Fixed</code>


</h2>


  <div class="doc doc-contents first">



        <details class="quote">
          <summary>Source code in <code>/home/runner/work/effector/effector/effector/binning_methods.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Fixed</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">nof_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
                 <span class="n">min_points_per_bin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                 <span class="n">cat_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span>
                 <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nof_bins</span> <span class="o">=</span> <span class="n">nof_bins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_points_per_bin</span> <span class="o">=</span> <span class="n">min_points_per_bin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cat_limit</span> <span class="o">=</span> <span class="n">cat_limit</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.binning_methods.Fixed.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">nof_bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_points_per_bin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">cat_limit</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/binning_methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">nof_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
             <span class="n">min_points_per_bin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
             <span class="n">cat_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span>
             <span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nof_bins</span> <span class="o">=</span> <span class="n">nof_bins</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">min_points_per_bin</span> <span class="o">=</span> <span class="n">min_points_per_bin</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cat_limit</span> <span class="o">=</span> <span class="n">cat_limit</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="effector.binning_methods.Greedy">
        <code>effector.binning_methods.Greedy</code>


</h2>


  <div class="doc doc-contents first">



        <details class="quote">
          <summary>Source code in <code>/home/runner/work/effector/effector/effector/binning_methods.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Greedy</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">init_nof_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
                 <span class="n">min_points_per_bin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                 <span class="n">discount</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
                 <span class="n">cat_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span>
                 <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_nof_bins</span> <span class="o">=</span> <span class="n">init_nof_bins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_points_per_bin</span> <span class="o">=</span> <span class="n">min_points_per_bin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discount</span> <span class="o">=</span> <span class="n">discount</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cat_limit</span> <span class="o">=</span> <span class="n">cat_limit</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.binning_methods.Greedy.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">init_nof_bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_points_per_bin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">discount</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">cat_limit</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/binning_methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">init_nof_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
             <span class="n">min_points_per_bin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
             <span class="n">discount</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
             <span class="n">cat_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span>
             <span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_nof_bins</span> <span class="o">=</span> <span class="n">init_nof_bins</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">min_points_per_bin</span> <span class="o">=</span> <span class="n">min_points_per_bin</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">discount</span> <span class="o">=</span> <span class="n">discount</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cat_limit</span> <span class="o">=</span> <span class="n">cat_limit</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="effector.binning_methods.DynamicProgramming">
        <code>effector.binning_methods.DynamicProgramming</code>


</h2>


  <div class="doc doc-contents first">



        <details class="quote">
          <summary>Source code in <code>/home/runner/work/effector/effector/effector/binning_methods.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DynamicProgramming</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">max_nof_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
                 <span class="n">min_points_per_bin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                 <span class="n">discount</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
                 <span class="n">cat_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_nof_bins</span> <span class="o">=</span> <span class="n">max_nof_bins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_points_per_bin</span> <span class="o">=</span> <span class="n">min_points_per_bin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discount</span> <span class="o">=</span> <span class="n">discount</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cat_limit</span> <span class="o">=</span> <span class="n">cat_limit</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="effector.binning_methods.DynamicProgramming.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">max_nof_bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">min_points_per_bin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">discount</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">cat_limit</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/binning_methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">max_nof_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
             <span class="n">min_points_per_bin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
             <span class="n">discount</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
             <span class="n">cat_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_nof_bins</span> <span class="o">=</span> <span class="n">max_nof_bins</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">min_points_per_bin</span> <span class="o">=</span> <span class="n">min_points_per_bin</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">discount</span> <span class="o">=</span> <span class="n">discount</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cat_limit</span> <span class="o">=</span> <span class="n">cat_limit</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="utils">Utils</h2>


<div class="doc doc-object doc-module">


<a id="effector.utils"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="effector.utils.compute_accumulated_effect">
<code class="highlight language-python"><span class="n">compute_accumulated_effect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">limits</span><span class="p">,</span> <span class="n">bin_effect</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Compute the accumulated effect at each point <code>x</code>.</p>

<details class="notes" open>
  <summary>Notes</summary>
  <p>The function implements the following formula:</p>
<div class="arithmatex">\[
\mathtt{dx}[i] = \mathtt{limits}[i+1] - \mathtt{limits}[i]
\]</div>
<div class="arithmatex">\[
\mathtt{full\_bin\_acc} = \sum_{i=0}^{k_x - 1} \mathtt{dx}[i] * \mathtt{bin\_effect}[i]
\]</div>
<div class="arithmatex">\[
\mathtt{remainder} = (x - \mathtt{limits}[k_x-1])* \mathtt{bin\_effect}[k_x]
\]</div>
<div class="arithmatex">\[
f(x) =  \mathtt{full\_bin\_acc} + \mathtt{remainder}
\]</div>
</details>
<details class="notes" open>
  <summary>Notes</summary>
  <p>if <code>square=True</code>, then the formula is:
$$
\mathtt{full_bin_acc} = \sum_{i=0}^{k_x - 1} \mathtt{dx}^2[i] * \mathtt{bin_effect}[i]
$$</p>
<div class="arithmatex">\[
\mathtt{remainder} = (x - \mathtt{limits}[k_x-1])^2* \mathtt{bin\_effect}[k_x]
\]</div>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bin_effect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compute_accumulated_effect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">limits</span><span class="p">,</span> <span class="n">bin_effect</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
<span class="go">array([0. , 0. , 0. , 0.5, 1. , 1.5, 1. , 1. , 1. ])</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bin_effect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compute_accumulated_effect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">limits</span><span class="p">,</span> <span class="n">bin_effect</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
<span class="go">array([0. , 0. , 0. , 0.5, 1. , 1.5, 2. , 2. , 2. ])</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The points we want to evaluate at, (T)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>limits</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The bin limits, (K+1)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>bin_effect</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The effect in each bin, (K)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>dx</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The bin-widths, (K)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>square</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to square the width. If true, the effect is bin_effect * dx^2, otherwise bin_effect * dx</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>y</code></td>          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The accumulated effect at each point, (T)</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_accumulated_effect</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">limits</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">bin_effect</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">dx</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">square</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the accumulated effect at each point `x`.</span>

<span class="sd">    Notes:</span>
<span class="sd">        The function implements the following formula:</span>

<span class="sd">        $$</span>
<span class="sd">        \mathtt{dx}[i] = \mathtt{limits}[i+1] - \mathtt{limits}[i]</span>
<span class="sd">        $$</span>

<span class="sd">        $$</span>
<span class="sd">        \mathtt{full\_bin\_acc} = \sum_{i=0}^{k_x - 1} \mathtt{dx}[i] * \mathtt{bin\_effect}[i]</span>
<span class="sd">        $$</span>

<span class="sd">        $$</span>
<span class="sd">        \mathtt{remainder} = (x - \mathtt{limits}[k_x-1])* \mathtt{bin\_effect}[k_x]</span>
<span class="sd">        $$</span>

<span class="sd">        $$</span>
<span class="sd">        f(x) =  \mathtt{full\_bin\_acc} + \mathtt{remainder}</span>
<span class="sd">        $$</span>

<span class="sd">    Notes:</span>
<span class="sd">        if `square=True`, then the formula is:</span>
<span class="sd">        $$</span>
<span class="sd">        \mathtt{full\_bin\_acc} = \sum_{i=0}^{k_x - 1} \mathtt{dx}^2[i] * \mathtt{bin\_effect}[i]</span>
<span class="sd">        $$</span>

<span class="sd">        $$</span>
<span class="sd">        \mathtt{remainder} = (x - \mathtt{limits}[k_x-1])^2* \mathtt{bin\_effect}[k_x]</span>
<span class="sd">        $$</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; x = np.array([-1.0, -0.5, 0.0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0])</span>
<span class="sd">        &gt;&gt;&gt; limits = np.array([0, 1.5, 2.0])</span>
<span class="sd">        &gt;&gt;&gt; bin_effect = np.array([1.0, -1.0])</span>
<span class="sd">        &gt;&gt;&gt; dx = np.array([1.5, 0.5])</span>
<span class="sd">        &gt;&gt;&gt; compute_accumulated_effect(x, limits, bin_effect, dx)</span>
<span class="sd">        array([0. , 0. , 0. , 0.5, 1. , 1.5, 1. , 1. , 1. ])</span>

<span class="sd">        &gt;&gt;&gt; x = np.array([-1.0, -0.5, 0.0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0])</span>
<span class="sd">        &gt;&gt;&gt; limits = np.array([0, 1.5, 2.0])</span>
<span class="sd">        &gt;&gt;&gt; bin_effect = np.array([1.0, 1.0])</span>
<span class="sd">        &gt;&gt;&gt; dx = np.array([1.5, 0.5])</span>
<span class="sd">        &gt;&gt;&gt; compute_accumulated_effect(x, limits, bin_effect, dx)</span>
<span class="sd">        array([0. , 0. , 0. , 0.5, 1. , 1.5, 2. , 2. , 2. ])</span>



<span class="sd">    Parameters:</span>
<span class="sd">        x: The points we want to evaluate at, (T)</span>
<span class="sd">        limits: The bin limits, (K+1)</span>
<span class="sd">        bin_effect: The effect in each bin, (K)</span>
<span class="sd">        dx: The bin-widths, (K)</span>
<span class="sd">        square: Whether to square the width. If true, the effect is bin_effect * dx^2, otherwise bin_effect * dx</span>

<span class="sd">    Returns:</span>
<span class="sd">        y: The accumulated effect at each point, (T)</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># find where each point belongs to</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">limits</span><span class="p">)</span>

    <span class="c1"># for each point, find the accumulated full-bin effect</span>
    <span class="n">x_cumsum</span> <span class="o">=</span> <span class="p">(</span><span class="n">bin_effect</span> <span class="o">*</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span> <span class="k">if</span> <span class="n">square</span> <span class="k">else</span> <span class="p">(</span><span class="n">bin_effect</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x_cumsum</span><span class="p">])</span>
    <span class="n">full_bin_effect</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

    <span class="c1"># for each point, find the remaining effect</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">limits</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">BIG_M</span><span class="p">]])</span>
    <span class="n">deltas</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">tmp</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
    <span class="n">deltas</span><span class="p">[</span><span class="n">deltas</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># if xs &lt; left_limit =&gt; delta = 0</span>
    <span class="n">deltas</span> <span class="o">=</span> <span class="n">deltas</span><span class="o">**</span><span class="mi">2</span> <span class="k">if</span> <span class="n">square</span> <span class="k">else</span> <span class="n">deltas</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">bin_effect</span><span class="p">,</span> <span class="p">[</span><span class="n">bin_effect</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]])</span>
    <span class="n">remaining_effect</span> <span class="o">=</span> <span class="n">deltas</span> <span class="o">*</span> <span class="n">tmp</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

    <span class="c1"># final effect</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">full_bin_effect</span> <span class="o">+</span> <span class="n">remaining_effect</span>
    <span class="k">return</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="effector.utils.compute_ale_params">
<code class="highlight language-python"><span class="n">compute_ale_params</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">df_dxs</span><span class="p">,</span> <span class="n">limits</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Compute all important parameters for the ALE plot.</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Example without interpolation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df_dxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">30</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">17</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">3.</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compute_ale_params</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">df_dxs</span><span class="p">,</span> <span class="n">limits</span><span class="p">)</span>
<span class="go">{&#39;limits&#39;: array([0. , 1.5, 3. ]), &#39;dx&#39;: array([1.5, 1.5]), &#39;points_per_bin&#39;: array([2, 2]), &#39;bin_effect&#39;: array([32., 16.]), &#39;bin_variance&#39;: array([4., 1.]), &#39;bin_estimator_variance&#39;: array([2. , 0.5])}</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Example with interpolation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df_dxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">31</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">40</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compute_ale_params</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">df_dxs</span><span class="p">,</span> <span class="n">limits</span><span class="p">)</span>
<span class="go">{&#39;limits&#39;: array([1, 3, 4]), &#39;dx&#39;: array([2, 1]), &#39;points_per_bin&#39;: array([3, 1]), &#39;bin_effect&#39;: array([34., 40.]), &#39;bin_variance&#39;: array([6., 6.]), &#39;bin_estimator_variance&#39;: array([2., 2.])}</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>xs</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The values of s-th feature, (N)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>df_dxs</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The effect wrt the s-th feature, (N)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>limits</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The bin limits, (K+1)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>parameters</code></td>          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dict</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_ale_params</span><span class="p">(</span><span class="n">xs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">df_dxs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">limits</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute all important parameters for the ALE plot.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; # Example without interpolation</span>
<span class="sd">        &gt;&gt;&gt; xs = np.array([0.5, 1.2, 2, 2.3])</span>
<span class="sd">        &gt;&gt;&gt; df_dxs = np.array([30, 34, 15, 17])</span>
<span class="sd">        &gt;&gt;&gt; limits = np.array([0, 1.5, 3.])</span>
<span class="sd">        &gt;&gt;&gt; compute_ale_params(xs, df_dxs, limits)</span>
<span class="sd">        {&#39;limits&#39;: array([0. , 1.5, 3. ]), &#39;dx&#39;: array([1.5, 1.5]), &#39;points_per_bin&#39;: array([2, 2]), &#39;bin_effect&#39;: array([32., 16.]), &#39;bin_variance&#39;: array([4., 1.]), &#39;bin_estimator_variance&#39;: array([2. , 0.5])}</span>

<span class="sd">        &gt;&gt;&gt; # Example with interpolation</span>
<span class="sd">        &gt;&gt;&gt; xs = np.array([1, 2, 2.8, 4])</span>
<span class="sd">        &gt;&gt;&gt; df_dxs = np.array([31, 34, 37, 40])</span>
<span class="sd">        &gt;&gt;&gt; limits = np.array([1, 3, 4])</span>
<span class="sd">        &gt;&gt;&gt; compute_ale_params(xs, df_dxs, limits)</span>
<span class="sd">        {&#39;limits&#39;: array([1, 3, 4]), &#39;dx&#39;: array([2, 1]), &#39;points_per_bin&#39;: array([3, 1]), &#39;bin_effect&#39;: array([34., 40.]), &#39;bin_variance&#39;: array([6., 6.]), &#39;bin_estimator_variance&#39;: array([2., 2.])}</span>

<span class="sd">    Args:</span>
<span class="sd">        xs: The values of s-th feature, (N)</span>
<span class="sd">        df_dxs: The effect wrt the s-th feature, (N)</span>
<span class="sd">        limits: The bin limits, (K+1)</span>

<span class="sd">    Returns:</span>
<span class="sd">        parameters: dict</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># compute bin-widths</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">limits</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">limits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">limits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span>

    <span class="c1"># compute mean effect on each bin</span>
    <span class="n">bin_effect_nans</span><span class="p">,</span> <span class="n">points_per_bin</span> <span class="o">=</span> <span class="n">compute_bin_effect</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">df_dxs</span><span class="p">,</span> <span class="n">limits</span><span class="p">)</span>

    <span class="c1"># compute effect variance in each bin</span>
    <span class="n">bin_variance_nans</span><span class="p">,</span> <span class="n">bin_estimator_variance_nans</span> <span class="o">=</span> <span class="n">compute_bin_variance</span><span class="p">(</span>
        <span class="n">xs</span><span class="p">,</span> <span class="n">df_dxs</span><span class="p">,</span> <span class="n">limits</span><span class="p">,</span> <span class="n">bin_effect_nans</span>
    <span class="p">)</span>

    <span class="c1"># interpolate NaNs</span>
    <span class="n">bin_effect</span> <span class="o">=</span> <span class="n">fill_nans</span><span class="p">(</span><span class="n">bin_effect_nans</span><span class="p">)</span>
    <span class="n">bin_variance</span> <span class="o">=</span> <span class="n">fill_nans</span><span class="p">(</span><span class="n">bin_variance_nans</span><span class="p">)</span>
    <span class="n">bin_estimator_variance</span> <span class="o">=</span> <span class="n">fill_nans</span><span class="p">(</span><span class="n">bin_estimator_variance_nans</span><span class="p">)</span>

    <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;limits&quot;</span><span class="p">:</span> <span class="n">limits</span><span class="p">,</span>
        <span class="s2">&quot;dx&quot;</span><span class="p">:</span> <span class="n">dx</span><span class="p">,</span>
        <span class="s2">&quot;points_per_bin&quot;</span><span class="p">:</span> <span class="n">points_per_bin</span><span class="p">,</span>
        <span class="s2">&quot;bin_effect&quot;</span><span class="p">:</span> <span class="n">bin_effect</span><span class="p">,</span>
        <span class="s2">&quot;bin_variance&quot;</span><span class="p">:</span> <span class="n">bin_variance</span><span class="p">,</span>
        <span class="s2">&quot;bin_estimator_variance&quot;</span><span class="p">:</span> <span class="n">bin_estimator_variance</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">parameters</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="effector.utils.compute_bin_effect">
<code class="highlight language-python"><span class="n">compute_bin_effect</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">df_dxs</span><span class="p">,</span> <span class="n">limits</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Compute the mean effect in each bin.</p>

<details class="notes" open>
  <summary>Notes</summary>
  <p>The function (a) allocates the instances in the bins and (b) aggregates the instance-level effects to compute
the average bin-effect. If no instances lie in a bin, then the bin effect is NaN.</p>
<div class="arithmatex">\[
\mathtt{bin\_effect}_k = {1 \over |i \in bin_k|} \sum_{i \in bin_k} \mathtt{effect}_i
\]</div>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">n</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df_dxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bin_effects</span><span class="p">,</span> <span class="n">ppb</span> <span class="o">=</span> <span class="n">compute_bin_effect</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">df_dxs</span><span class="p">,</span> <span class="n">limits</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bin_effects</span>
<span class="go">array([10., nan])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ppb</span>
<span class="go">array([100,   0])</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>xs</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The s-th feature of the instances, (N)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>df_dxs</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The effect wrt the s-th feature for each instance, (N)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>limits</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The bin limits, (K+1)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>bin_effects</code></td>          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The average effect per bin, (K)</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>points_per_bin</code></td>          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of points per bin, (K)</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_bin_effect</span><span class="p">(</span>
    <span class="n">xs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">df_dxs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">limits</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the mean effect in each bin.</span>

<span class="sd">    Notes:</span>
<span class="sd">        The function (a) allocates the instances in the bins and (b) aggregates the instance-level effects to compute</span>
<span class="sd">        the average bin-effect. If no instances lie in a bin, then the bin effect is NaN.</span>

<span class="sd">        $$</span>
<span class="sd">        \mathtt{bin\_effect}_k = {1 \over |i \in bin_k|} \sum_{i \in bin_k} \mathtt{effect}_i</span>
<span class="sd">        $$</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; n = 100</span>
<span class="sd">        &gt;&gt;&gt; xs = np.ones([n]) - 0.5</span>
<span class="sd">        &gt;&gt;&gt; df_dxs = np.ones_like(xs) * 10</span>
<span class="sd">        &gt;&gt;&gt; limits = np.array([0., 1., 2.0])</span>
<span class="sd">        &gt;&gt;&gt; bin_effects, ppb = compute_bin_effect(xs, df_dxs, limits)</span>
<span class="sd">        &gt;&gt;&gt; bin_effects</span>
<span class="sd">        array([10., nan])</span>
<span class="sd">        &gt;&gt;&gt; ppb</span>
<span class="sd">        array([100,   0])</span>

<span class="sd">    Parameters:</span>
<span class="sd">        xs: The s-th feature of the instances, (N)</span>
<span class="sd">        df_dxs: The effect wrt the s-th feature for each instance, (N)</span>
<span class="sd">        limits: The bin limits, (K+1)</span>

<span class="sd">    Returns:</span>
<span class="sd">        bin_effects: The average effect per bin, (K)</span>
<span class="sd">        points_per_bin: The number of points per bin, (K)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">empty_symbol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>

    <span class="c1"># find bin-index of points</span>
    <span class="n">limits_enh</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">limits</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">limits_enh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">EPS</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">limits_enh</span><span class="p">)</span>
    <span class="c1"># assert np.alltrue(ind &gt; 0)</span>

    <span class="c1"># bin effect is the mean of all points that lie in the bin</span>
    <span class="n">nof_bins</span> <span class="o">=</span> <span class="n">limits</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">aggregated_effect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">df_dxs</span><span class="p">,</span> <span class="n">minlength</span><span class="o">=</span><span class="n">nof_bins</span><span class="p">)</span>
    <span class="n">points_per_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">minlength</span><span class="o">=</span><span class="n">nof_bins</span><span class="p">)</span>

    <span class="c1"># if no point lies in a bin, store Nan</span>
    <span class="n">bin_effect_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span>
        <span class="n">aggregated_effect</span><span class="p">,</span>
        <span class="n">points_per_bin</span><span class="p">,</span>
        <span class="n">out</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">aggregated_effect</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">empty_symbol</span><span class="p">,</span>
        <span class="n">where</span><span class="o">=</span><span class="n">points_per_bin</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">bin_effect_mean</span><span class="p">,</span> <span class="n">points_per_bin</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="effector.utils.compute_bin_variance">
<code class="highlight language-python"><span class="n">compute_bin_variance</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">df_dxs</span><span class="p">,</span> <span class="n">limits</span><span class="p">,</span> <span class="n">bin_effect_mean</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Compute the variance of the effect in each bin.</p>

<details class="notes" open>
  <summary>Notes</summary>
  <p>The function (a) allocates the points in the bins and (b) computes the variance and the variance/nof points.
If less than two points in a bin, NaN is passed.</p>
<div class="arithmatex">\[
\mathtt{bin\_variance}_k = {1 \over |i \in bin_k|} \sum_{i \in bin_k}
(\mathtt{effect}_i - \mathtt{bin\_effect}_k)^2
\]</div>
<div class="arithmatex">\[
\mathtt{bin\_estimator\_variance_k} = {\mathtt{bin\_variance}_k \over |i \in bin_k|}
\]</div>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">n</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df_dxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bin_effect_mean</span><span class="p">,</span> <span class="n">ppb</span> <span class="o">=</span> <span class="n">compute_bin_effect</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">df_dxs</span><span class="p">,</span> <span class="n">limits</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bin_variance</span><span class="p">,</span> <span class="n">bin_estimator_variance</span> <span class="o">=</span> <span class="n">compute_bin_variance</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">df_dxs</span><span class="p">,</span> <span class="n">limits</span><span class="p">,</span> <span class="n">bin_effect_mean</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bin_variance</span>
<span class="go">array([ 0., nan])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bin_estimator_variance</span>
<span class="go">array([ 0., nan])</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df_dxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bin_effect_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_dxs</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compute_bin_variance</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">df_dxs</span><span class="p">,</span> <span class="n">limits</span><span class="p">,</span> <span class="n">bin_effect_mean</span><span class="p">)</span>
<span class="go">(array([ 2., nan]), array([0.5, nan]))</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>xs</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The points we evaluate, (N)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>df_dxs</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The effect of each point, (N, )</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>limits</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The bin limits (K+1)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>bin_effect_mean</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Mean effect in each bin, (K)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>bin_variance</code></td>          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The variance in each bin, (K, )</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>bin_estimator_variance</code></td>          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The variance of the estimator in each bin, (K, )</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_bin_variance</span><span class="p">(</span>
    <span class="n">xs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">df_dxs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">limits</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">bin_effect_mean</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the variance of the effect in each bin.</span>

<span class="sd">    Notes:</span>
<span class="sd">        The function (a) allocates the points in the bins and (b) computes the variance and the variance/nof points.</span>
<span class="sd">        If less than two points in a bin, NaN is passed.</span>

<span class="sd">        $$</span>
<span class="sd">        \mathtt{bin\_variance}_k = {1 \over |i \in bin_k|} \sum_{i \in bin_k}</span>
<span class="sd">        (\mathtt{effect}_i - \mathtt{bin\_effect}_k)^2</span>
<span class="sd">        $$</span>

<span class="sd">        $$</span>
<span class="sd">        \mathtt{bin\_estimator\_variance_k} = {\mathtt{bin\_variance}_k \over |i \in bin_k|}</span>
<span class="sd">        $$</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; n = 100</span>
<span class="sd">        &gt;&gt;&gt; xs = np.ones([n]) - 0.5</span>
<span class="sd">        &gt;&gt;&gt; df_dxs = np.ones_like(xs) * 10</span>
<span class="sd">        &gt;&gt;&gt; limits = np.array([0., 1., 2.0])</span>
<span class="sd">        &gt;&gt;&gt; bin_effect_mean, ppb = compute_bin_effect(xs, df_dxs, limits)</span>
<span class="sd">        &gt;&gt;&gt; bin_variance, bin_estimator_variance = compute_bin_variance(xs, df_dxs, limits, bin_effect_mean)</span>
<span class="sd">        &gt;&gt;&gt; bin_variance</span>
<span class="sd">        array([ 0., nan])</span>
<span class="sd">        &gt;&gt;&gt; bin_estimator_variance</span>
<span class="sd">        array([ 0., nan])</span>

<span class="sd">        &gt;&gt;&gt; xs = np.ones(4) * 0.5</span>
<span class="sd">        &gt;&gt;&gt; df_dxs = np.array([1.0, 3.0, 3.0, 5.0])</span>
<span class="sd">        &gt;&gt;&gt; limits = np.array([0, 1, 2.0])</span>
<span class="sd">        &gt;&gt;&gt; bin_effect_mean = np.array([np.mean(df_dxs), np.NaN])</span>
<span class="sd">        &gt;&gt;&gt; compute_bin_variance(xs, df_dxs, limits, bin_effect_mean)</span>
<span class="sd">        (array([ 2., nan]), array([0.5, nan]))</span>

<span class="sd">    Parameters:</span>
<span class="sd">        xs: The points we evaluate, (N)</span>
<span class="sd">        df_dxs: The effect of each point, (N, )</span>
<span class="sd">        limits: The bin limits (K+1)</span>
<span class="sd">        bin_effect_mean: Mean effect in each bin, (K)</span>

<span class="sd">    Returns:</span>
<span class="sd">        bin_variance: The variance in each bin, (K, )</span>
<span class="sd">        bin_estimator_variance: The variance of the estimator in each bin, (K, )</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">empty_symbol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>

    <span class="c1"># find bin-index of points</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-8</span>
    <span class="n">limits_enh</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">limits</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">limits_enh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">eps</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">limits_enh</span><span class="p">)</span>
    <span class="c1"># assert np.alltrue(ind &gt; 0)</span>

    <span class="c1"># variance of the effect in each bin</span>
    <span class="n">variance_per_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_dxs</span> <span class="o">-</span> <span class="n">bin_effect_mean</span><span class="p">[</span><span class="n">ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">nof_bins</span> <span class="o">=</span> <span class="n">limits</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">aggregated_variance_per_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span>
        <span class="n">ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">variance_per_point</span><span class="p">,</span> <span class="n">minlength</span><span class="o">=</span><span class="n">nof_bins</span>
    <span class="p">)</span>
    <span class="n">points_per_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">minlength</span><span class="o">=</span><span class="n">nof_bins</span><span class="p">)</span>

    <span class="c1"># if less than two points in a bin, store Nan</span>
    <span class="n">bin_variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span>
        <span class="n">aggregated_variance_per_bin</span><span class="p">,</span>
        <span class="n">points_per_bin</span><span class="p">,</span>
        <span class="n">out</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">aggregated_variance_per_bin</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">empty_symbol</span><span class="p">,</span>
        <span class="n">where</span><span class="o">=</span><span class="n">points_per_bin</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># the variance of the estimator</span>
    <span class="n">bin_estimator_variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span>
        <span class="n">bin_variance</span><span class="p">,</span>
        <span class="n">points_per_bin</span><span class="p">,</span>
        <span class="n">out</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">aggregated_variance_per_bin</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">empty_symbol</span><span class="p">,</span>
        <span class="n">where</span><span class="o">=</span><span class="n">points_per_bin</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">bin_variance</span><span class="p">,</span> <span class="n">bin_estimator_variance</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="effector.utils.compute_jacobian_numerically">
<code class="highlight language-python"><span class="n">compute_jacobian_numerically</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-08</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Compute the Jacobian of the model using finite differences.</p>

<details class="notes" open>
  <summary>Notes</summary>
  <p>The function computes the Jacobian of the model using finite differences. The formula is:</p>
<div class="arithmatex">\[
\mathtt{J} = {\mathtt{model}(x + \mathtt{eps}) - \mathtt{model}(x) \over \mathtt{eps}}
\]</div>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compute_jacobian_numerically</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="go">array([[1., 1.],</span>
<span class="go">       [1., 1.]])</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dataset, (N, D)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model</code></td>
          <td>
                <code>typing.<span title="typing.Callable">Callable</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The black-box model ((N, D) -&gt; (N))</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>eps</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The finite difference step</p>
            </div>
          </td>
          <td>
                <code>1e-08</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>jacobian</code></td>          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The Jacobian of the model, (N, D)</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_jacobian_numerically</span><span class="p">(</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-8</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the Jacobian of the model using finite differences.</span>

<span class="sd">    Notes:</span>
<span class="sd">        The function computes the Jacobian of the model using finite differences. The formula is:</span>

<span class="sd">        $$</span>
<span class="sd">        \mathtt{J} = {\mathtt{model}(x + \mathtt{eps}) - \mathtt{model}(x) \over \mathtt{eps}}</span>
<span class="sd">        $$</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([[1, 2], [2, 3.0]])</span>
<span class="sd">        &gt;&gt;&gt; model = lambda x: np.sum(x, axis=1)</span>
<span class="sd">        &gt;&gt;&gt; compute_jacobian_numerically(model, data)</span>
<span class="sd">        array([[1., 1.],</span>
<span class="sd">               [1., 1.]])</span>

<span class="sd">    Args:</span>
<span class="sd">        data: The dataset, (N, D)</span>
<span class="sd">        model: The black-box model ((N, D) -&gt; (N))</span>
<span class="sd">        eps: The finite difference step</span>

<span class="sd">    Returns:</span>
<span class="sd">        jacobian: The Jacobian of the model, (N, D)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="n">jacobian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">data_plus</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">data_plus</span><span class="p">[:,</span> <span class="n">f</span><span class="p">]</span> <span class="o">+=</span> <span class="n">eps</span>
        <span class="n">jacobian</span><span class="p">[:,</span> <span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="p">(</span><span class="n">data_plus</span><span class="p">)</span> <span class="o">-</span> <span class="n">model</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="n">eps</span>
    <span class="k">return</span> <span class="n">jacobian</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="effector.utils.compute_local_effects">
<code class="highlight language-python"><span class="n">compute_local_effects</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">limits</span><span class="p">,</span> <span class="n">feature</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Compute the local effects, permuting the feature of interest using the bin limits.</p>

<details class="notes" open>
  <summary>Notes</summary>
  <p>The function (a) allocates the points in the bins based on the feature of interest (foi)
and (b) computes the effect as the difference when evaluating the output setting the foi at the right and the
left limit of the bin.</p>
<p>Given that the bins are defined as a list [l_0, l_1, ..., l_k], and x_s of the i-th point belongs to the k-th bin:</p>
<div class="arithmatex">\[
{df \over dx_s}(x^i) = {f(x_0^i, ... ,x_s=l_k, ..., x_D^i) - f(x_0^i, ... ,x_s=l_{k-1}, ..., x_D^i)
 \over l_k - l_{k-1}}
\]</div>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_effect</span> <span class="o">=</span> <span class="n">compute_local_effects</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">limits</span><span class="p">,</span> <span class="n">feature</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_effect</span>
<span class="go">array([1., 1.])</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The training set, (N, D)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model</code></td>
          <td>
                <code>typing.<span title="typing.Callable">Callable</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The black-box model ((N, D) -&gt; (N))</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>limits</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The bin limits, (K+1)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>feature</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Index of the feature-of-interest</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>data_effect</code></td>          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The local effect of each data point, (N)</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_local_effects</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">limits</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">feature</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the local effects, permuting the feature of interest using the bin limits.</span>

<span class="sd">    Notes:</span>
<span class="sd">        The function (a) allocates the points in the bins based on the feature of interest (foi)</span>
<span class="sd">        and (b) computes the effect as the difference when evaluating the output setting the foi at the right and the</span>
<span class="sd">        left limit of the bin.</span>

<span class="sd">        Given that the bins are defined as a list [l_0, l_1, ..., l_k], and x_s of the i-th point belongs to the k-th bin:</span>

<span class="sd">        $$</span>
<span class="sd">        {df \over dx_s}(x^i) = {f(x_0^i, ... ,x_s=l_k, ..., x_D^i) - f(x_0^i, ... ,x_s=l_{k-1}, ..., x_D^i)</span>
<span class="sd">         \over l_k - l_{k-1}}</span>
<span class="sd">        $$</span>


<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([[1, 2], [2, 3.0]])</span>
<span class="sd">        &gt;&gt;&gt; model = lambda x: np.sum(x, axis=1)</span>
<span class="sd">        &gt;&gt;&gt; limits = np.array([1.0, 2.0])</span>
<span class="sd">        &gt;&gt;&gt; data_effect = compute_local_effects(data, model, limits, feature=0)</span>
<span class="sd">        &gt;&gt;&gt; data_effect</span>
<span class="sd">        array([1., 1.])</span>

<span class="sd">    Args:</span>
<span class="sd">        data: The training set, (N, D)</span>
<span class="sd">        model: The black-box model ((N, D) -&gt; (N))</span>
<span class="sd">        limits: The bin limits, (K+1)</span>
<span class="sd">        feature: Index of the feature-of-interest</span>

<span class="sd">    Returns:</span>
<span class="sd">        data_effect: The local effect of each data point, (N)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span>

    <span class="c1"># check that limits cover all data points</span>
    <span class="k">assert</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="n">feature</span><span class="p">])</span>
    <span class="k">assert</span> <span class="n">limits</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="n">feature</span><span class="p">])</span>

    <span class="c1"># for each point, find the bin-index it belongs to</span>
    <span class="n">limits</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">EPS</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="n">feature</span><span class="p">],</span> <span class="n">limits</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">alltrue</span><span class="p">(</span><span class="n">ind</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># compute effect</span>
    <span class="n">right_lim</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">left_lim</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">right_lim</span><span class="p">[:,</span> <span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">limits</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
    <span class="n">left_lim</span><span class="p">[:,</span> <span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">limits</span><span class="p">[</span><span class="n">ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">data_effect</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">right_lim</span><span class="p">)</span> <span class="o">-</span> <span class="n">model</span><span class="p">(</span><span class="n">left_lim</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data_effect</span><span class="p">)</span> <span class="o">/</span> <span class="n">dx</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="effector.utils.fill_nans">
<code class="highlight language-python"><span class="n">fill_nans</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Replace NaNs with interpolated values.</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fill_nans</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">array([1. , 1.5, 2. ])</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fill_nans</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">array([1.  , 1.25, 1.5 , 1.75, 2.  ])</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fill_nans</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">array([0.5, 1. , 1. , 1. , 1. ])</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Time-series with NaNs, (T)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>x</code></td>          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Time-series values without NaNs, (T)</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fill_nans</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Replace NaNs with interpolated values.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; x = np.array([1.0, np.NaN, 2.0])</span>
<span class="sd">        &gt;&gt;&gt; fill_nans(x)</span>
<span class="sd">        array([1. , 1.5, 2. ])</span>

<span class="sd">        &gt;&gt;&gt; x = np.array([1.0, np.NaN, np.NaN, np.NaN, 2.0])</span>
<span class="sd">        &gt;&gt;&gt; fill_nans(x)</span>
<span class="sd">        array([1.  , 1.25, 1.5 , 1.75, 2.  ])</span>

<span class="sd">        &gt;&gt;&gt; x = np.array([0.5, 1.0, np.NaN, np.NaN, np.NaN])</span>
<span class="sd">        &gt;&gt;&gt; fill_nans(x)</span>
<span class="sd">        array([0.5, 1. , 1. , 1. , 1. ])</span>

<span class="sd">    Parameters:</span>
<span class="sd">        x: Time-series with NaNs, (T)</span>

<span class="sd">    Returns:</span>
<span class="sd">        x: Time-series values without NaNs, (T)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bin_effect_1</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">nan_helper</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="n">z</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">nans</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">nan_helper</span><span class="p">(</span><span class="n">bin_effect_1</span><span class="p">)</span>
    <span class="n">bin_effect_1</span><span class="p">[</span><span class="n">nans</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">nans</span><span class="p">),</span> <span class="n">x</span><span class="p">(</span><span class="o">~</span><span class="n">nans</span><span class="p">),</span> <span class="n">bin_effect_1</span><span class="p">[</span><span class="o">~</span><span class="n">nans</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">bin_effect_1</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="effector.utils.filter_points_in_bin">
<code class="highlight language-python"><span class="n">filter_points_in_bin</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">df_dxs</span><span class="p">,</span> <span class="n">limits</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Filter the points inside the bin defined by the <code>limits</code>.</p>

<details class="notes" open>
  <summary>Notes</summary>
  <p>Filtering depends on whether <code>xs</code> lies in the interval [limits[0], limits[1]], not <code>df_dxs</code>.</p>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df_dxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">32</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">36</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xs</span><span class="p">,</span> <span class="n">df_dxs</span> <span class="o">=</span> <span class="n">filter_points_in_bin</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">df_dxs</span><span class="p">,</span> <span class="n">limits</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xs</span>
<span class="go">array([1, 2])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df_dxs</span>
<span class="go">array([32, 34])</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>xs</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The instances, (N)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>df_dxs</code></td>
          <td>
                <code>typing.<span title="typing.Union">Union</span>[<span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>, None]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The instance-effects (N) or None</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>limits</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>[Start, Stop] of the bin</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>data</code></td>          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The instances in the bin, (nof_points_in_bin, D)</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>data_effect</code></td>          <td>
                <code>typing.<span title="typing.Union">Union</span>[<span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>, None]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The instance-effects in the bin, (nof_points_in_bin, D) or None</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_points_in_bin</span><span class="p">(</span>
    <span class="n">xs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">df_dxs</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">limits</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filter the points inside the bin defined by the `limits`.</span>

<span class="sd">    Notes:</span>
<span class="sd">        Filtering depends on whether `xs` lies in the interval [limits[0], limits[1]], not `df_dxs`.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; xs = np.array([1, 2, 3])</span>
<span class="sd">        &gt;&gt;&gt; df_dxs = np.array([32, 34, 36])</span>
<span class="sd">        &gt;&gt;&gt; limits = np.array([1, 2])</span>
<span class="sd">        &gt;&gt;&gt; xs, df_dxs = filter_points_in_bin(xs, df_dxs, limits)</span>
<span class="sd">        &gt;&gt;&gt; xs</span>
<span class="sd">        array([1, 2])</span>
<span class="sd">        &gt;&gt;&gt; df_dxs</span>
<span class="sd">        array([32, 34])</span>

<span class="sd">    Args:</span>
<span class="sd">        xs: The instances, (N)</span>
<span class="sd">        df_dxs: The instance-effects (N) or None</span>
<span class="sd">        limits: [Start, Stop] of the bin</span>

<span class="sd">    Returns:</span>
<span class="sd">        data: The instances in the bin, (nof_points_in_bin, D)</span>
<span class="sd">        data_effect: The instance-effects in the bin, (nof_points_in_bin, D) or None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">xs</span><span class="p">,</span> <span class="n">xs</span> <span class="o">&lt;=</span> <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># return data</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="n">filt</span><span class="p">]</span>

    <span class="c1"># return data effect if not None</span>
    <span class="k">if</span> <span class="n">df_dxs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df_dxs</span> <span class="o">=</span> <span class="n">df_dxs</span><span class="p">[</span><span class="n">filt</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">xs</span><span class="p">,</span> <span class="n">df_dxs</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="effector.utils.get_feature_types">
<code class="highlight language-python"><span class="n">get_feature_types</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">categorical_limit</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Determine the type of each feature.</p>

<details class="notes" open>
  <summary>Notes</summary>
  <p>A feature is considered as categorical if it has less than <code>cat_limit</code> unique values.</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dataset, (N, D)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>categorical_limit</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Maximum unique values for a feature to be considered as categorical</p>
            </div>
          </td>
          <td>
                <code>10</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>types</code></td>          <td>
                <code>typing.<span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of strings, where each string is either <code>"cat"</code> or <code>"cont"</code></p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/home/runner/work/effector/effector/effector/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_types</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">categorical_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine the type of each feature.</span>

<span class="sd">    Notes:</span>
<span class="sd">        A feature is considered as categorical if it has less than `cat_limit` unique values.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: The dataset, (N, D)</span>
<span class="sd">        categorical_limit: Maximum unique values for a feature to be considered as categorical</span>


<span class="sd">    Returns:</span>
<span class="sd">        types: A list of strings, where each string is either `&quot;cat&quot;` or `&quot;cont&quot;`</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">types</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;cat&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="n">f</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="n">categorical_limit</span> <span class="k">else</span> <span class="s2">&quot;cont&quot;</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">types</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../Tutorials/real-examples/01_bike_sharing_dataset/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Bike Sharing" rel="prev">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Bike Sharing
              </div>
            </div>
          </a>
        
        
          
          <a href="../contributing/" class="md-footer__link md-footer__link--next" aria-label="Next: Contributing" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Contributing
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/givasile/effector" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.footer", "header.autohide"], "search": "../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>